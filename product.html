<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow Original 30-Pack â€” Flow Hydration</title>
    <!-- Mobile redirect - must be first -->
    <script>
        (function() {
            var MOBILE_BREAKPOINT = 768;
            
            function getMobileUrl() {
                var params = window.location.search;
                // Get the base path and replace product.html with product-mobile.html
                var path = window.location.pathname;
                var basePath = path.substring(0, path.lastIndexOf('/') + 1);
                return basePath + 'product-mobile.html' + params;
            }
            
            function checkMobile() {
                return window.innerWidth <= MOBILE_BREAKPOINT || 
                       /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }
            
            // Initial redirect
            if (checkMobile() && !window.location.hash) {
                window.location.replace(getMobileUrl());
            }
            
            // Auto-switch to mobile version on resize
            var resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    if (window.innerWidth <= MOBILE_BREAKPOINT) {
                        window.location.replace(getMobileUrl());
                    }
                }, 250);
            });
        })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Syne:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --flow-blue: #0A1628;
            --flow-cyan: #00D4FF;
            --flow-teal: #00B4B4;
            --flow-white: #FAFCFF;
            --flow-gray: #94A3B8;
            --flow-dark: #020817;
            --flow-card: #0d1a2d;
            --gradient-flow: linear-gradient(135deg, #00D4FF 0%, #00B4B4 50%, #0A1628 100%);
            --gradient-water: linear-gradient(180deg, rgba(0, 212, 255, 0.15) 0%, rgba(0, 180, 180, 0.05) 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--flow-dark);
            color: var(--flow-white);
            overflow-x: hidden;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Animated water background */
        .water-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: var(--flow-dark);
        }

        .water-bg::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(0, 212, 255, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(0, 180, 180, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(0, 212, 255, 0.04) 0%, transparent 60%);
            animation: floatBg 20s ease-in-out infinite;
        }

        @keyframes floatBg {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(2%, 2%) rotate(1deg); }
            50% { transform: translate(0, 4%) rotate(0deg); }
            75% { transform: translate(-2%, 2%) rotate(-1deg); }
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 0.75rem 4%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(20px);
            background: rgba(2, 8, 23, 0.9);
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .logo-img {
            height: 55px;
            width: auto;
        }

        .nav-links {
            display: flex;
            gap: 2.5rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--flow-gray);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-links a.active,
        .nav-links a:hover {
            color: var(--flow-white);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .cart-btn {
            position: relative;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 0.6rem 1rem;
            border-radius: 50px;
            color: var(--flow-white);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .cart-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--flow-cyan);
        }

        .cart-btn .cart-text {
            max-width: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-width 0.3s ease, opacity 0.3s ease;
        }

        .cart-btn:hover .cart-text {
            max-width: 50px;
            opacity: 1;
        }

        .cart-count {
            background: var(--flow-cyan);
            color: var(--flow-dark);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .profile-btn {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 0.6rem;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            color: var(--flow-white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            text-decoration: none;
            overflow: hidden;
        }

        .profile-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--flow-cyan);
            width: auto;
            padding: 0.6rem 1rem;
            border-radius: 50px;
            gap: 0.4rem;
        }

        .profile-btn .profile-text {
            max-width: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-width 0.3s ease, opacity 0.3s ease;
        }

        .profile-btn:hover .profile-text {
            max-width: 60px;
            opacity: 1;
        }

        /* Breadcrumb */
        .breadcrumb {
            padding: 7rem 8% 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: var(--flow-gray);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .breadcrumb a:hover {
            color: var(--flow-cyan);
        }

        .breadcrumb span {
            color: var(--flow-gray);
        }

        .breadcrumb .current {
            color: var(--flow-white);
        }

        /* Product Container */
        .product-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            padding: 2rem 8% 6rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Product Gallery */
        .product-gallery {
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        .main-image {
            background: linear-gradient(145deg, rgba(13, 26, 45, 0.8) 0%, rgba(13, 26, 45, 0.4) 100%);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 24px;
            height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .main-image::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(0, 212, 255, 0.15) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .product-badge {
            position: absolute;
            top: 1.5rem;
            left: 1.5rem;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: var(--flow-dark);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            z-index: 2;
        }

        .best-value-badge {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            z-index: 2;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
        }

        .sachet-visual-large {
            width: 180px;
            height: 260px;
            background: linear-gradient(135deg, #0A1628 0%, #1a2d4a 50%, #0A1628 100%);
            border-radius: 18px 18px 28px 28px;
            position: relative;
            box-shadow: 
                0 30px 80px rgba(0, 212, 255, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            z-index: 2;
            transition: transform 0.4s ease;
        }

        .sachet-visual-large:hover {
            transform: scale(1.05) rotate(-2deg);
        }

        .sachet-visual-large::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 35px;
            background: linear-gradient(180deg, rgba(0, 212, 255, 0.2) 0%, transparent 100%);
            border-radius: 18px 18px 0 0;
        }

        .sachet-content-large {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .sachet-logo-large {
            font-family: 'Syne', sans-serif;
            font-size: 1.8rem;
            font-weight: 800;
            background: var(--gradient-flow);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sachet-flavor-large {
            font-size: 0.7rem;
            color: var(--flow-cyan);
            margin-top: 0.35rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        .thumbnail-row {
            display: flex;
            gap: 0.75rem;
        }

        .thumbnail {
            flex: 1;
            height: 100px;
            background: linear-gradient(145deg, rgba(13, 26, 45, 0.8) 0%, rgba(13, 26, 45, 0.4) 100%);
            border: 2px solid rgba(0, 212, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .thumbnail:hover,
        .thumbnail.active {
            border-color: var(--flow-cyan);
        }

        .thumbnail.active {
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }

        .thumbnail .mini-sachet {
            width: 35px;
            height: 50px;
            background: linear-gradient(135deg, #0A1628 0%, #1a2d4a 50%, #0A1628 100%);
            border-radius: 6px 6px 10px 10px;
        }

        .thumbnail-icon {
            color: var(--flow-gray);
            transition: color 0.3s ease;
        }

        .thumbnail:hover .thumbnail-icon {
            color: var(--flow-cyan);
        }

        /* Product Image Styles */
        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .main-image .product-image-display {
            width: 100%;
            height: 100%;
            object-fit: contain;
            z-index: 2;
            border-radius: 16px;
            max-width: 90%;
            max-height: 90%;
        }

        .main-image video.product-video-display {
            width: 100%;
            height: 100%;
            object-fit: contain;
            z-index: 2;
            border-radius: 16px;
            max-width: 90%;
            max-height: 90%;
        }

        .thumbnail-video-indicator {
            position: absolute;
            bottom: 4px;
            right: 4px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 4px;
            padding: 2px 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .thumbnail-video-indicator svg {
            width: 12px;
            height: 12px;
            stroke: var(--flow-cyan);
        }

        .thumbnail.image-thumb {
            position: relative;
        }

        /* Video thumbnail with play overlay */
        .thumbnail.video-thumb {
            position: relative;
        }

        .thumbnail-video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.2) 50%, transparent 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .thumbnail-video-overlay svg {
            width: 24px;
            height: 24px;
            color: var(--flow-white);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
            transition: transform 0.3s ease;
        }

        .thumbnail.video-thumb:hover .thumbnail-video-overlay {
            background: linear-gradient(to top, rgba(0, 212, 255, 0.6) 0%, rgba(0, 212, 255, 0.2) 50%, transparent 100%);
        }

        .thumbnail.video-thumb:hover .thumbnail-video-overlay svg {
            transform: scale(1.2);
            color: var(--flow-cyan);
        }

        /* Mini Nutrition Chart Preview for Thumbnail */
        .mini-nutrition-preview {
            width: 90%;
            max-width: 80px;
            padding: 4px;
        }

        .mini-nutrition-header {
            text-align: center;
            margin-bottom: 3px;
        }

        .mini-nutrition-header h4 {
            font-family: 'Syne', sans-serif;
            font-size: 6px;
            font-weight: 700;
            color: var(--flow-cyan);
            margin: 0;
        }

        .mini-nutrition-grid {
            background: rgba(13, 26, 45, 0.9);
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid rgba(0, 212, 255, 0.15);
        }

        .mini-nutrition-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            padding: 2px 4px;
            font-size: 5px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.05);
            align-items: center;
        }

        .mini-nutrition-row:last-child {
            border-bottom: none;
        }

        .mini-nutrition-row.header {
            font-weight: 600;
            font-size: 4.5px;
            text-transform: uppercase;
            padding: 3px 4px;
            background: rgba(0, 212, 255, 0.15);
        }

        .mini-nutrition-row.header span {
            color: var(--flow-white);
        }

        .mini-nutrition-row span:first-child {
            color: var(--flow-white);
            text-align: left;
            font-weight: 500;
        }

        .mini-nutrition-row span {
            text-align: right;
            color: var(--flow-gray);
        }

        .thumbnail:hover .mini-nutrition-header h4,
        .thumbnail.active .mini-nutrition-header h4 {
            color: var(--flow-cyan);
        }

        /* Nutrition Chart in Main Image */
        .nutrition-chart-display {
            width: 100%;
            max-width: 380px;
            padding: 0.75rem;
            z-index: 2;
        }

        .nutrition-chart-header {
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .nutrition-chart-header h3 {
            font-family: 'Syne', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.15rem;
        }

        .nutrition-chart-header p {
            color: var(--flow-gray);
            font-size: 0.6rem;
        }

        .nutrition-chart-grid {
            background: rgba(13, 26, 45, 0.9);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(0, 212, 255, 0.15);
        }

        .nutrition-chart-row {
            display: grid;
            grid-template-columns: 1.6fr 1fr 0.7fr;
            padding: 0.35rem 0.6rem;
            font-size: 0.6rem;
            border-bottom: 1px solid rgba(0, 212, 255, 0.05);
            align-items: center;
        }

        .nutrition-chart-row:last-child {
            border-bottom: none;
        }

        .nutrition-chart-row.header {
            font-weight: 600;
            font-size: 0.55rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            padding: 0.4rem 0.6rem;
        }

        .nutrition-chart-row span:first-child {
            color: var(--flow-gray);
            text-align: left;
        }

        .nutrition-chart-row span {
            text-align: right;
        }

        .nutrition-chart-row.header span {
            color: var(--flow-white);
        }

        .nutrition-chart-row .nutrient-name {
            font-weight: 500;
            color: var(--flow-white);
        }

        .nutrition-chart-row .nutrient-sub {
            padding-left: 0.5rem;
            color: var(--flow-gray);
        }

        .nutrition-chart-row .rda-value {
            opacity: 0.8;
        }

        .nutrition-section-divider {
            padding: 0.25rem 0.6rem;
            font-size: 0.5rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        }

        /* Product Info */
        .product-info {
            padding-top: 1rem;
        }

        .product-category {
            color: var(--flow-cyan);
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .product-title {
            font-family: 'Syne', sans-serif;
            font-size: clamp(2rem, 4vw, 2.75rem);
            font-weight: 800;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .product-title span {
            background: var(--gradient-flow);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .stars {
            display: flex;
            gap: 0.25rem;
        }

        .star {
            color: #FFD700;
        }

        .star.empty {
            color: var(--flow-gray);
            opacity: 0.3;
        }

        .rating-text {
            color: var(--flow-gray);
            font-size: 0.9rem;
        }

        .rating-text strong {
            color: var(--flow-white);
        }

        .product-price-section {
            display: flex;
            align-items: baseline;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .price-current {
            font-family: 'Syne', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
        }

        .price-original {
            font-size: 1.25rem;
            color: var(--flow-gray);
            text-decoration: line-through;
        }

        .price-discount {
            background: rgba(239, 68, 68, 0.15);
            color: #EF4444;
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .product-description {
            color: var(--flow-gray);
            font-size: 1.05rem;
            line-height: 1.7;
            margin-bottom: 2rem;
        }

        /* Product Highlights */
        .product-highlights {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .highlight-item {
            background: rgba(13, 26, 45, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 16px;
            padding: 1.25rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .highlight-item:hover {
            border-color: rgba(0, 212, 255, 0.3);
            transform: translateY(-3px);
        }

        .highlight-icon {
            width: 44px;
            height: 44px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.75rem;
            color: var(--flow-cyan);
        }

        .highlight-item h4 {
            font-family: 'Syne', sans-serif;
            font-size: 0.95rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .highlight-item p {
            color: var(--flow-gray);
            font-size: 0.8rem;
        }

        /* Variant Selector */
        .variant-section {
            margin-bottom: 1.5rem;
        }

        .variant-label {
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .variant-label span {
            color: var(--flow-gray);
            font-weight: 400;
        }

        .variant-options {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .variant-option {
            padding: 0.85rem 1.5rem;
            background: rgba(13, 26, 45, 0.6);
            border: 2px solid rgba(0, 212, 255, 0.15);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            min-width: 120px;
        }

        .variant-option:hover {
            border-color: rgba(0, 212, 255, 0.4);
        }

        .variant-option.selected {
            border-color: var(--flow-cyan);
            background: rgba(0, 212, 255, 0.1);
        }

        /* Popular/Best Value Badge */
        .variant-option.popular {
            border-color: rgba(139, 92, 246, 0.6);
            background: rgba(139, 92, 246, 0.08);
            transform: scale(1.02);
        }

        .variant-option.popular.selected {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.15);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        .variant-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
        }

        .variant-badge.best-value {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
        }

        .variant-savings {
            font-size: 0.7rem;
            color: #10b981;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .variant-per-unit {
            font-size: 0.65rem;
            color: var(--flow-gray);
            margin-top: 0.15rem;
            opacity: 0.8;
        }

        .variant-original-price {
            font-size: 0.7rem;
            color: var(--flow-gray);
            text-decoration: line-through;
            opacity: 0.6;
        }

        .variant-option .variant-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .variant-option .variant-price {
            color: var(--flow-gray);
            font-size: 0.85rem;
        }

        .variant-option.selected .variant-price {
            color: var(--flow-cyan);
        }

        .variant-option.popular .variant-price {
            color: #a855f7;
            font-weight: 600;
        }

        .variant-option.popular.selected .variant-price {
            color: #c084fc;
        }

        /* Flavour Selector */
        .flavour-section {
            margin-bottom: 1.5rem;
        }

        .flavour-label {
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .flavour-label span {
            color: var(--flow-gray);
            font-weight: 400;
        }

        .flavour-options {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .flavour-option {
            padding: 0.75rem 1.25rem;
            background: rgba(13, 26, 45, 0.6);
            border: 2px solid rgba(0, 212, 255, 0.15);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .flavour-option:hover {
            border-color: rgba(0, 212, 255, 0.4);
        }

        .flavour-option.selected {
            border-color: var(--flow-cyan);
            background: rgba(0, 212, 255, 0.1);
        }

        .flavour-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .flavour-dot.original {
            background: linear-gradient(135deg, #00D4FF, #00B4B4);
        }

        .flavour-dot.citrus {
            background: linear-gradient(135deg, #FFD93D, #FF9500);
        }

        .flavour-dot.berry {
            background: linear-gradient(135deg, #FF6B9D, #C44569);
        }

        .flavour-dot.tropical {
            background: linear-gradient(135deg, #00D9A5, #00B386);
        }

        .flavour-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* Quantity & Add to Cart */
        .purchase-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(13, 26, 45, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 50px;
            padding: 0.5rem;
        }

        .qty-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background: rgba(0, 212, 255, 0.1);
            color: var(--flow-white);
            font-size: 1.25rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qty-btn:hover {
            background: var(--flow-cyan);
            color: var(--flow-dark);
        }

        .qty-value {
            min-width: 50px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .add-to-cart-btn {
            flex: 1;
            background: var(--flow-cyan);
            color: var(--flow-dark);
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .add-to-cart-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 40px rgba(0, 212, 255, 0.5);
        }

        .buy-now-btn {
            width: 100%;
            background: transparent;
            border: 2px solid var(--flow-cyan);
            color: var(--flow-cyan);
            padding: 1rem 2rem;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .buy-now-btn:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        /* Trust Badges */
        .trust-badges {
            display: flex;
            gap: 1.5rem;
            padding: 1.5rem;
            background: rgba(13, 26, 45, 0.4);
            border-radius: 16px;
            border: 1px solid rgba(0, 212, 255, 0.1);
        }

        .trust-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--flow-gray);
            font-size: 0.85rem;
        }

        .trust-badge svg {
            color: var(--flow-cyan);
        }

        /* Product Details Tabs */
        .product-details-section {
            padding: 4rem 8%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tabs-header {
            display: flex;
            gap: 0.5rem;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
            margin-bottom: 2rem;
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            color: var(--flow-gray);
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-btn:hover {
            color: var(--flow-white);
        }

        .tab-btn.active {
            color: var(--flow-cyan);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--flow-cyan);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ingredients Tab */
        .ingredients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .ingredient-card {
            background: rgba(13, 26, 45, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 20px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .ingredient-card:hover {
            border-color: rgba(0, 212, 255, 0.3);
            transform: translateY(-3px);
        }

        .ingredient-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .ingredient-icon {
            width: 48px;
            height: 48px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--flow-cyan);
        }

        .ingredient-card h4 {
            font-family: 'Syne', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .ingredient-card p {
            color: var(--flow-gray);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Nutrition Tab */
        .nutrition-table {
            background: rgba(13, 26, 45, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            max-width: 500px;
        }

        .nutrition-header {
            background: rgba(0, 212, 255, 0.1);
            padding: 1rem 1.5rem;
            font-family: 'Syne', sans-serif;
            font-weight: 700;
        }

        .nutrition-row {
            display: flex;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(0, 212, 255, 0.05);
        }

        .nutrition-row:last-child {
            border-bottom: none;
        }

        .nutrition-row span:first-child {
            color: var(--flow-gray);
        }

        .nutrition-row span:last-child {
            font-weight: 600;
        }

        /* Reviews Tab */
        .reviews-summary {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 2.5rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.05) 0%, rgba(13, 26, 45, 0.8) 100%);
            border: 1px solid rgba(0, 212, 255, 0.15);
            border-radius: 20px;
        }

        .rating-big {
            text-align: center;
            padding: 1rem 2rem;
        }

        .rating-number {
            font-family: 'Syne', sans-serif;
            font-size: 4.5rem;
            font-weight: 800;
            line-height: 1;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .rating-big .stars {
            justify-content: center;
            margin: 0.75rem 0;
            gap: 4px;
        }

        .rating-big p {
            color: var(--flow-gray);
            font-size: 0.95rem;
            margin-top: 0.5rem;
        }

        .rating-bars {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 0.5rem;
        }

        .rating-bar-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .rating-bar-label {
            width: 55px;
            font-size: 0.85rem;
            color: var(--flow-gray);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .rating-bar-label svg {
            width: 12px;
            height: 12px;
            fill: #FFD700;
        }

        .rating-bar-bg {
            flex: 1;
            height: 10px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            overflow: hidden;
        }

        .rating-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .rating-bar-count {
            width: 35px;
            font-size: 0.85rem;
            color: var(--flow-gray);
            text-align: right;
        }

        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        }

        .reviews-title {
            font-family: 'Syne', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
        }

        .reviews-filter {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: var(--flow-gray);
            font-size: 0.85rem;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover, .filter-btn.active {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.3);
            color: var(--flow-cyan);
        }

        .reviews-list {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .review-card {
            background: linear-gradient(135deg, rgba(13, 26, 45, 0.8) 0%, rgba(13, 26, 45, 0.5) 100%);
            border: 1px solid rgba(0, 212, 255, 0.08);
            border-radius: 20px;
            padding: 1.75rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .review-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--flow-cyan), var(--flow-teal));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .review-card:hover {
            border-color: rgba(0, 212, 255, 0.2);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 60px rgba(0, 212, 255, 0.05);
        }

        .review-card:hover::before {
            opacity: 1;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .reviewer-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .reviewer-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.25) 0%, rgba(0, 180, 180, 0.15) 100%);
            border: 2px solid rgba(0, 212, 255, 0.2);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            color: var(--flow-cyan);
            flex-shrink: 0;
        }

        .reviewer-details {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .reviewer-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--flow-white);
            letter-spacing: -0.01em;
        }

        .review-meta {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .review-date {
            color: var(--flow-gray);
            font-size: 0.8rem;
        }

        .review-stars {
            display: flex;
            gap: 3px;
        }

        .review-stars svg {
            width: 16px;
            height: 16px;
            filter: drop-shadow(0 1px 2px rgba(255, 215, 0, 0.3));
        }

        .review-body {
            background: rgba(0, 0, 0, 0.15);
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .review-title {
            font-weight: 600;
            font-size: 1.05rem;
            margin-bottom: 0.65rem;
            color: var(--flow-white);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .review-title::before {
            content: '"';
            color: var(--flow-cyan);
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1;
            opacity: 0.5;
        }

        .review-content {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.75;
            font-size: 0.95rem;
        }

        .review-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .review-tag {
            padding: 0.4rem 0.85rem;
            background: rgba(0, 212, 255, 0.06);
            border: 1px solid rgba(0, 212, 255, 0.12);
            border-radius: 8px;
            font-size: 0.75rem;
            color: rgba(0, 212, 255, 0.9);
            transition: all 0.2s ease;
        }

        .review-tag:hover {
            background: rgba(0, 212, 255, 0.12);
            border-color: rgba(0, 212, 255, 0.25);
        }

        .review-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
        }

        .verified-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.85rem;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 8px;
            color: #10B981;
            font-size: 0.78rem;
            font-weight: 500;
        }

        .verified-badge svg {
            flex-shrink: 0;
        }

        .helpful-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            color: var(--flow-gray);
            font-size: 0.82rem;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .helpful-btn svg {
            width: 16px;
            height: 16px;
        }

        .helpful-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.25);
            color: var(--flow-cyan);
        }

        .helpful-btn.active {
            background: rgba(0, 212, 255, 0.15);
            border-color: rgba(0, 212, 255, 0.3);
            color: var(--flow-cyan);
        }

        .helpful-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.3);
            color: var(--flow-cyan);
        }

        .helpful-btn svg {
            width: 14px;
            height: 14px;
        }

        .load-more-reviews {
            display: flex;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .load-more-btn {
            padding: 0.85rem 2rem;
            background: transparent;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 30px;
            color: var(--flow-cyan);
            font-size: 0.9rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .load-more-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--flow-cyan);
        }

        /* Related Products */
        .related-section {
            padding: 4rem 8%;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-header h2 {
            font-family: 'Syne', sans-serif;
            font-size: clamp(1.75rem, 4vw, 2.25rem);
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .section-header p {
            color: var(--flow-gray);
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .related-card {
            background: linear-gradient(145deg, rgba(13, 26, 45, 0.8) 0%, rgba(13, 26, 45, 0.4) 100%);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.4s ease;
            color: inherit;
            display: flex;
            flex-direction: column;
        }

        .related-card:hover {
            transform: translateY(-8px);
            border-color: rgba(0, 212, 255, 0.4);
            box-shadow: 0 20px 60px rgba(0, 212, 255, 0.15);
        }

        .related-image {
            height: 200px;
            background: linear-gradient(180deg, rgba(0, 212, 255, 0.05) 0%, transparent 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: inherit;
        }

        .related-image .mini-sachet {
            width: 70px;
            height: 100px;
            background: linear-gradient(135deg, #0A1628 0%, #1a2d4a 50%, #0A1628 100%);
            border-radius: 10px 10px 16px 16px;
            box-shadow: 0 15px 40px rgba(0, 212, 255, 0.2);
        }

        .related-info {
            padding: 1.25rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .related-info h4 {
            font-family: 'Syne', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .related-info .price {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            color: var(--flow-cyan);
        }

        /* Footer */
        footer {
            padding: 4rem 8% 2rem;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
            margin-top: 4rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 2.5rem;
            max-width: 1400px;
            margin: 0 auto 3rem;
        }

        .footer-brand .logo {
            margin-bottom: 1rem;
            display: inline-block;
        }

        .footer-brand .logo-img {
            height: 70px;
        }

        .footer-brand p {
            color: var(--flow-gray);
            font-size: 0.9rem;
            max-width: 300px;
        }

        .footer-column h4 {
            font-family: 'Syne', sans-serif;
            font-size: 1rem;
            margin-bottom: 1.25rem;
            color: var(--flow-white);
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column li {
            margin-bottom: 0.75rem;
        }

        .footer-column a {
            color: var(--flow-gray);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .footer-column a:hover {
            color: var(--flow-cyan);
        }

        .footer-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 1400px;
            margin: 0 auto;
        }

        .footer-bottom p {
            color: var(--flow-gray);
            font-size: 0.85rem;
        }

        .footer-contact a {
            color: var(--flow-gray);
            text-decoration: none;
            font-size: 0.85rem;
            transition: color 0.3s ease;
        }

        .footer-contact a:hover {
            color: var(--flow-cyan);
        }

        .social-links {
            display: flex;
            gap: 1rem;
        }

        .social-links a {
            width: 40px;
            height: 40px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--flow-gray);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .social-links a:hover {
            background: var(--flow-cyan);
            color: var(--flow-dark);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--flow-card);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 1rem 2rem;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 3000;
            opacity: 0;
            transition: all 0.4s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            background: var(--flow-cyan);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--flow-dark);
            font-size: 0.8rem;
        }

        /* FAQ Section */
        .faq-section {
            padding: 4rem 8%;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
        }

        .faq-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .faq-item {
            background: rgba(13, 26, 45, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 16px;
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .faq-item:hover {
            border-color: rgba(0, 212, 255, 0.3);
        }

        .faq-item.active {
            border-color: var(--flow-cyan);
        }

        .faq-question {
            width: 100%;
            padding: 1.25rem 1.5rem;
            background: none;
            border: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            text-align: left;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--flow-white);
            transition: all 0.3s ease;
        }

        .faq-question:hover {
            color: var(--flow-cyan);
        }

        .faq-icon {
            color: var(--flow-cyan);
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }

        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }

        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .faq-item.active .faq-answer {
            max-height: 300px;
        }

        .faq-answer p {
            padding: 0 1.5rem 1.25rem;
            color: var(--flow-gray);
            line-height: 1.7;
            font-size: 0.95rem;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .product-container {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .product-gallery {
                position: static;
            }

            .main-image {
                height: 400px;
            }

            .product-highlights {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            nav {
                padding: 1rem 5%;
            }

            .nav-links {
                display: none;
            }

            .breadcrumb {
                padding: 6rem 5% 1rem;
            }

            .product-container {
                padding: 1rem 5% 4rem;
            }

            .product-highlights {
                grid-template-columns: 1fr;
            }

            .purchase-section {
                flex-direction: column;
            }

            .trust-badges {
                flex-wrap: wrap;
            }

            .reviews-summary {
                flex-direction: column;
                gap: 2rem;
            }

            .footer-content {
                grid-template-columns: 1fr 1fr;
            }

            .footer-bottom {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .main-image {
                height: 320px;
            }

            .sachet-visual-large {
                width: 140px;
                height: 200px;
            }

            .thumbnail-row {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
            }

            .thumbnail {
                height: 70px;
            }

            .tabs-header {
                overflow-x: auto;
                padding-bottom: 0.5rem;
            }

            .tab-btn {
                white-space: nowrap;
            }

            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: transparent;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            z-index: 1001;
        }

        .mobile-menu-toggle span {
            display: block;
            width: 24px;
            height: 2px;
            background: var(--flow-white);
            margin: 5px 0;
            transition: all 0.3s ease;
        }

        /* Mobile Menu Overlay */
        .mobile-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 998;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-menu-overlay.active {
            display: block;
            opacity: 1;
        }

        /* Mobile Menu */
        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            right: -100%;
            width: 280px;
            height: 100%;
            background: var(--flow-blue);
            z-index: 999;
            padding: 5rem 1.5rem 2rem;
            transition: right 0.3s ease;
            overflow-y: auto;
        }

        .mobile-menu.active {
            right: 0;
        }

        .mobile-menu-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: none;
            color: var(--flow-white);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .mobile-nav-links {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .mobile-nav-links li {
            margin-bottom: 1rem;
        }

        .mobile-nav-links a {
            display: block;
            padding: 1rem;
            color: var(--flow-white);
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .mobile-nav-links a:hover,
        .mobile-nav-links a.active {
            background: rgba(0, 212, 255, 0.1);
            color: var(--flow-cyan);
        }

        /* Mobile Bottom Navigation */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10, 22, 40, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 212, 255, 0.1);
            padding: 0.5rem 0;
            padding-bottom: calc(0.5rem + env(safe-area-inset-bottom));
            z-index: 1000;
            justify-content: space-around;
        }

        .mobile-bottom-nav .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem 1rem;
            color: var(--flow-gray);
            text-decoration: none;
            font-size: 0.7rem;
            font-weight: 500;
            transition: color 0.3s ease;
            position: relative;
            background: transparent;
            border: none;
            cursor: pointer;
        }

        .mobile-bottom-nav .nav-item svg {
            width: 22px;
            height: 22px;
        }

        .mobile-bottom-nav .nav-item.active,
        .mobile-bottom-nav .nav-item:hover {
            color: var(--flow-cyan);
        }

        .mobile-bottom-nav .cart-nav-item {
            position: relative;
        }

        .mobile-cart-count {
            position: absolute;
            top: 2px;
            right: 8px;
            background: var(--flow-cyan);
            color: var(--flow-dark);
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 700;
        }

        /* Sticky Add to Cart for Mobile */
        .mobile-sticky-cart {
            display: none;
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            background: rgba(10, 22, 40, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 212, 255, 0.1);
            padding: 1rem;
            z-index: 999;
        }

        .mobile-sticky-cart .sticky-cart-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .mobile-sticky-cart .sticky-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--flow-white);
        }

        .mobile-sticky-cart .sticky-add-btn {
            flex: 1;
            max-width: 200px;
            padding: 0.875rem 1.5rem;
            background: var(--gradient-flow);
            border: none;
            border-radius: 50px;
            color: var(--flow-white);
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .mobile-sticky-cart .sticky-add-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.4);
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }

            .mobile-menu {
                display: block;
            }

            .mobile-bottom-nav {
                display: flex;
            }

            .mobile-sticky-cart {
                display: block;
            }

            .nav-right .profile-btn {
                display: none;
            }

            body {
                padding-bottom: 140px;
            }

            .product-container {
                padding-bottom: 2rem;
            }

            .add-to-cart-section {
                display: none;
            }
        }

        /* ============ CART DRAWER ============ */
        .cart-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .cart-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .cart-drawer {
            position: fixed;
            top: 0;
            right: -420px;
            width: 420px;
            max-width: 100%;
            height: 100%;
            background: var(--flow-blue);
            z-index: 2001;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }

        .cart-drawer.open {
            right: 0;
        }

        .cart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        }

        .cart-header h2 {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cart-header h2 svg {
            width: 20px;
            height: 20px;
            color: var(--flow-cyan);
        }

        .cart-close {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: var(--flow-white);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .cart-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 16px 20px;
        }

        .cart-empty {
            text-align: center;
            padding: 60px 20px;
            color: var(--flow-gray);
        }

        .cart-empty svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .cart-empty p {
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .cart-empty a {
            color: var(--flow-cyan);
            text-decoration: none;
        }

        .cart-item {
            display: flex;
            gap: 12px;
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .cart-item-image {
            width: 70px;
            height: 70px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
        }

        .cart-item-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .cart-item-details {
            flex: 1;
            min-width: 0;
        }

        .cart-item-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .cart-item-variant {
            font-size: 12px;
            color: var(--flow-gray);
            margin-bottom: 8px;
        }

        .cart-item-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .cart-qty-control {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 4px;
        }

        .cart-qty-btn {
            width: 28px;
            height: 28px;
            background: none;
            border: none;
            color: var(--flow-cyan);
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .cart-qty-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            border-radius: 6px;
        }

        .cart-qty-value {
            min-width: 24px;
            text-align: center;
            font-weight: 600;
        }

        .cart-item-price {
            font-weight: 700;
            color: var(--flow-cyan);
            font-size: 15px;
        }

        .cart-footer {
            padding: 20px;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
            background: rgba(2, 8, 23, 0.5);
        }

        .shipping-progress {
            margin-bottom: 16px;
        }

        .shipping-text {
            font-size: 13px;
            color: var(--flow-gray);
            margin-bottom: 8px;
        }

        .shipping-text span {
            color: var(--flow-cyan);
            font-weight: 600;
        }

        .shipping-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .shipping-bar-fill {
            height: 100%;
            background: var(--gradient-flow);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .cart-totals {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 16px;
        }

        .cart-row {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }

        .cart-row.total {
            font-size: 18px;
            font-weight: 700;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cart-checkout-btn {
            width: 100%;
            padding: 16px;
            background: var(--gradient-flow);
            border: none;
            border-radius: 14px;
            color: var(--flow-white);
            font-size: 16px;
            font-weight: 600;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cart-checkout-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
        }

        /* Discount Code Section */
        .cart-discount-section {
            margin-bottom: 16px;
        }

        .cart-discount-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .cart-discount-input-wrapper {
            flex: 1;
            min-width: 0;
            position: relative;
            display: flex;
            align-items: center;
        }

        .cart-discount-input-icon {
            position: absolute;
            left: 12px;
            width: 14px;
            height: 14px;
            stroke: var(--flow-cyan);
            pointer-events: none;
        }

        .cart-discount-row input {
            width: 100%;
            padding: 12px 14px 12px 36px;
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 10px;
            color: var(--flow-white);
            font-size: 13px;
            font-family: inherit;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .cart-discount-row input::placeholder {
            color: var(--flow-gray);
            text-transform: none;
            letter-spacing: normal;
        }

        .cart-discount-row input:focus {
            outline: none;
            border-color: var(--flow-cyan);
        }

        .cart-discount-row input.error {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            animation: shake 0.4s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .cart-apply-btn {
            padding: 12px 16px;
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            color: var(--flow-cyan);
            font-size: 13px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .cart-apply-btn:hover {
            background: rgba(0, 212, 255, 0.25);
        }

        .cart-apply-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .cart-discount-error {
            font-size: 12px;
            color: #FF6B6B;
            margin-top: 6px;
            display: none;
        }

        .cart-applied-discount {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            background: rgba(0, 180, 100, 0.1);
            border: 1px solid rgba(0, 180, 100, 0.3);
            border-radius: 10px;
        }

        .cart-applied-discount .discount-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cart-applied-discount .discount-info svg {
            width: 16px;
            height: 16px;
            color: #00B464;
        }

        .cart-applied-discount .discount-code {
            font-size: 12px;
            font-weight: 600;
            color: #00B464;
            text-transform: uppercase;
        }

        .cart-applied-discount .discount-value {
            font-size: 12px;
            color: var(--flow-gray);
            margin-left: 6px;
        }

        .cart-applied-discount .remove-discount {
            background: none;
            border: none;
            color: var(--flow-gray);
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s ease;
        }

        .cart-applied-discount .remove-discount:hover {
            color: #FF6B6B;
        }

        .cart-row.discount {
            color: #10B981;
        }

        @media (max-width: 480px) {
            .cart-drawer {
                width: 100%;
                right: -100%;
            }
        }
    </style>
</head>
<body>
    <div class="water-bg"></div>

    <!-- Navigation -->
    <nav>
        <a href="/" class="logo">
            <img src="logo.png" alt="Flow" class="logo-img">
        </a>
        <ul class="nav-links">
            <li><a href="/">Home</a></li>
            <li><a href="/shop/" class="active">Shop</a></li>
            <li><a href="/#shop">Best Sellers</a></li>
            <li><a href="/#ingredients">Ingredients</a></li>
            <li><a href="/#benefits">Benefits</a></li>
            <li><a href="/#faq">FAQ</a></li>
        </ul>
        <div class="nav-right">
            <button class="cart-btn" id="cartToggle">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="21" r="1"/>
                    <circle cx="20" cy="21" r="1"/>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                </svg>
                <span class="cart-text">Cart</span>
                <span class="cart-count" id="cartCount">0</span>
            </button>
            <a href="/profile/" class="profile-btn" aria-label="Profile">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                <span class="profile-text">Profile</span>
            </a>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" onclick="closeMobileMenu()"></div>
    
    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <button class="mobile-menu-close" onclick="closeMobileMenu()">Ã—</button>
        <ul class="mobile-nav-links">
            <li><a href="/">Home</a></li>
            <li><a href="/shop/" class="active">Shop</a></li>
            <li><a href="/#shop">Best Sellers</a></li>
            <li><a href="/#ingredients">Ingredients</a></li>
            <li><a href="/#benefits">Benefits</a></li>
            <li><a href="/#faq">FAQ</a></li>
            <li><a href="/profile/">My Profile</a></li>
        </ul>
    </div>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <a href="/">Home</a>
        <span>/</span>
        <a href="/shop/">Shop</a>
        <span>/</span>
        <span class="current">Flow Original 30-Pack</span>
    </div>

    <!-- Product Container -->
    <div class="product-container">
        <!-- Product Gallery -->
        <div class="product-gallery">
            <div class="main-image">
                <span class="product-badge">Bestseller</span>
                <div class="sachet-visual-large">
                    <div class="sachet-content-large">
                        <div class="sachet-logo-large">Flow</div>
                        <div class="sachet-flavor-large">Original</div>
                    </div>
                </div>
            </div>
            <div class="thumbnail-row">
                <div class="thumbnail active" data-view="product" onclick="switchMainView('product')">
                    <div class="mini-sachet"></div>
                </div>
                <div class="thumbnail" data-view="ingredients" onclick="switchMainView('ingredients')">
                    <svg class="thumbnail-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                    </svg>
                </div>
                <div class="thumbnail" data-view="benefits" onclick="switchMainView('benefits')">
                    <svg class="thumbnail-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                    </svg>
                </div>
                <div class="thumbnail" data-view="nutrition" onclick="switchMainView('nutrition')">
                    <div class="mini-nutrition-preview">
                        <div class="mini-nutrition-header">
                            <h4>Nutrition Facts</h4>
                        </div>
                        <div class="mini-nutrition-grid">
                            <div class="mini-nutrition-row header"><span>Nutrient</span><span>Amt</span></div>
                            <div class="mini-nutrition-row"><span>Energy</span><span>37kcal</span></div>
                            <div class="mini-nutrition-row"><span>Sodium</span><span>430mg</span></div>
                            <div class="mini-nutrition-row"><span>Potassium</span><span>150mg</span></div>
                            <div class="mini-nutrition-row"><span>Vitamins</span><span>A-K</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Info -->
        <div class="product-info">
            <div class="product-category">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                </svg>
                Multi-Pack
            </div>
            <h1 class="product-title">Flow Original <span>30-Pack</span></h1>
            
            <div class="product-rating">
                <div class="stars">
                    <svg class="star" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    <svg class="star" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    <svg class="star" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    <svg class="star" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    <svg class="star" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                </div>
                <span class="rating-text"><strong>4.9</strong> (234 reviews)</span>
            </div>

            <div class="product-price-section">
                <span class="price-current">â‚¹1,499</span>
                <span class="price-original">â‚¹1,799</span>
                <span class="price-discount">Save 17%</span>
            </div>

            <!-- Quantity & Add to Cart -->
            <div class="purchase-section">
                <div class="quantity-selector">
                    <button class="qty-btn" onclick="updateQty(-1)">âˆ’</button>
                    <span class="qty-value" id="qtyValue">1</span>
                    <button class="qty-btn" onclick="updateQty(1)">+</button>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                    </svg>
                    Add to Cart â€” â‚¹1,499
                </button>
            </div>

            <button class="buy-now-btn" onclick="buyNow()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                </svg>
                Buy Now
            </button>

            <!-- Flavour Selector -->
            <div class="flavour-section">
                <div class="flavour-label">Flavour: <span>Original</span></div>
                <div class="flavour-options">
                    <div class="flavour-option selected" data-flavour="original">
                        <div class="flavour-dot original"></div>
                        <span class="flavour-name">Original</span>
                    </div>
                    <div class="flavour-option" data-flavour="citrus">
                        <div class="flavour-dot citrus"></div>
                        <span class="flavour-name">Citrus Burst</span>
                    </div>
                    <div class="flavour-option" data-flavour="berry">
                        <div class="flavour-dot berry"></div>
                        <span class="flavour-name">Berry Blast</span>
                    </div>
                    <div class="flavour-option" data-flavour="tropical">
                        <div class="flavour-dot tropical"></div>
                        <span class="flavour-name">Tropical Surge</span>
                    </div>
                </div>
            </div>

            <!-- Pack Size Selector -->
            <div class="variant-section">
                <div class="variant-label">Pack Size: <span>30 Sachets</span></div>
                <div class="variant-options">
                    <div class="variant-option">
                        <div class="variant-name">10-Pack</div>
                        <div class="variant-price">â‚¹549</div>
                    </div>
                    <div class="variant-option selected">
                        <div class="variant-name">30-Pack</div>
                        <div class="variant-price">â‚¹1,499</div>
                    </div>
                    <div class="variant-option">
                        <div class="variant-name">60-Pack</div>
                        <div class="variant-price">â‚¹2,699</div>
                    </div>
                </div>
            </div>

            <p class="product-description">
                Our signature electrolyte blend with the perfect balance of sodium, potassium, and magnesium. 
                Just 6.9g glucose for quick energy, zero artificial sweeteners. Each sachet mixes instantly with 500ml of water 
                for clean, refreshing hydration that powers your day.
            </p>

            <!-- Product Highlights -->
            <div class="product-highlights">
                <div class="highlight-item">
                    <div class="highlight-icon">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                        </svg>
                    </div>
                    <h4>Low Sugar</h4>
                    <p>Clean hydration</p>
                </div>
                <div class="highlight-item">
                    <div class="highlight-icon">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                    </div>
                    <h4>Instant Energy</h4>
                    <p>Fast absorption</p>
                </div>
                <div class="highlight-item">
                    <div class="highlight-icon">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                    </div>
                    <h4>Lab Tested</h4>
                    <p>Quality assured</p>
                </div>
            </div>

            <!-- Trust Badges -->
            <div class="trust-badges">
                <div class="trust-badge">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="1" y="3" width="15" height="13" rx="2"/><path d="M16 8h4l3 3v5h-7V8z"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/>
                    </svg>
                    Free shipping over â‚¹999
                </div>
                <div class="trust-badge">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    Secure checkout
                </div>
                <div class="trust-badge">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                    Made with love in India
                </div>
            </div>
        </div>
    </div>

    <!-- Product Details Tabs -->
    <div class="product-details-section">
        <div class="tabs-header">
            <button class="tab-btn" data-tab="ingredients">Ingredients</button>
            <button class="tab-btn" data-tab="how-to-use">How to Use</button>
            <button class="tab-btn active" data-tab="reviews">Reviews</button>
        </div>

        <!-- Ingredients Tab -->
        <div class="tab-content" id="ingredients">
            <div class="ingredients-grid">
                <div class="ingredient-card">
                    <div class="ingredient-header">
                        <div class="ingredient-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                            </svg>
                        </div>
                        <h4>Sodium</h4>
                    </div>
                    <p>Essential for fluid balance and nerve function. Helps replace electrolytes lost through sweat during physical activity.</p>
                </div>
                <div class="ingredient-card">
                    <div class="ingredient-header">
                        <div class="ingredient-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                            </svg>
                        </div>
                        <h4>Potassium</h4>
                    </div>
                    <p>Supports muscle function and heart health. Works with sodium to maintain proper cellular fluid balance.</p>
                </div>
                <div class="ingredient-card">
                    <div class="ingredient-header">
                        <div class="ingredient-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
                            </svg>
                        </div>
                        <h4>Magnesium</h4>
                    </div>
                    <p>Crucial for energy production and muscle recovery. Helps reduce fatigue and supports over 300 enzymatic reactions.</p>
                </div>
                <div class="ingredient-card">
                    <div class="ingredient-header">
                        <div class="ingredient-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                        </div>
                        <h4>Zinc</h4>
                    </div>
                    <p>Supports immune function and protein synthesis. Essential for athletic recovery and overall wellness.</p>
                </div>
            </div>
        </div>

        <!-- How to Use Tab -->
        <div class="tab-content" id="how-to-use">
            <div class="ingredients-grid">
                <div class="ingredient-card">
                    <div class="ingredient-header">
                        <div class="ingredient-icon" style="background: rgba(0, 212, 255, 0.2);">
                            <span style="font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.1rem;">1</span>
                        </div>
                        <h4>Pour</h4>
                    </div>
                    <p>Empty one Flow sachet into 500ml (16oz) of cold water. Works with still or sparkling water.</p>
                </div>
                <div class="ingredient-card">
                    <div class="ingredient-header">
                        <div class="ingredient-icon" style="background: rgba(0, 212, 255, 0.2);">
                            <span style="font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.1rem;">2</span>
                        </div>
                        <h4>Mix</h4>
                    </div>
                    <p>Stir or shake until fully dissolved. Our formula mixes instantly with no gritty texture.</p>
                </div>
                <div class="ingredient-card">
                    <div class="ingredient-header">
                        <div class="ingredient-icon" style="background: rgba(0, 212, 255, 0.2);">
                            <span style="font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.1rem;">3</span>
                        </div>
                        <h4>Drink</h4>
                    </div>
                    <p>Enjoy anytime â€” morning, pre/post workout, or whenever you need optimal hydration.</p>
                </div>
            </div>
        </div>

        <!-- Reviews Tab -->
        <div class="tab-content active" id="reviews">
            <div class="reviews-summary">
                <div class="rating-big">
                    <div class="rating-number">4.9</div>
                    <div class="stars">
                        <svg class="star" width="22" height="22" viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                        <svg class="star" width="22" height="22" viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                        <svg class="star" width="22" height="22" viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                        <svg class="star" width="22" height="22" viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                        <svg class="star" width="22" height="22" viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    </div>
                    <p>Based on 234 reviews</p>
                </div>
                <div class="rating-bars">
                    <div class="rating-bar-row">
                        <span class="rating-bar-label">5 <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></span>
                        <div class="rating-bar-bg"><div class="rating-bar-fill" style="width: 85%"></div></div>
                        <span class="rating-bar-count">199</span>
                    </div>
                    <div class="rating-bar-row">
                        <span class="rating-bar-label">4 <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></span>
                        <div class="rating-bar-bg"><div class="rating-bar-fill" style="width: 10%"></div></div>
                        <span class="rating-bar-count">23</span>
                    </div>
                    <div class="rating-bar-row">
                        <span class="rating-bar-label">3 <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></span>
                        <div class="rating-bar-bg"><div class="rating-bar-fill" style="width: 3%"></div></div>
                        <span class="rating-bar-count">8</span>
                    </div>
                    <div class="rating-bar-row">
                        <span class="rating-bar-label">2 <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></span>
                        <div class="rating-bar-bg"><div class="rating-bar-fill" style="width: 1%"></div></div>
                        <span class="rating-bar-count">3</span>
                    </div>
                    <div class="rating-bar-row">
                        <span class="rating-bar-label">1 <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></span>
                        <div class="rating-bar-bg"><div class="rating-bar-fill" style="width: 0.5%"></div></div>
                        <span class="rating-bar-count">1</span>
                    </div>
                </div>
            </div>

            <!-- Reviews Header with Filters -->
            <div class="reviews-header">
                <h3 class="reviews-title">Customer Reviews</h3>
                <div class="reviews-filter">
                    <button class="filter-btn active">All</button>
                    <button class="filter-btn">5 Star</button>
                    <button class="filter-btn">With Photos</button>
                </div>
            </div>

            <!-- Review Cards -->
            <div class="reviews-list">
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">RK</div>
                            <div class="reviewer-details">
                                <div class="reviewer-name">Rahul Kumar</div>
                                <div class="review-meta">
                                    <div class="review-stars">
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                    </div>
                                    <span class="review-date">January 15, 2026</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="review-body">
                        <h4 class="review-title">Game changer for morning runs!</h4>
                        <p class="review-content">I've tried many electrolyte drinks but Flow is the cleanest tasting one. No artificial sweetness, just pure hydration. The 30-pack is great value and lasts me a whole month.</p>
                    </div>
                    <div class="review-tags">
                        <span class="review-tag">ðŸƒ Great for Running</span>
                        <span class="review-tag">ðŸ’§ Clean Taste</span>
                        <span class="review-tag">ðŸ’° Good Value</span>
                    </div>
                    <div class="review-footer">
                        <div class="verified-badge">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            Verified Purchase
                        </div>
                        <button class="helpful-btn" onclick="markHelpful(this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>
                            Helpful (24)
                        </button>
                    </div>
                </div>

                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">PS</div>
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">PS</div>
                            <div class="reviewer-details">
                                <div class="reviewer-name">Priya Sharma</div>
                                <div class="review-meta">
                                    <div class="review-stars">
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                    </div>
                                    <span class="review-date">January 10, 2026</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="review-body">
                        <h4 class="review-title">Perfect for yoga sessions</h4>
                        <p class="review-content">Finally an electrolyte powder that doesn't have any sugar or weird aftertaste. I use it during my yoga sessions and it keeps me energized without any crash. The subtle flavor is perfect - not too sweet, not too bland.</p>
                    </div>
                    <div class="review-tags">
                        <span class="review-tag">ðŸ§˜ Yoga Friendly</span>
                        <span class="review-tag">ðŸš« No Sugar</span>
                        <span class="review-tag">âš¡ Energy Boost</span>
                    </div>
                    <div class="review-footer">
                        <div class="verified-badge">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            Verified Purchase
                        </div>
                        <button class="helpful-btn" onclick="markHelpful(this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>
                            Helpful (18)
                        </button>
                    </div>
                </div>

                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">AM</div>
                            <div class="reviewer-details">
                                <div class="reviewer-name">Arjun Mehta</div>
                                <div class="review-meta">
                                    <div class="review-stars">
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="rgba(255,255,255,0.2)"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                    </div>
                                    <span class="review-date">January 5, 2026</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="review-body">
                        <h4 class="review-title">Great for long cycling rides</h4>
                        <p class="review-content">Great product for cycling. I've noticed better endurance on longer rides. Only wish they had more flavor options. The original is good but variety would be nice. Still giving 4 stars because it really works!</p>
                    </div>
                    <div class="review-tags">
                        <span class="review-tag">ðŸš´ Cycling</span>
                        <span class="review-tag">ðŸ’ª Endurance</span>
                    </div>
                    <div class="review-footer">
                        <div class="verified-badge">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            Verified Purchase
                        </div>
                        <button class="helpful-btn" onclick="markHelpful(this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>
                            Helpful (12)
                        </button>
                    </div>
                </div>

                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">SK</div>
                            <div class="reviewer-details">
                                <div class="reviewer-name">Sneha Kapoor</div>
                                <div class="review-meta">
                                    <div class="review-stars">
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        <svg viewBox="0 0 24 24" fill="#FFD700"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                    </div>
                                    <span class="review-date">December 28, 2025</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="review-body">
                        <h4 class="review-title">My daily wellness essential</h4>
                        <p class="review-content">Started using Flow 3 months ago and it's become part of my daily routine. I mix it with my morning water and feel more hydrated throughout the day. The electrolyte balance is perfect - no bloating like other brands.</p>
                    </div>
                    <div class="review-tags">
                        <span class="review-tag">â˜€ï¸ Daily Use</span>
                        <span class="review-tag">ðŸ’§ Stays Hydrated</span>
                        <span class="review-tag">âœ¨ No Bloating</span>
                    </div>
                    <div class="review-footer">
                        <div class="verified-badge">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            Verified Purchase
                        </div>
                        <button class="helpful-btn" onclick="markHelpful(this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>
                            Helpful (31)
                        </button>
                    </div>
                </div>
            </div>

            <div class="load-more-reviews">
                <button class="load-more-btn">Load More Reviews</button>
            </div>
        </div>
    </div>

    <!-- Related Products -->
    <section class="related-section">
        <div class="section-header">
            <h2>You May Also Like</h2>
            <p>Complete your hydration routine</p>
        </div>
        <div class="related-grid" id="relatedProductsGrid">
            <!-- Dynamically loaded from server -->
        </div>
    </section>

    <!-- FAQs Section -->
    <section class="faq-section">
        <div class="section-header">
            <h2>Frequently Asked Questions</h2>
            <p>Everything you need to know about Flow Hydration</p>
        </div>
        <div class="faq-container">
            <div class="faq-item">
                <button class="faq-question" onclick="toggleFaq(this)">
                    <span>How do I use Flow Hydration sachets?</span>
                    <svg class="faq-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
                <div class="faq-answer">
                    <p>Simply tear open the sachet and pour the contents into 500ml of water. Stir or shake well until fully dissolved. Enjoy chilled for the best taste!</p>
                </div>
            </div>
            <div class="faq-item">
                <button class="faq-question" onclick="toggleFaq(this)">
                    <span>When is the best time to drink Flow?</span>
                    <svg class="faq-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
                <div class="faq-answer">
                    <p>Flow is perfect before, during, or after physical activity. You can also use it first thing in the morning to kickstart your hydration, during long work sessions, or any time you need to replenish electrolytes.</p>
                </div>
            </div>
            <div class="faq-item">
                <button class="faq-question" onclick="toggleFaq(this)">
                    <span>Does Flow Hydration contain sugar?</span>
                    <svg class="faq-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
                <div class="faq-answer">
                    <p>Flow contains 6.9g of glucose per sachet for quick energy absorption. We use zero artificial sweeteners - just natural flavoring to create a refreshing taste that fuels your performance.</p>
                </div>
            </div>
            <div class="faq-item">
                <button class="faq-question" onclick="toggleFaq(this)">
                    <span>How many sachets can I consume per day?</span>
                    <svg class="faq-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
                <div class="faq-answer">
                    <p>We recommend 1-3 sachets per day depending on your activity level and hydration needs. Athletes and those with high physical demands may benefit from more frequent use.</p>
                </div>
            </div>
            <div class="faq-item">
                <button class="faq-question" onclick="toggleFaq(this)">
                    <span>What electrolytes are in Flow?</span>
                    <svg class="faq-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
                <div class="faq-answer">
                    <p>Flow contains a precision-engineered blend of sodium, potassium, magnesium, and calcium in optimal ratios to support hydration, muscle function, and recovery.</p>
                </div>
            </div>
            <div class="faq-item">
                <button class="faq-question" onclick="toggleFaq(this)">
                    <span>Is Flow suitable for vegans?</span>
                    <svg class="faq-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
                <div class="faq-answer">
                    <p>Yes, Flow Hydration is 100% vegan, gluten-free, and made with clean ingredients. It's suitable for all dietary preferences.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-brand">
                <a href="/" class="logo">
                    <img src="logo.png" alt="Flow" class="logo-img">
                </a>
                <p>Clean hydration to fuel your day. Precision-engineered electrolyte formulation for optimal performance and recovery.</p>
            </div>
            <div class="footer-column">
                <h4>Shop</h4>
                <ul>
                    <li><a href="/shop/">Products</a></li>
                    <li><a href="/shop/">Bundles</a></li>
                    <li><a href="#" onclick="showComingSoonToast(event)">Subscription</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Company</h4>
                <ul>
                    <li><a href="/#about">About Us</a></li>
                    <li><a href="/#ingredients">Science</a></li>
                    <li><a href="/#about">Contact</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Support</h4>
                <ul>
                    <li><a href="/#faq">FAQ</a></li>
                    <li><a href="/shipping-policy/">Shipping</a></li>
                    <li><a href="/refund-policy/">Returns</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Legal</h4>
                <ul>
                    <li><a href="/privacy-policy/">Privacy Policy</a></li>
                    <li><a href="/terms-conditions/">Terms & Conditions</a></li>
                    <li><a href="/cookie-policy/">Cookie Policy</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Â© 2026 Podium Performance LLP. All rights reserved.</p>
            <div class="footer-contact">
                <a href="mailto:contact@flowhydration.in">contact@flowhydration.in</a>
            </div>
            <div class="social-links">
                <a href="https://www.instagram.com/flowhydration.in/" target="_blank" aria-label="Instagram">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="2" width="20" height="20" rx="5"/>
                        <circle cx="12" cy="12" r="4"/>
                        <circle cx="18" cy="6" r="1.5" fill="currentColor" stroke="none"/>
                    </svg>
                </a>
                <a href="https://www.instagram.com/flowhydration.in/" target="_blank" aria-label="Twitter">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </a>
                <a href="https://www.instagram.com/flowhydration.in/" target="_blank" aria-label="YouTube">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"/>
                        <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02" fill="currentColor" stroke="none"/>
                    </svg>
                </a>
            </div>
        </div>
    </footer>

    <!-- Toast -->
    <div class="toast" id="toast">
        <div class="toast-icon">âœ“</div>
        <span id="toastMessage">Added to cart!</span>
    </div>

    <!-- Cart Overlay -->
    <div class="cart-overlay" id="cartOverlay" onclick="closeCart()"></div>

    <!-- Cart Drawer -->
    <div class="cart-drawer" id="cartDrawer">
        <div class="cart-header">
            <h2>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
                    <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"/>
                </svg>
                Your Cart
            </h2>
            <button class="cart-close" onclick="closeCart()">Ã—</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="cart-empty">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                </svg>
                <p>Your cart is empty</p>
                <a href="/shop/">Continue Shopping</a>
            </div>
        </div>
        <div class="cart-footer" id="cartFooter" style="display: none;">
            <div class="shipping-progress">
                <p class="shipping-text" id="shippingText">Add <span>â‚¹999</span> more for free shipping</p>
                <div class="shipping-bar">
                    <div class="shipping-bar-fill" id="shippingBar" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- Discount Code Section -->
            <div class="cart-discount-section">
                <div class="cart-discount-row" id="cartDiscountInput">
                    <div class="cart-discount-input-wrapper">
                        <svg class="cart-discount-input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 12v10H4V12"/><path d="M2 7h20v5H2z"/><path d="M12 22V7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>
                        </svg>
                        <input type="text" id="cartDiscountCode" placeholder="Have a discount code?">
                    </div>
                    <button class="cart-apply-btn" id="cartApplyBtn" onclick="applyCartDiscount()">Apply</button>
                </div>
                
                <!-- Applied Discount (hidden by default) -->
                <div class="cart-applied-discount" id="cartAppliedDiscount" style="display: none;">
                    <div class="discount-info">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span class="discount-code" id="cartDiscountCodeLabel">CODE</span>
                        <span class="discount-value" id="cartDiscountValueLabel">-10%</span>
                    </div>
                    <button class="remove-discount" onclick="removeCartDiscount()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </div>
                
                <p class="cart-discount-error" id="cartDiscountError"></p>
            </div>
            
            <div class="cart-totals">
                <div class="cart-row">
                    <span>Subtotal</span>
                    <span id="cartSubtotal">â‚¹0</span>
                </div>
                <div class="cart-row">
                    <span>Shipping</span>
                    <span id="cartShipping">â‚¹99</span>
                </div>
            </div>
            
            <div class="cart-totals-final">
                <div class="cart-row discount" id="cartDiscountRow" style="display: none;">
                    <span>Discount</span>
                    <span id="cartDiscountAmount">-â‚¹0</span>
                </div>
                <div class="cart-row total">
                    <span>Total</span>
                    <span id="cartTotal">â‚¹0</span>
                </div>
            </div>
            <button class="cart-checkout-btn" onclick="goToCheckout()">
                Proceed to Checkout
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                    <line x1="5" y1="12" x2="19" y2="12"/>
                    <polyline points="12 5 19 12 12 19"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--flow-dark); z-index: 9999; align-items: center; justify-content: center;">
        <div style="text-align: center;">
            <div style="width: 50px; height: 50px; border: 3px solid rgba(0, 212, 255, 0.1); border-top-color: var(--flow-cyan); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
            <p style="color: var(--flow-gray);">Loading product...</p>
        </div>
    </div>
    <style>@keyframes spin { to { transform: rotate(360deg); } }</style>

    <!-- API Configuration -->
    <script src="assets/js/config.js"></script>
    <script>
        // Get product slug from URL params
        const urlParams = new URLSearchParams(window.location.search);
        const productSlug = urlParams.get('product') || 'flow-original';
        const preselectedFlavour = urlParams.get('flavour');
        const preselectedPack = urlParams.get('pack');
        
        // Product state
        let product = null;
        let allProducts = []; // All products for flavour switching
        let selectedFlavour = null;
        let selectedPackSize = null;
        let quantity = 1;

        // Flavor color mapping (new API structure)
        const FLAVOR_COLORS = {
            'original': '#00D4FF',
            'lemonade': '#FFD93D',
            'mango': '#FF9F43',
            'variety': '#00D4FF'
        };

        // Extract flavor from product name (e.g., "Flow Lemonade" -> {name: 'Lemonade', slug: 'lemonade', color: '#FFD93D'})
        function extractFlavorFromName(productName) {
            const name = productName.toLowerCase();
            if (name.includes('lemonade')) {
                return { name: 'Lemonade', slug: 'lemonade', color: FLAVOR_COLORS.lemonade };
            } else if (name.includes('mango')) {
                return { name: 'Mango', slug: 'mango', color: FLAVOR_COLORS.mango };
            } else if (name.includes('variety') || name.includes('bundle')) {
                return { name: 'Variety', slug: 'variety', color: FLAVOR_COLORS.variety };
            } else {
                return { name: 'Original', slug: 'original', color: FLAVOR_COLORS.original };
            }
        }

        // Get all 3 bundle flavors
        function getBundleFlavors() {
            return [
                { name: 'Original', slug: 'original', color: FLAVOR_COLORS.original },
                { name: 'Mango', slug: 'mango', color: FLAVOR_COLORS.mango },
                { name: 'Lemonade', slug: 'lemonade', color: FLAVOR_COLORS.lemonade }
            ];
        }

        // Get product image from media array
        function getProductImage(product) {
            if (!product.media || product.media.length === 0) return null;
            const primary = product.media.find(m => m.isPrimary && m.type === 'image');
            return primary ? primary.url : (product.media.find(m => m.type === 'image')?.url || null);
        }

        // DOM Elements
        const qtyValue = document.getElementById('qtyValue');

        // Load product on page load
        document.addEventListener('DOMContentLoaded', loadProduct);

        async function loadProduct() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            try {
                // Load all products for flavour switching
                const allResponse = await fetch(`${API_BASE}/api/products`);
                const allData = await allResponse.json();
                if (allData.success && allData.data) {
                    allProducts = allData.data; // Keep all products including bundles
                }
                
                const response = await fetch(`${API_BASE}/api/products/${productSlug}`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    product = data.data;
                    renderProduct();
                } else {
                    showError('Product not found');
                }
            } catch (error) {
                console.error('Error loading product:', error);
                showError('Failed to load product');
            } finally {
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        }

        function showError(message) {
            document.querySelector('.product-container').innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 4rem 2rem;">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--flow-gray)" stroke-width="1.5" style="margin-bottom: 1rem;">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    <h2 style="margin-bottom: 0.5rem;">${message}</h2>
                    <p style="color: var(--flow-gray); margin-bottom: 1.5rem;">The product you're looking for might have been removed or is temporarily unavailable.</p>
                    <a href="/shop/" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: var(--flow-cyan); color: var(--flow-dark); border-radius: 50px; text-decoration: none; font-weight: 600;">
                        Browse Products
                    </a>
                </div>
            `;
        }

        // Product media/image state
        let productMedia = []; // Array of media from S3
        let currentMediaIndex = 0;

        // Render the product gallery with images from S3
        function renderGallery() {
            const thumbnailRow = document.querySelector('.thumbnail-row');
            const mainImage = document.querySelector('.main-image');
            
            // Get product media (images/videos from S3)
            productMedia = product.media || [];
            
            // Build thumbnails - first 3 are for images/videos, then info views
            let thumbnailsHtml = '';
            
            // If we have media, show image thumbnails
            if (productMedia.length > 0) {
                // Find first image for video poster fallback
                const firstImage = productMedia.find(m => m.type === 'image');
                
                // Show up to 3 media thumbnails
                productMedia.slice(0, 3).forEach((media, index) => {
                    const isVideo = media.type === 'video';
                    if (isVideo) {
                        // For video thumbnails, use poster image or first product image as background
                        const posterUrl = media.poster || (firstImage ? firstImage.url : null);
                        
                        if (posterUrl) {
                            // Use image as thumbnail with play overlay
                            thumbnailsHtml += `
                                <div class="thumbnail image-thumb video-thumb ${index === 0 ? 'active' : ''}" data-view="media-${index}" onclick="switchMainView('media-${index}')">
                                    <img src="${posterUrl}" alt="Video" style="width: 100%; height: 100%; object-fit: cover;">
                                    <div class="thumbnail-video-overlay">
                                        <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                            <polygon points="5 3 19 12 5 21 5 3"/>
                                        </svg>
                                    </div>
                                </div>
                            `;
                        } else {
                            // Fallback: use video with poster frame
                            thumbnailsHtml += `
                                <div class="thumbnail image-thumb video-thumb ${index === 0 ? 'active' : ''}" data-view="media-${index}" onclick="switchMainView('media-${index}')">
                                    <video src="${media.url}#t=0.5" muted preload="metadata" style="width: 100%; height: 100%; object-fit: cover;"></video>
                                    <div class="thumbnail-video-overlay">
                                        <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                            <polygon points="5 3 19 12 5 21 5 3"/>
                                        </svg>
                                    </div>
                                </div>
                            `;
                        }
                    } else {
                        thumbnailsHtml += `
                            <div class="thumbnail image-thumb ${index === 0 ? 'active' : ''}" data-view="media-${index}" onclick="switchMainView('media-${index}')">
                                <img src="${media.url}" alt="${media.alt || product.name}">
                            </div>
                        `;
                    }
                });
                
                // Fill remaining slots (up to 3 total) with info views if less than 3 media
                const mediaCount = Math.min(productMedia.length, 3);
                const remainingSlots = 3 - mediaCount;
                const infoViews = ['ingredients', 'benefits']; // Nutrition is always 4th
                
                for (let i = 0; i < remainingSlots && i < infoViews.length; i++) {
                    const view = infoViews[i];
                    if (view === 'ingredients') {
                        thumbnailsHtml += `
                            <div class="thumbnail" data-view="ingredients" onclick="switchMainView('ingredients')">
                                <svg class="thumbnail-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                                </svg>
                            </div>
                        `;
                    } else if (view === 'benefits') {
                        thumbnailsHtml += `
                            <div class="thumbnail" data-view="benefits" onclick="switchMainView('benefits')">
                                <svg class="thumbnail-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                </svg>
                            </div>
                        `;
                    }
                }
                
                // Always add nutrition as 4th thumbnail
                thumbnailsHtml += `
                    <div class="thumbnail" data-view="nutrition" onclick="switchMainView('nutrition')">
                        <div class="mini-nutrition-preview">
                            <div class="mini-nutrition-header">
                                <h4>Nutrition Facts</h4>
                            </div>
                            <div class="mini-nutrition-grid">
                                <div class="mini-nutrition-row header"><span>Nutrient</span><span>Amt</span></div>
                                <div class="mini-nutrition-row"><span>Energy</span><span>37kcal</span></div>
                                <div class="mini-nutrition-row"><span>Sodium</span><span>430mg</span></div>
                                <div class="mini-nutrition-row"><span>Potassium</span><span>150mg</span></div>
                                <div class="mini-nutrition-row"><span>Vitamins</span><span>A-K</span></div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // No media - use default sachet visual + info views
                thumbnailsHtml = `
                    <div class="thumbnail active" data-view="product" onclick="switchMainView('product')">
                        <div class="mini-sachet"></div>
                    </div>
                    <div class="thumbnail" data-view="ingredients" onclick="switchMainView('ingredients')">
                        <svg class="thumbnail-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                        </svg>
                    </div>
                    <div class="thumbnail" data-view="benefits" onclick="switchMainView('benefits')">
                        <svg class="thumbnail-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                    </div>
                    <div class="thumbnail" data-view="nutrition" onclick="switchMainView('nutrition')">
                        <div class="mini-nutrition-preview">
                            <div class="mini-nutrition-header">
                                <h4>Nutrition Facts</h4>
                            </div>
                            <div class="mini-nutrition-grid">
                                <div class="mini-nutrition-row header"><span>Nutrient</span><span>Amt</span></div>
                                <div class="mini-nutrition-row"><span>Energy</span><span>37kcal</span></div>
                                <div class="mini-nutrition-row"><span>Sodium</span><span>430mg</span></div>
                                <div class="mini-nutrition-row"><span>Potassium</span><span>150mg</span></div>
                                <div class="mini-nutrition-row"><span>Vitamins</span><span>A-K</span></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            thumbnailRow.innerHTML = thumbnailsHtml;
            
            // Set initial main view
            if (productMedia.length > 0) {
                currentMainView = 'media-0';
                showMediaInMain(0);
            } else {
                currentMainView = 'product';
            }
        }
        
        // Show media (image/video) in main view
        function showMediaInMain(index) {
            const mainImage = document.querySelector('.main-image');
            const media = productMedia[index];
            
            if (!media) return;
            
            const badge = product.badges && product.badges.length > 0 
                ? `<span class="product-badge">${product.badges[0].text}</span>` 
                : '<span class="product-badge" style="display:none;"></span>';
            
            // Check if current pack size is the best value
            const bestValueBadge = getBestValueBadge();
            
            if (media.type === 'video') {
                mainImage.innerHTML = `
                    ${badge}
                    ${bestValueBadge}
                    <video class="product-video-display" src="${media.url}" autoplay loop muted playsinline></video>
                `;
            } else {
                mainImage.innerHTML = `
                    ${badge}
                    ${bestValueBadge}
                    <img class="product-image-display" src="${media.url}" alt="${media.alt || product.name}">
                `;
            }
            
            currentMediaIndex = index;
        }

        function getBestValueBadge() {
            if (!selectedPackSize || !product.packSizes || product.packSizes.length < 2) {
                return '';
            }
            
            // Find the pack with highest savings percentage
            let bestValuePack = null;
            let highestSavings = 0;
            
            product.packSizes.forEach(pack => {
                if (pack.comparePrice && pack.price < pack.comparePrice) {
                    const savings = Math.round((pack.comparePrice - pack.price) / pack.comparePrice * 100);
                    if (savings > highestSavings) {
                        highestSavings = savings;
                        bestValuePack = pack;
                    }
                }
            });
            
            // Show badge if current selection is the best value pack
            if (bestValuePack && selectedPackSize.size === bestValuePack.size && highestSavings >= 20) {
                return `<div class="best-value-badge">Best Value</div>`;
            }
            
            return '';
        }

        function renderProduct() {
            // Update page title
            document.title = `${product.name} â€” Flow Hydration`;
            
            const isBundle = product.category === 'bundle';
            
            // Set defaults or use URL params - extract flavor from product name (new API)
            if (isBundle) {
                // For bundles, don't set a single selected flavour
                selectedFlavour = null;
            } else {
                // Extract flavor from product name since API no longer has flavours array
                const extractedFlavour = extractFlavorFromName(product.name);
                
                // If URL has preselected flavour, try to match it
                if (preselectedFlavour) {
                    // Find product that matches the preselected flavour
                    const matchingProduct = allProducts.find(p => {
                        const f = extractFlavorFromName(p.name);
                        return f.slug === preselectedFlavour && p.category !== 'bundle';
                    });
                    if (matchingProduct && matchingProduct.slug !== product.slug) {
                        // Switch to that product
                        product = matchingProduct;
                        selectedFlavour = extractFlavorFromName(matchingProduct.name);
                    } else {
                        selectedFlavour = extractedFlavour;
                    }
                } else {
                    selectedFlavour = extractedFlavour;
                }
            }
            selectedPackSize = product.packSizes.find(p => p.size === parseInt(preselectedPack)) || product.packSizes[0];
            
            // Update breadcrumb
            document.querySelector('.breadcrumb .current').textContent = product.name;
            
            // Update product category
            document.querySelector('.product-category').innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                </svg>
                ${product.category.charAt(0).toUpperCase() + product.category.slice(1)}
            `;
            
            // Update product title
            document.querySelector('.product-title').innerHTML = `${product.name} <span>${selectedPackSize.label}</span>`;
            
            // Update rating
            renderRating();
            
            // Update price
            updatePriceDisplay();
            
            // Update description - use full description from API
            document.querySelector('.product-description').textContent = product.description || product.shortDescription;
            
            // Render flavour selector
            renderFlavourSelector();
            
            // Render pack size selector
            renderPackSizeSelector();
            
            // Render product gallery (images from S3)
            renderGallery();

            // Update visual elements (fallback sachet if no images)
            if (!product.media || product.media.length === 0) {
                updateVisuals();
            }
            
            // Update add to cart button
            updateAddToCartPrice();
            
            // Render tabs content
            renderIngredients();
            renderHowToUse();
            renderReviews();
            
            // Update badge
            if (product.badges && product.badges.length > 0) {
                document.querySelector('.product-badge').textContent = product.badges[0].text;
                document.querySelector('.product-badge').style.display = 'block';
            } else {
                document.querySelector('.product-badge').style.display = 'none';
            }
            
            // Render related products
            renderRelatedProducts();
        }

        function renderRating() {
            const hasReviews = product.reviews && product.reviews.length > 0;
            const rating = hasReviews ? (product.rating?.average || 4.5) : 4.5;
            const count = hasReviews ? (product.rating?.count || product.reviews.length) : getDummyReviews().length;
            const starsHtml = Array(5).fill(0).map((_, i) => {
                const filled = i < Math.round(rating);
                return `<svg class="star${filled ? '' : ' empty'}" width="18" height="18" viewBox="0 0 24 24" fill="${filled ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="1.5"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`;
            }).join('');
            
            document.querySelector('.product-rating').innerHTML = `
                <div class="stars">${starsHtml}</div>
                <span class="rating-text"><strong>${rating.toFixed(1)}</strong> (${count} reviews)</span>
            `;
        }

        function updatePriceDisplay() {
            const priceSection = document.querySelector('.product-price-section');
            const isBundle = product.category === 'bundle';
            
            // If bundle in individual mode, get price from single-flavour product
            let priceData = selectedPackSize;
            if (isBundle && bundleViewMode === 'individual') {
                const singleFlavourProduct = allProducts.find(p => p.category !== 'bundle');
                if (singleFlavourProduct && singleFlavourProduct.packSizes) {
                    const matchingPack = singleFlavourProduct.packSizes.find(p => p.size === selectedPackSize?.size);
                    if (matchingPack) {
                        priceData = matchingPack;
                    }
                }
            }
            
            const discount = priceData?.comparePrice 
                ? Math.round((1 - priceData.price / priceData.comparePrice) * 100)
                : 0;
            
            priceSection.innerHTML = `
                <span class="price-current">â‚¹${priceData?.price?.toLocaleString() || '0'}</span>
                ${priceData?.comparePrice ? `<span class="price-original">â‚¹${priceData.comparePrice.toLocaleString()}</span>` : ''}
                ${discount > 0 ? `<span class="price-discount">Save ${discount}%</span>` : ''}
            `;
        }

        // Track bundle view mode: 'all' or 'individual'
        let bundleViewMode = 'all';
        
        function renderFlavourSelector() {
            const isBundle = product.category === 'bundle';
            
            // Check if variety pack exists in allProducts
            const varietyPack = allProducts.find(p => p.category === 'bundle');
            const hasVarietyPack = !!varietyPack;
            
            // Determine current mode based on product type
            const isAllMode = isBundle && bundleViewMode === 'all';
            
            // Toggle switch HTML - show on all products if variety pack exists
            const toggleHtml = hasVarietyPack ? `
                <div class="bundle-toggle" style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                    <button class="toggle-btn${isBundle && bundleViewMode === 'all' ? ' active' : ''}" onclick="setBundleMode('all')" style="
                        padding: 0.5rem 1rem;
                        border-radius: 50px;
                        border: 1px solid ${isBundle && bundleViewMode === 'all' ? 'var(--flow-cyan)' : 'rgba(0, 212, 255, 0.2)'};
                        background: ${isBundle && bundleViewMode === 'all' ? 'rgba(0, 212, 255, 0.15)' : 'rgba(13, 26, 45, 0.6)'};
                        color: ${isBundle && bundleViewMode === 'all' ? 'var(--flow-cyan)' : 'var(--flow-gray)'};
                        font-family: 'Outfit', sans-serif;
                        font-size: 0.85rem;
                        font-weight: 500;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">All 3 Flavours</button>
                    <button class="toggle-btn${!isBundle || bundleViewMode === 'individual' ? ' active' : ''}" onclick="setBundleMode('individual')" style="
                        padding: 0.5rem 1rem;
                        border-radius: 50px;
                        border: 1px solid ${!isBundle || bundleViewMode === 'individual' ? 'var(--flow-cyan)' : 'rgba(0, 212, 255, 0.2)'};
                        background: ${!isBundle || bundleViewMode === 'individual' ? 'rgba(0, 212, 255, 0.15)' : 'rgba(13, 26, 45, 0.6)'};
                        color: ${!isBundle || bundleViewMode === 'individual' ? 'var(--flow-cyan)' : 'var(--flow-gray)'};
                        font-family: 'Outfit', sans-serif;
                        font-size: 0.85rem;
                        font-weight: 500;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">Single Flavour</button>
                </div>
            ` : '';
            
            // For bundles in "all" mode, show all flavours as included
            if (isBundle && bundleViewMode === 'all') {
                const bundleFlavors = getBundleFlavors();
                const flavoursHtml = bundleFlavors.map(f => `
                    <div class="flavour-option selected" style="cursor: default;">
                        <div class="flavour-dot" style="background: ${f.color};"></div>
                        <span class="flavour-name">${f.name}</span>
                        <span style="font-size: 0.75rem; color: var(--flow-gray); margin-left: 0.25rem;">Ã—10</span>
                    </div>
                `).join('');
                
                document.querySelector('.flavour-section').innerHTML = `
                    ${toggleHtml}
                    <div class="flavour-label">Includes: <span>All 3 Flavours (10 each)</span></div>
                    <div class="flavour-options">${flavoursHtml}</div>
                `;
                return;
            }
            
            // Get all unique flavours from all products (excluding bundles)
            const allFlavours = getAllFlavoursFromProducts();
            
            if (allFlavours.length === 0 && !hasVarietyPack) {
                document.querySelector('.flavour-section').style.display = 'none';
                return;
            }
            
            // Find current flavour - extract from current product name
            const currentExtractedFlavour = extractFlavorFromName(product.name);
            const currentFlavourSlug = selectedFlavour?.slug || currentExtractedFlavour.slug;
            
            const flavoursHtml = allFlavours.map(f => `
                <div class="flavour-option${f.slug === currentFlavourSlug ? ' selected' : ''}" 
                     data-flavour="${f.slug}" 
                     data-product="${f.productSlug}"
                     onclick="selectFlavour('${f.slug}', '${f.productSlug}')">
                    <div class="flavour-dot" style="background: ${f.color};"></div>
                    <span class="flavour-name">${f.name}</span>
                </div>
            `).join('');
            
            const displayFlavourName = selectedFlavour?.name || currentExtractedFlavour.name || 'Original';
            
            document.querySelector('.flavour-section').innerHTML = `
                ${toggleHtml}
                <div class="flavour-label">Flavour: <span>${displayFlavourName}</span></div>
                <div class="flavour-options">${flavoursHtml}</div>
            `;
        }
        
        function getAllFlavoursFromProducts() {
            const allFlavours = [];
            allProducts.forEach(p => {
                // Exclude bundles from flavour switching
                if (p.category === 'bundle') return;
                
                // Extract flavor from product name (new API structure)
                const flavour = extractFlavorFromName(p.name);
                
                // Only add if not already in array
                if (!allFlavours.find(af => af.slug === flavour.slug)) {
                    allFlavours.push({
                        ...flavour,
                        productSlug: p.slug
                    });
                }
            });
            return allFlavours;
        }
        
        function setBundleMode(mode) {
            bundleViewMode = mode;
            
            if (mode === 'all') {
                // Navigate to variety pack
                const varietyPack = allProducts.find(p => p.category === 'bundle');
                if (varietyPack && product.slug !== varietyPack.slug) {
                    window.location.href = `/product/?product=${varietyPack.slug}`;
                    return;
                }
            } else if (mode === 'individual') {
                // If currently on variety pack, switch to a single-flavour product
                if (product.category === 'bundle') {
                    // Find the first single-flavour product
                    const singleFlavourProduct = allProducts.find(p => p.category !== 'bundle');
                    if (singleFlavourProduct) {
                        // Switch to the single flavour product
                        product = singleFlavourProduct;
                        selectedFlavour = extractFlavorFromName(singleFlavourProduct.name);
                        selectedPackSize = singleFlavourProduct.packSizes[0];
                        
                        // Update URL without reload
                        const newUrl = `product.html?product=${singleFlavourProduct.slug}&flavour=${selectedFlavour.slug}&pack=${selectedPackSize.size}`;
                        window.history.pushState({}, '', newUrl);
                        
                        // Re-render the gallery with new product media
                        renderGallery();
                    }
                }
            }
            
            renderFlavourSelector();
            renderPackSizeSelector();
            updateVisuals();
            updatePriceDisplay();
            updateAddToCartPrice();
            
            // Update product title
            document.querySelector('.product-title').innerHTML = `${product.name} <span>${selectedPackSize?.label || ''}</span>`;
        }

        function renderPackSizeSelector() {
            const isBundle = product.category === 'bundle';
            
            // If bundle in individual mode, show pack sizes from a single-flavour product
            let packSizesToShow = product.packSizes;
            let packSizeSource = product;
            
            if (isBundle && bundleViewMode === 'individual') {
                // Find a single-flavour product to get its pack sizes
                const singleFlavourProduct = allProducts.find(p => p.category !== 'bundle');
                if (singleFlavourProduct && singleFlavourProduct.packSizes) {
                    packSizesToShow = singleFlavourProduct.packSizes;
                    packSizeSource = singleFlavourProduct;
                    // Update selectedPackSize to match
                    if (!selectedPackSize || !packSizesToShow.find(p => p.size === selectedPackSize.size)) {
                        selectedPackSize = packSizesToShow[0];
                    }
                }
            }
            
            if (!packSizesToShow || packSizesToShow.length === 0) {
                document.querySelector('.variant-section').style.display = 'none';
                return;
            }
            
            document.querySelector('.variant-section').style.display = 'block';
            
            // Calculate per-unit price and savings for psychological pricing
            const sortedPacks = [...packSizesToShow].sort((a, b) => a.size - b.size);
            const smallestPack = sortedPacks[0];
            const basePerUnit = smallestPack.price / smallestPack.size; // Price per sachet for smallest pack
            
            // Find the "popular" pack - typically the middle option or 20-pack
            const popularPackIndex = packSizesToShow.length === 3 ? 1 : 
                                     packSizesToShow.findIndex(p => p.size === 20) !== -1 ? 
                                     packSizesToShow.findIndex(p => p.size === 20) : 
                                     Math.floor(packSizesToShow.length / 2);
            
            const sizesHtml = packSizesToShow.map((p, i) => {
                const perUnit = p.price / p.size;
                const savingsPercent = Math.round((1 - perUnit / basePerUnit) * 100);
                const isPopular = i === popularPackIndex && packSizesToShow.length > 1;
                const isBestValue = i === packSizesToShow.length - 1 && packSizesToShow.length > 2;
                const originalPrice = Math.round(basePerUnit * p.size);
                const savedAmount = originalPrice - p.price;
                
                let badge = '';
                let savingsHtml = '';
                let perUnitHtml = `<div class="variant-per-unit">â‚¹${perUnit.toFixed(0)}/sachet</div>`;
                
                if (isPopular) {
                    badge = '<span class="variant-badge">Most Popular</span>';
                    if (savingsPercent > 0) {
                        savingsHtml = `<div class="variant-savings">Save â‚¹${savedAmount}</div>`;
                    }
                } else if (isBestValue && savingsPercent > 0) {
                    badge = '<span class="variant-badge best-value">Best Value</span>';
                    savingsHtml = `<div class="variant-savings">Save ${savingsPercent}%</div>`;
                }
                
                // Show original price strike-through for packs with savings
                let priceHtml = `<div class="variant-price">â‚¹${p.price.toLocaleString()}</div>`;
                if (savingsPercent > 5 && i > 0) {
                    priceHtml = `
                        <div class="variant-original-price">â‚¹${originalPrice.toLocaleString()}</div>
                        <div class="variant-price">â‚¹${p.price.toLocaleString()}</div>
                    `;
                }
                
                return `
                    <div class="variant-option${p.size === selectedPackSize?.size ? ' selected' : ''}${isPopular ? ' popular' : ''}" data-size="${p.size}" onclick="selectPackSize(${p.size})">
                        ${badge}
                        <div class="variant-name">${p.label}</div>
                        ${priceHtml}
                        ${perUnitHtml}
                        ${savingsHtml}
                    </div>
                `;
            }).join('');
            
            document.querySelector('.variant-section').innerHTML = `
                <div class="variant-label">Pack Size: <span>${selectedPackSize?.size || packSizesToShow[0].size} Sachets</span></div>
                <div class="variant-options">${sizesHtml}</div>
            `;
        }

        function selectFlavour(slug, targetProductSlug) {
            // If selecting a different product's flavour, switch products
            if (targetProductSlug && targetProductSlug !== product.slug) {
                const newProduct = allProducts.find(p => p.slug === targetProductSlug);
                if (newProduct) {
                    product = newProduct;
                    selectedFlavour = extractFlavorFromName(newProduct.name);
                    
                    // Keep same pack size if available, otherwise use first
                    const samePackSize = newProduct.packSizes.find(p => p.size === selectedPackSize?.size);
                    selectedPackSize = samePackSize || newProduct.packSizes[0];
                    
                    // Update URL without reload
                    const newUrl = `product.html?product=${targetProductSlug}&flavour=${slug}&pack=${selectedPackSize.size}`;
                    window.history.pushState({}, '', newUrl);
                    
                    // Re-render the page with new product
                    renderProduct();
                    return;
                }
            }
            
            // Same product, just update flavour
            selectedFlavour = extractFlavorFromName(product.name);
            
            document.querySelectorAll('.flavour-option').forEach(o => o.classList.remove('selected'));
            document.querySelector(`.flavour-option[data-flavour="${slug}"]`)?.classList.add('selected');
            document.querySelector('.flavour-label span').textContent = selectedFlavour?.name || 'Original';
            
            updateVisuals();
        }

        function selectPackSize(size) {
            const isBundle = product.category === 'bundle';
            
            // If bundle in individual mode, get pack size from single-flavour product
            if (isBundle && bundleViewMode === 'individual') {
                const singleFlavourProduct = allProducts.find(p => p.category !== 'bundle');
                if (singleFlavourProduct && singleFlavourProduct.packSizes) {
                    selectedPackSize = singleFlavourProduct.packSizes.find(p => p.size === size) || singleFlavourProduct.packSizes[0];
                }
            } else {
                selectedPackSize = product.packSizes.find(p => p.size === size);
            }
            
            document.querySelectorAll('.variant-option').forEach(o => o.classList.remove('selected'));
            document.querySelector(`.variant-option[data-size="${size}"]`)?.classList.add('selected');
            document.querySelector('.variant-label span').textContent = `${size} Sachets`;
            document.querySelector('.product-title').innerHTML = `${product.name} <span>${selectedPackSize?.label || 'Pack of ' + size}</span>`;
            
            // Update URL without reload
            const newUrl = `product.html?product=${product.slug}&flavour=${selectedFlavour?.slug || ''}&pack=${size}`;
            window.history.pushState({}, '', newUrl);
            
            updatePriceDisplay();
            updateAddToCartPrice();
            
            // Refresh image display to show/hide best value badge
            if (productMedia.length > 0 && currentMainView.startsWith('media-')) {
                const mediaIndex = parseInt(currentMainView.split('-')[1]);
                showMediaInMain(mediaIndex);
            }
        }

        function updateVisuals() {
            const mainImage = document.querySelector('.main-image');
            const isBundle = product.category === 'bundle';
            // Extract flavor from product name if no selectedFlavour
            const extractedFlavour = extractFlavorFromName(product.name);
            const displayFlavour = selectedFlavour || extractedFlavour;
            const flavourColor = displayFlavour?.color || '#00D4FF';
            
            // If viewing non-product views, re-render with updated color
            if (currentMainView === 'nutrition') {
                renderNutritionChart(mainImage, flavourColor);
                return;
            } else if (currentMainView === 'ingredients') {
                renderIngredientsView(mainImage, flavourColor);
                return;
            } else if (currentMainView === 'benefits') {
                renderBenefitsView(mainImage, flavourColor);
                return;
            } else if (currentMainView && currentMainView.startsWith('media-')) {
                // Currently viewing media (image/video), don't overwrite with sachet
                return;
            }
            
            // For bundles in 'all' mode, show all 3 sachets
            if (isBundle && bundleViewMode === 'all') {
                // Show multiple sachets for variety pack using getBundleFlavors()
                const bundleFlavors = getBundleFlavors();
                const sachetsHtml = bundleFlavors.map(f => `
                    <div class="sachet-visual-large" style="width: 120px; height: 180px; box-shadow: 0 20px 50px ${hexToRgba(f.color, 0.3)};">
                        <div class="sachet-content-large">
                            <div class="sachet-logo-large" style="font-size: 1.2rem;">Flow</div>
                            <div class="sachet-flavor-large" style="font-size: 0.55rem;">${f.name}</div>
                        </div>
                    </div>
                `).join('');
                
                // Update main image to show all 3 sachets
                const badge = mainImage.querySelector('.product-badge');
                
                // Clear and rebuild
                mainImage.innerHTML = '';
                if (badge) mainImage.appendChild(badge.cloneNode(true));
                
                const sachetsContainer = document.createElement('div');
                sachetsContainer.style.cssText = 'display: flex; gap: 12px; align-items: flex-end;';
                sachetsContainer.innerHTML = sachetsHtml;
                mainImage.appendChild(sachetsContainer);
                
                // Re-add badge
                if (product.badges && product.badges.length > 0) {
                    const newBadge = document.createElement('span');
                    newBadge.className = 'product-badge';
                    newBadge.textContent = product.badges[0].text;
                    mainImage.insertBefore(newBadge, mainImage.firstChild);
                }
            } else {
                // Single flavour view - show single sachet (for regular products OR bundle in individual mode)
                // displayFlavour is already set above from extractFlavorFromName
                
                // Rebuild single sachet view
                const sachetsContainer = mainImage.querySelector('div[style*="display: flex"]');
                if (sachetsContainer || !mainImage.querySelector('.sachet-visual-large')) {
                    // Rebuild single sachet
                    mainImage.innerHTML = `
                        ${product.badges && product.badges.length > 0 ? `<span class="product-badge">${product.badges[0].text}</span>` : '<span class="product-badge" style="display:none;"></span>'}
                        <div class="sachet-visual-large">
                            <div class="sachet-content-large">
                                <div class="sachet-logo-large">Flow</div>
                                <div class="sachet-flavor-large">${displayFlavour?.name || 'Original'}</div>
                            </div>
                        </div>
                    `;
                }
                
                const sachetFlavor = document.querySelector('.sachet-flavor-large');
                const sachetVisual = document.querySelector('.sachet-visual-large');
                
                if (sachetFlavor && displayFlavour) {
                    sachetFlavor.textContent = displayFlavour.name;
                }
                
                // Update main image glow color based on flavour
                if (sachetVisual && displayFlavour?.color) {
                    sachetVisual.style.boxShadow = `0 30px 80px ${hexToRgba(displayFlavour.color, 0.4)}`;
                }
            }
        }
        
        function hexToRgba(hex, alpha) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            if (result) {
                return `rgba(${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}, ${alpha})`;
            }
            return `rgba(0, 212, 255, ${alpha})`;
        }

        // Current main view state
        let currentMainView = 'product';

        function switchMainView(view) {
            currentMainView = view;
            
            // Update thumbnail active states
            document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
            document.querySelector(`.thumbnail[data-view="${view}"]`)?.classList.add('active');
            
            const mainImage = document.querySelector('.main-image');
            // Extract flavor from product name if no selectedFlavour
            const extractedFlavour = extractFlavorFromName(product.name);
            const displayFlavour = selectedFlavour || extractedFlavour;
            const flavourColor = displayFlavour?.color || '#00D4FF';
            
            // Handle media views (media-0, media-1, media-2)
            if (view.startsWith('media-')) {
                const mediaIndex = parseInt(view.split('-')[1]);
                showMediaInMain(mediaIndex);
            } else if (view === 'nutrition') {
                renderNutritionChart(mainImage, flavourColor);
            } else if (view === 'product') {
                updateVisuals();
            } else if (view === 'ingredients') {
                renderIngredientsView(mainImage, flavourColor);
            } else if (view === 'benefits') {
                renderBenefitsView(mainImage, flavourColor);
            }
        }

        function renderNutritionChart(container, accentColor) {
            const badge = container.querySelector('.product-badge');
            const badgeHtml = badge ? badge.outerHTML : '';
            
            container.innerHTML = `
                ${badgeHtml}
                <div class="nutrition-chart-display">
                    <div class="nutrition-chart-header">
                        <h3 style="color: ${accentColor};">Nutrition Facts</h3>
                        <p>Per Serving (12.5g)</p>
                    </div>
                    <div class="nutrition-chart-grid" style="border-color: ${hexToRgba(accentColor, 0.2)};">
                        <div class="nutrition-chart-row header" style="background: ${hexToRgba(accentColor, 0.15)};">
                            <span style="text-align: left;">Nutrient</span>
                            <span>Amount</span>
                            <span>% RDA</span>
                        </div>
                        <div class="nutrition-chart-row">
                            <span class="nutrient-name">Energy</span>
                            <span>37 kcal</span>
                            <span>1.9%</span>
                        </div>
                        <div class="nutrition-chart-row">
                            <span class="nutrient-name">Carbs</span>
                            <span>9.2g</span>
                            <span>7.1%</span>
                        </div>
                        <div class="nutrition-chart-row">
                            <span class="nutrient-name">Protein / Fats</span>
                            <span>0g</span>
                            <span>0%</span>
                        </div>
                        <div class="nutrition-section-divider" style="background: ${hexToRgba(accentColor, 0.1)}; color: ${accentColor};">Electrolytes</div>
                        <div class="nutrition-chart-row">
                            <span class="nutrient-name">Sodium</span>
                            <span>430mg</span>
                            <span>21.6%</span>
                        </div>
                        <div class="nutrition-chart-row">
                            <span class="nutrient-name">Potassium</span>
                            <span>150mg</span>
                            <span>4.3%</span>
                        </div>
                        <div class="nutrition-chart-row">
                            <span class="nutrient-name">Calcium / Magnesium</span>
                            <span>4.7 / 30mg</span>
                            <span>0.5%</span>
                        </div>
                        <div class="nutrition-section-divider" style="background: ${hexToRgba(accentColor, 0.1)}; color: ${accentColor};">Vitamins</div>
                        <div class="nutrition-chart-row">
                            <span class="nutrient-name">Vitamin C</span>
                            <span>5mg</span>
                            <span>6.3%</span>
                        </div>
                        <div class="nutrition-chart-row">
                            <span class="nutrient-name">Vitamin E</span>
                            <span>1mg</span>
                            <span>13.3%</span>
                        </div>
                        <div class="nutrition-chart-row">
                            <span class="nutrient-name">Vitamin A / D3 / K1</span>
                            <span>62.5mcg / 52IU / 5mcg</span>
                            <span>6-9%</span>
                        </div>
                        <div class="nutrition-chart-row">
                            <span class="nutrient-name">B-Complex (B1-B12)</span>
                            <span>0.1-18.8mg/mcg</span>
                            <span>5-10%</span>
                        </div>
                    </div>
                    <p style="color: var(--flow-gray); font-size: 0.5rem; margin-top: 0.4rem; text-align: center;">*% Daily Values based on 2000 kcal diet</p>
                </div>
            `;
        }

        function renderIngredientsView(container, accentColor) {
            const badge = container.querySelector('.product-badge');
            const badgeHtml = badge ? badge.outerHTML : '';
            
            container.innerHTML = `
                ${badgeHtml}
                <div style="text-align: center; padding: 2rem;">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="${accentColor}" stroke-width="1.5" style="margin-bottom: 1rem;">
                        <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                    </svg>
                    <h3 style="font-family: 'Syne', sans-serif; font-size: 1.25rem; margin-bottom: 0.5rem; color: ${accentColor};">Premium Electrolytes</h3>
                    <p style="color: var(--flow-gray); font-size: 0.9rem; max-width: 300px; margin: 0 auto;">Sodium, Potassium, Magnesium & Calcium in optimal ratios for rapid hydration</p>
                </div>
            `;
        }

        function renderBenefitsView(container, accentColor) {
            const badge = container.querySelector('.product-badge');
            const badgeHtml = badge ? badge.outerHTML : '';
            
            container.innerHTML = `
                ${badgeHtml}
                <div style="text-align: center; padding: 2rem;">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="${accentColor}" stroke-width="1.5" style="margin-bottom: 1rem;">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                    </svg>
                    <h3 style="font-family: 'Syne', sans-serif; font-size: 1.25rem; margin-bottom: 0.5rem; color: ${accentColor};">Instant Energy</h3>
                    <p style="color: var(--flow-gray); font-size: 0.9rem; max-width: 300px; margin: 0 auto;">Quick absorption formula for sustained energy without the crash</p>
                </div>
            `;
        }

        function updateQty(change) {
            quantity = Math.max(1, quantity + change);
            qtyValue.textContent = quantity;
            updateAddToCartPrice();
        }

        function updateAddToCartPrice() {
            const isBundle = product.category === 'bundle';
            let packSize = selectedPackSize;
            
            // If viewing bundle in individual mode, get pack size from a single-flavour product
            if (isBundle && bundleViewMode === 'individual' && selectedPackSize) {
                const singleProduct = allProducts.find(p => p.category !== 'bundle');
                if (singleProduct) {
                    packSize = singleProduct.packSizes.find(p => p.size === selectedPackSize.size) || singleProduct.packSizes[0];
                }
            }
            
            const total = (packSize?.price || 0) * quantity;
            document.querySelector('.add-to-cart-btn').innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                </svg>
                Add to Cart â€” â‚¹${total.toLocaleString()}
            `;
        }

        function renderIngredients() {
            if (!product.ingredients || product.ingredients.length === 0) return;
            
            const ingredientsHtml = product.ingredients.map(ing => `
                <div class="ingredient-card">
                    <div class="ingredient-header">
                        <div class="ingredient-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                            </svg>
                        </div>
                        <h4>${ing.name}${ing.amount ? ` (${ing.amount})` : ''}</h4>
                    </div>
                    <p>${ing.description || 'Essential ingredient for optimal hydration.'}</p>
                </div>
            `).join('');
            
            document.querySelector('#ingredients .ingredients-grid').innerHTML = ingredientsHtml;
        }

        function renderHowToUse() {
            if (!product.howToUse || product.howToUse.length === 0) return;
            
            const stepsHtml = product.howToUse.map((step, i) => `
                <div class="ingredient-card">
                    <div class="ingredient-header">
                        <div class="ingredient-icon" style="background: rgba(0, 212, 255, 0.2);">
                            <span style="font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.1rem;">${i + 1}</span>
                        </div>
                        <h4>Step ${i + 1}</h4>
                    </div>
                    <p>${step}</p>
                </div>
            `).join('');
            
            document.querySelector('#how-to-use .ingredients-grid').innerHTML = stepsHtml;
        }

        function getDummyReviews() {
            return [
                {
                    author: 'Raj Kumar',
                    rating: 5,
                    title: 'Amazing taste and great for workouts',
                    content: 'This electrolyte drink is exactly what I needed. Great taste, mixes well with water, and keeps me hydrated during intense workouts. Highly recommend!',
                    date: new Date(Date.now() - 7*24*60*60*1000).toISOString(),
                    helpful: 42,
                    verified: true
                },
                {
                    author: 'Priya Singh',
                    rating: 5,
                    title: 'Perfect for daily hydration',
                    content: 'I use this every morning and evening. The variety pack is amazing because you get different flavors. No artificial taste, just pure refreshment.',
                    date: new Date(Date.now() - 14*24*60*60*1000).toISOString(),
                    helpful: 38,
                    verified: true
                },
                {
                    author: 'Arjun Patel',
                    rating: 4,
                    title: 'Good quality, wish there were more sachets',
                    content: 'The product quality is excellent and my body feels more hydrated. Would love if the pack had a few more sachets, but overall very satisfied.',
                    date: new Date(Date.now() - 21*24*60*60*1000).toISOString(),
                    helpful: 28,
                    verified: true
                },
                {
                    author: 'Neha Desai',
                    rating: 5,
                    title: 'Best electrolyte drink in the market',
                    content: 'I have tried many brands, but Flow is definitely the best. The ingredients are natural, taste is great, and it actually works. Ordering again!',
                    date: new Date(Date.now() - 28*24*60*60*1000).toISOString(),
                    helpful: 65,
                    verified: true
                },
                {
                    rating: 4,
                    author: 'Vikas Sharma',
                    title: 'Great recovery drink',
                    content: 'Using this post-workout and my recovery has improved significantly. The lemonade flavor is my favorite. Would definitely recommend to anyone serious about fitness.',
                    date: new Date(Date.now() - 35*24*60*60*1000).toISOString(),
                    helpful: 31,
                    verified: true
                }
            ];
        }

        function renderReviews() {
            // Use dummy reviews if no reviews from server
            let reviews = product.reviews && product.reviews.length > 0 ? product.reviews : getDummyReviews();
            let avgRating = product.rating?.average || 4.5;
            let reviewCount = reviews.length;
            
            // Calculate rating distribution
            const distribution = [5, 4, 3, 2, 1].map(star => ({
                star,
                count: reviews.filter(r => r.rating === star).length,
                percent: (reviews.filter(r => r.rating === star).length / reviewCount * 100).toFixed(0)
            }));
            
            const reviewsHtml = reviews.slice(0, 5).map(review => `
                <div class="review-card" data-review-id="${review._id || ''}">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">${review.author.split(' ').map(n => n.charAt(0).toUpperCase()).join('').slice(0, 2)}</div>
                            <div class="reviewer-details">
                                <div class="reviewer-name">${review.author}</div>
                                <div class="review-meta">
                                    <div class="review-stars">
                                        ${Array(5).fill(0).map((_, i) => `<svg viewBox="0 0 24 24" fill="${i < review.rating ? '#FFD700' : 'rgba(255,255,255,0.2)'}"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`).join('')}
                                    </div>
                                    <span class="review-date">${new Date(review.date).toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="review-body">
                        ${review.title ? `<h4 class="review-title">${review.title}</h4>` : ''}
                        <p class="review-content">${review.content}</p>
                    </div>
                    <div class="review-footer">
                        ${review.verified ? `<div class="verified-badge">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            Verified Purchase
                        </div>` : '<div></div>'}
                        <button class="helpful-btn" onclick="markHelpful(this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/>
                            </svg>
                            Helpful (${review.helpful || 0})
                        </button>
                    </div>
                </div>
            `).join('');
            
            document.querySelector('#reviews').innerHTML = `
                <div class="reviews-summary">
                    <div class="rating-overview">
                        <div class="rating-big">${avgRating.toFixed(1)}</div>
                        <div class="rating-stars">
                            ${Array(5).fill(0).map((_, i) => `<svg width="20" height="20" viewBox="0 0 24 24" fill="${i < Math.round(avgRating) ? '#FFD700' : 'none'}" stroke="${i < Math.round(avgRating) ? '#FFD700' : 'var(--flow-gray)'}" stroke-width="1.5"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`).join('')}
                        </div>
                        <div class="rating-count">${reviewCount} reviews</div>
                    </div>
                    <div class="rating-bars">
                        ${distribution.map(d => `
                            <div class="rating-bar-row">
                                <span>${d.star} star</span>
                                <div class="rating-bar"><div class="rating-bar-fill" style="width: ${d.percent}%"></div></div>
                                <span>${d.count}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="reviews-list">${reviewsHtml}</div>
            `;
        }

        function renderRelatedProducts() {
            const grid = document.getElementById('relatedProductsGrid');
            
            if (!allProducts || allProducts.length === 0) {
                grid.innerHTML = '<p style="color: var(--flow-gray); text-align: center; grid-column: 1/-1;">No related products found</p>';
                return;
            }
            
            // Filter out current product and expand to individual product cards
            const relatedItems = [];
            allProducts.forEach(p => {
                if (p.slug === product.slug) return; // Skip current product
                
                // For each product, create entries for different pack sizes
                if (p.packSizes && p.packSizes.length > 0) {
                    p.packSizes.forEach(packSize => {
                        // Extract flavor from product name (new API)
                        const flavour = extractFlavorFromName(p.name);
                        relatedItems.push({
                            product: p,
                            packSize: packSize,
                            flavour: flavour
                        });
                    });
                }
            });
            
            // Shuffle array (Fisher-Yates algorithm)
            for (let i = relatedItems.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [relatedItems[i], relatedItems[j]] = [relatedItems[j], relatedItems[i]];
            }
            
            // Take first 3 items
            const displayItems = relatedItems.slice(0, 3);
            
            if (displayItems.length === 0) {
                grid.innerHTML = '<p style="color: var(--flow-gray); text-align: center; grid-column: 1/-1;">No related products found</p>';
                return;
            }
            
            // Get current cart to check quantities
            const cart = typeof CustomerAuth !== 'undefined' ? CustomerAuth.getLocalCart() : JSON.parse(localStorage.getItem('flow_cart') || '[]');
            
            grid.innerHTML = displayItems.map(item => {
                const { product: p, packSize, flavour } = item;
                const isBundle = p.category === 'bundle';
                const productUrl = `product.html?product=${p.slug}${flavour ? `&flavour=${flavour.slug}` : ''}&pack=${packSize.size}`;
                const glowColor = flavour?.color || '#00D4FF';
                
                // Build unique ID to check cart
                const uniqueId = flavour 
                    ? `${p.slug}-${flavour.slug}-${packSize.size}`
                    : `${p.slug}-${packSize.size}`;
                
                // Check if item is in cart
                const cartItem = cart.find(c => c.productSlug === uniqueId);
                const quantityInCart = cartItem ? cartItem.quantity : 0;
                
                // Use product image if available, otherwise show sachets
                let imageHtml;
                if (p.media && p.media.length > 0) {
                    const firstImage = p.media.find(m => m.type === 'image') || p.media[0];
                    imageHtml = `<img src="${firstImage.url}" alt="${p.name}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 12px;">`;
                } else {
                    // For bundles, show multiple small sachets
                    if (isBundle) {
                        const bundleFlavors = getBundleFlavors();
                        imageHtml = `
                            <div style="display: flex; gap: 6px;">
                                ${bundleFlavors.slice(0, 3).map(f => `
                                    <div class="mini-sachet" style="width: 40px; height: 55px; box-shadow: 0 10px 25px ${hexToRgba(f.color, 0.25)};"></div>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        imageHtml = `<div class="mini-sachet" style="box-shadow: 0 15px 40px ${hexToRgba(glowColor, 0.3)};"></div>`;
                    }
                }
                
                // Build button HTML based on cart status
                let buttonHtml;
                if (quantityInCart > 0) {
                    buttonHtml = `
                        <div class="related-qty-controls" data-product-id="${uniqueId}" style="
                            display: flex;
                            align-items: center;
                            gap: 0.5rem;
                            background: rgba(0, 212, 255, 0.1);
                            border: 1px solid rgba(0, 212, 255, 0.3);
                            border-radius: 20px;
                            padding: 0.25rem;
                        ">
                            <button onclick="updateRelatedQty('${p.slug}', ${packSize.size}, '${flavour?.slug || ''}', -1, event)" style="
                                width: 28px;
                                height: 28px;
                                border-radius: 50%;
                                border: none;
                                background: rgba(255,255,255,0.1);
                                color: var(--flow-cyan);
                                font-size: 1rem;
                                font-weight: 600;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">âˆ’</button>
                            <span class="related-qty-value" style="
                                min-width: 24px;
                                text-align: center;
                                font-weight: 600;
                                color: var(--flow-white);
                                font-size: 0.85rem;
                            ">${quantityInCart}</span>
                            <button onclick="updateRelatedQty('${p.slug}', ${packSize.size}, '${flavour?.slug || ''}', 1, event)" style="
                                width: 28px;
                                height: 28px;
                                border-radius: 50%;
                                border: none;
                                background: var(--flow-cyan);
                                color: var(--flow-dark);
                                font-size: 1rem;
                                font-weight: 600;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">+</button>
                        </div>
                    `;
                } else {
                    buttonHtml = `
                        <button class="related-add-to-cart" onclick="addRelatedToCart('${p.slug}', ${packSize.size}, '${flavour?.slug || ''}', event)" style="
                            background: var(--flow-cyan);
                            color: var(--flow-dark);
                            border: none;
                            padding: 0.5rem 0.75rem;
                            border-radius: 20px;
                            font-size: 0.8rem;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s ease;
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            Add to Cart
                        </button>
                    `;
                }
                
                return `
                    <div class="related-card">
                        <a href="${productUrl}" class="related-image">
                            ${imageHtml}
                        </a>
                        <div class="related-info">
                            <a href="${productUrl}" style="text-decoration: none; color: inherit;">
                                <h4>${p.name} ${packSize.label}</h4>
                            </a>
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.5rem;">
                                <div>
                                    <span class="price">â‚¹${packSize.price.toLocaleString()}</span>
                                    ${packSize.comparePrice ? `<span style="color: var(--flow-gray); text-decoration: line-through; font-size: 0.85rem; margin-left: 0.5rem;">â‚¹${packSize.comparePrice.toLocaleString()}</span>` : ''}
                                </div>
                                ${buttonHtml}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateRelatedQty(productSlug, packSize, flavourSlug, delta, event) {
            event.preventDefault();
            event.stopPropagation();
            
            const targetProduct = allProducts.find(p => p.slug === productSlug);
            if (!targetProduct) return;
            
            // Extract flavor from product name or use flavourSlug if provided
            const extractedFlavour = extractFlavorFromName(targetProduct.name);
            const targetFlavour = flavourSlug ? (extractedFlavour.slug === flavourSlug ? extractedFlavour : null) : null;
            const uniqueId = targetFlavour 
                ? `${productSlug}-${targetFlavour.slug}-${packSize}`
                : `${productSlug}-${packSize}`;
            
            let cart = typeof CustomerAuth !== 'undefined' ? CustomerAuth.getLocalCart() : JSON.parse(localStorage.getItem('flow_cart') || '[]');
            const itemIndex = cart.findIndex(c => c.productSlug === uniqueId);
            
            if (itemIndex >= 0) {
                const newQty = cart[itemIndex].quantity + delta;
                
                if (newQty <= 0) {
                    cart.splice(itemIndex, 1);
                } else {
                    cart[itemIndex].quantity = newQty;
                }
                
                if (typeof CustomerAuth !== 'undefined') {
                    CustomerAuth.saveLocalCart(cart);
                    if (CustomerAuth.isLoggedIn()) {
                        CustomerAuth.syncCartToServer(cart);
                    }
                } else {
                    localStorage.setItem('flow_cart', JSON.stringify(cart));
                }
                
                loadCartData();
                renderRelatedProducts(); // Re-render to update button state
            }
        }

        function addRelatedToCart(productSlug, packSize, flavourSlug, event) {
            event.preventDefault();
            event.stopPropagation();
            
            // Get the button that was clicked
            const btn = event.currentTarget;
            
            // Find the product from allProducts
            const targetProduct = allProducts.find(p => p.slug === productSlug);
            if (!targetProduct) {
                showToast('Product not found');
                return;
            }
            
            const targetPackSize = targetProduct.packSizes.find(p => p.size === packSize);
            // Extract flavor from product name (new API)
            const extractedFlavour = extractFlavorFromName(targetProduct.name);
            const targetFlavour = flavourSlug ? (extractedFlavour.slug === flavourSlug ? extractedFlavour : null) : null;
            
            if (!targetPackSize) {
                showToast('Pack size not found');
                return;
            }
            
            // Get the primary image from the related product
            const primaryImage = targetProduct.media?.find(m => m.isPrimary && m.type === 'image') 
                              || targetProduct.media?.find(m => m.type === 'image');
            const imageUrl = primaryImage ? primaryImage.url : null;
            
            // Build display name and unique ID
            const flavourName = targetFlavour ? targetFlavour.name : (targetProduct.category === 'bundle' ? 'Variety' : extractedFlavour.name);
            const displayName = `Flow ${flavourName} â€” ${targetPackSize.label}`;
            const uniqueId = targetFlavour 
                ? `${targetProduct.slug}-${targetFlavour.slug}-${targetPackSize.size}`
                : `${targetProduct.slug}-${targetPackSize.size}`;
            
            // Create cart item in the correct format
            const cartItem = {
                productId: targetProduct._id,
                productSlug: uniqueId,
                name: displayName,
                flavour: targetFlavour ? targetFlavour.name : null,
                quantity: 1,
                price: targetPackSize.price,
                image: imageUrl
            };
            
            // Show loading feedback on button
            btn.innerHTML = 'âœ“ Adding...';
            btn.style.background = '#10B981';
            btn.disabled = true;
            
            // Use CustomerAuth if available
            if (typeof CustomerAuth !== 'undefined') {
                CustomerAuth.addToCart(cartItem).then(() => {
                    loadCartData();
                    renderRelatedProducts(); // Re-render to show quantity controls
                    showToast(`Added ${displayName} to cart!`);
                    openCart();
                });
            } else {
                // Fallback to localStorage
                let cart = JSON.parse(localStorage.getItem('flow_cart') || '[]');
                
                const existingIndex = cart.findIndex(item => 
                    item.productSlug === uniqueId && item.flavour === cartItem.flavour
                );
                
                if (existingIndex >= 0) {
                    cart[existingIndex].quantity += 1;
                } else {
                    cart.push(cartItem);
                }
                
                localStorage.setItem('flow_cart', JSON.stringify(cart));
                loadCartData();
                renderRelatedProducts(); // Re-render to show quantity controls
                showToast(`Added ${displayName} to cart!`);
                openCart();
            }
        }

        async function markHelpful(btn) {
            // Prevent double-clicking
            if (btn.disabled) return;
            btn.disabled = true;
            
            // Get review ID from the button's parent review card
            const reviewCard = btn.closest('.review-card');
            const reviewId = reviewCard?.dataset?.reviewId;
            
            // Optimistically update the UI
            const match = btn.textContent.match(/\((\d+)\)/);
            if (match) {
                const count = parseInt(match[1]) + 1;
                btn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/>
                    </svg>
                    Helpful (${count})
                `;
                btn.classList.add('active');
            }
            
            // If we have a review ID and product slug, call the API
            if (reviewId && product?.slug) {
                try {
                    await fetch(`${API_BASE_URL}/api/products/${product.slug}/reviews/${reviewId}/helpful`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                } catch (error) {
                    console.error('Error marking review as helpful:', error);
                    // UI already updated, so we don't revert
                }
            }
        }

        // Tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });

        // Thumbnails - handled by switchMainView function

        // Toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        // Show Coming Soon toast
        function showComingSoonToast(event) {
            event.preventDefault();
            showToast('Coming Soon!');
        }

        // FAQ Toggle
        function toggleFaq(btn) {
            const faqItem = btn.closest('.faq-item');
            const isActive = faqItem.classList.contains('active');
            
            // Close all FAQs
            document.querySelectorAll('.faq-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Open clicked FAQ if it wasn't already open
            if (!isActive) {
                faqItem.classList.add('active');
            }
        }

        // Add to Cart
        function addToCart() {
            if (!selectedPackSize) {
                showToast('Please select a pack size');
                return;
            }
            
            // Get the primary image or first image from product media
            const primaryImage = productMedia.find(m => m.isPrimary && m.type === 'image') 
                              || productMedia.find(m => m.type === 'image');
            const imageUrl = primaryImage ? primaryImage.url : null;
            
            // Build display name
            const flavourName = selectedFlavour ? selectedFlavour.name : (product.category === 'bundle' ? 'Variety' : 'Original');
            const displayName = `Flow ${flavourName} â€” ${selectedPackSize.label}`;
            const uniqueId = selectedFlavour 
                ? `${product.slug}-${selectedFlavour.slug}-${selectedPackSize.size}`
                : `${product.slug}-${selectedPackSize.size}`;
            
            // Create cart item
            const cartItem = {
                productId: product._id,
                productSlug: uniqueId,
                name: displayName,
                flavour: selectedFlavour ? selectedFlavour.name : null,
                quantity: quantity,
                price: selectedPackSize.price,
                image: imageUrl
            };
            
            // Use CustomerAuth if available
            if (typeof CustomerAuth !== 'undefined') {
                CustomerAuth.addToCart(cartItem).then(() => {
                    loadCartData();
                    showToast(`${quantity} item${quantity > 1 ? 's' : ''} added to cart!`);
                    openCart();
                });
            } else {
                // Fallback to localStorage
                let cart = JSON.parse(localStorage.getItem('flow_cart') || '[]');
                
                const existingIndex = cart.findIndex(item => 
                    item.productSlug === uniqueId && item.flavour === cartItem.flavour
                );
                
                if (existingIndex >= 0) {
                    cart[existingIndex].quantity += quantity;
                } else {
                    cart.push(cartItem);
                }
                
                localStorage.setItem('flow_cart', JSON.stringify(cart));
                loadCartData();
                showToast(`${quantity} item${quantity > 1 ? 's' : ''} added to cart!`);
                openCart();
            }
        }

        // Buy Now - purchase only this item directly (clears cart, adds only this item, opens checkout)
        function buyNow() {
            if (!selectedPackSize) {
                showToast('Please select a pack size');
                return;
            }
            
            // Check if user is logged in first
            if (typeof CustomerAuth !== 'undefined' && !CustomerAuth.isLoggedIn()) {
                CustomerAuth.showLoginModal();
                return;
            }
            
            // Get the primary image or first image from product media
            const primaryImage = productMedia.find(m => m.isPrimary && m.type === 'image') 
                              || productMedia.find(m => m.type === 'image');
            const imageUrl = primaryImage ? primaryImage.url : null;
            
            // Build display name
            const flavourName = selectedFlavour ? selectedFlavour.name : (product.category === 'bundle' ? 'Variety' : 'Original');
            const displayName = `Flow ${flavourName} â€” ${selectedPackSize.label}`;
            const uniqueId = selectedFlavour 
                ? `${product.slug}-${selectedFlavour.slug}-${selectedPackSize.size}`
                : `${product.slug}-${selectedPackSize.size}`;
            
            // Create cart item for ONLY this product
            const buyNowItem = {
                productId: product._id,
                productSlug: uniqueId,
                name: displayName,
                flavour: selectedFlavour ? selectedFlavour.name : null,
                quantity: quantity,
                price: selectedPackSize.price,
                image: imageUrl
            };
            
            // Save current cart to restore later if user cancels
            const existingCart = localStorage.getItem('flow_cart');
            if (existingCart) {
                localStorage.setItem('flow_cart_backup', existingCart);
            }
            
            // Set cart to ONLY this item (for Buy Now)
            const buyNowCart = [buyNowItem];
            localStorage.setItem('flow_cart', JSON.stringify(buyNowCart));
            
            // Determine shop URL based on environment
            const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            const shopUrl = isLocal ? '/flow-shop-2.html?checkout=true&buynow=true' : '/shop/?checkout=true&buynow=true';
            
            // Sync to server if logged in
            if (typeof CustomerAuth !== 'undefined' && CustomerAuth.isLoggedIn()) {
                CustomerAuth.syncCartToServer(buyNowCart).then(() => {
                    // Redirect to checkout
                    window.location.href = shopUrl;
                }).catch(() => {
                    // Still redirect even if sync fails
                    window.location.href = shopUrl;
                });
            } else {
                window.location.href = shopUrl;
            }
        }

        // Mobile Menu Functions
        function toggleMobileMenu() {
            const mobileMenu = document.querySelector('.mobile-menu');
            const mobileMenuOverlay = document.querySelector('.mobile-menu-overlay');
            if (mobileMenu) {
                mobileMenu.classList.toggle('active');
            }
            if (mobileMenuOverlay) {
                mobileMenuOverlay.classList.toggle('active');
            }
            document.body.style.overflow = mobileMenu?.classList.contains('active') ? 'hidden' : '';
        }

        function closeMobileMenu() {
            const mobileMenu = document.querySelector('.mobile-menu');
            const mobileMenuOverlay = document.querySelector('.mobile-menu-overlay');
            if (mobileMenu) {
                mobileMenu.classList.remove('active');
            }
            if (mobileMenuOverlay) {
                mobileMenuOverlay.classList.remove('active');
            }
            document.body.style.overflow = '';
        }

        // Update sticky cart price
        function updateStickyCart() {
            const stickyPrice = document.querySelector('.sticky-price');
            const priceDisplay = document.getElementById('priceDisplay');
            if (stickyPrice && priceDisplay) {
                stickyPrice.textContent = priceDisplay.textContent;
            }
        }

        // Initialize sticky cart on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateStickyCart();
            loadSavedDiscount(); // Load saved discount BEFORE loading cart data
            loadCartData();
            
            // Wire up cart button
            const cartToggle = document.getElementById('cartToggle');
            if (cartToggle) {
                cartToggle.addEventListener('click', openCart);
            }
            
            // Handle discount code input enter key
            const discountInput = document.getElementById('cartDiscountCode');
            if (discountInput) {
                discountInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') applyCartDiscount();
                });
                discountInput.addEventListener('input', () => {
                    discountInput.classList.remove('error');
                    document.getElementById('cartDiscountError').style.display = 'none';
                });
            }
        });

        // ========== CART FUNCTIONS ==========
        const FREE_SHIPPING = 999;
        const SHIPPING_COST = 99;
        let cartData = [];
        
        // Discount code state (must be before updateCartUI)
        let cartDiscount = 0;
        let cartDiscountCode = null;
        let cartDiscountType = null;
        let cartDiscountValue = null;

        async function loadCartData() {
            try {
                if (typeof CustomerAuth !== 'undefined' && CustomerAuth.isLoggedIn()) {
                    const serverCart = await CustomerAuth.fetchCart();
                    if (serverCart && Array.isArray(serverCart)) {
                        cartData = serverCart;
                    }
                } else {
                    cartData = JSON.parse(localStorage.getItem('flow_cart') || '[]');
                }
            } catch (error) {
                console.log('Error loading cart:', error);
                cartData = JSON.parse(localStorage.getItem('flow_cart') || '[]');
            }
            updateCartUI();
        }

        function updateCartUI() {
            const totalItems = cartData.reduce((sum, item) => sum + item.quantity, 0);
            const subtotal = cartData.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = subtotal >= FREE_SHIPPING ? 0 : SHIPPING_COST;
            const totalBeforeDiscount = subtotal + shipping;
            
            // Recalculate discount if we have an active discount code
            // Discount is applied on total (subtotal + shipping)
            if (cartDiscountCode && cartDiscountType && cartDiscountValue) {
                if (cartDiscountType === 'percent' || cartDiscountType === 'percentage') {
                    cartDiscount = Math.round(totalBeforeDiscount * cartDiscountValue / 100);
                } else {
                    cartDiscount = cartDiscountValue;
                }
                const discountAmountEl = document.getElementById('cartDiscountAmount');
                if (discountAmountEl) {
                    discountAmountEl.textContent = `-â‚¹${cartDiscount}`;
                }
            }
            
            // Ensure cartDiscount is always a valid number
            const safeDiscount = typeof cartDiscount === 'number' && !isNaN(cartDiscount) ? cartDiscount : 0;
            const total = Math.max(0, totalBeforeDiscount - safeDiscount);

            // Update cart count badges
            const cartCount = document.getElementById('cartCount');
            const mobileCartCount = document.getElementById('mobileCartCount');
            if (cartCount) cartCount.textContent = totalItems;
            if (mobileCartCount) {
                mobileCartCount.textContent = totalItems;
                mobileCartCount.style.display = totalItems > 0 ? 'flex' : 'none';
            }

            // Update cart drawer
            const cartItems = document.getElementById('cartItems');
            const cartFooter = document.getElementById('cartFooter');

            if (!cartItems || !cartFooter) return;

            if (cartData.length === 0) {
                cartItems.innerHTML = `
                    <div class="cart-empty">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                            <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                        </svg>
                        <p>Your cart is empty</p>
                        <a href="/shop/">Continue Shopping</a>
                    </div>
                `;
                cartFooter.style.display = 'none';
            } else {
                const escapedItems = cartData.map(item => {
                    const escapedId = (item.productSlug || item.productId || '').replace(/'/g, "\\'");
                    return `
                        <div class="cart-item">
                            <div class="cart-item-image">
                                ${item.image ? `<img src="${item.image}" alt="${item.name}">` : `
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" width="30" height="30" style="opacity: 0.5;">
                                        <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                                    </svg>
                                `}
                            </div>
                            <div class="cart-item-details">
                                <div class="cart-item-name">${item.name}</div>
                                ${item.flavour ? `<div class="cart-item-variant">${item.flavour}</div>` : ''}
                                <div class="cart-item-bottom">
                                    <div class="cart-qty-control">
                                        <button class="cart-qty-btn" onclick="updateCartQuantity('${escapedId}', -1)">âˆ’</button>
                                        <span class="cart-qty-value">${item.quantity}</span>
                                        <button class="cart-qty-btn" onclick="updateCartQuantity('${escapedId}', 1)">+</button>
                                    </div>
                                    <span class="cart-item-price">â‚¹${(item.price * item.quantity).toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                cartItems.innerHTML = escapedItems.join('');
                cartFooter.style.display = 'block';
            }

            // Update totals
            const cartSubtotal = document.getElementById('cartSubtotal');
            const cartShipping = document.getElementById('cartShipping');
            const cartTotal = document.getElementById('cartTotal');
            const shippingText = document.getElementById('shippingText');
            const shippingBar = document.getElementById('shippingBar');

            if (cartSubtotal) cartSubtotal.textContent = `â‚¹${subtotal.toLocaleString()}`;
            if (cartShipping) cartShipping.textContent = shipping === 0 ? 'FREE' : `â‚¹${shipping}`;
            if (cartTotal) cartTotal.textContent = `â‚¹${Math.max(0, total).toLocaleString()}`;

            // Shipping progress
            const remaining = Math.max(0, FREE_SHIPPING - subtotal);
            const progress = Math.min(100, (subtotal / FREE_SHIPPING) * 100);
            if (shippingText) {
                if (remaining > 0) {
                    shippingText.innerHTML = `Add <span>â‚¹${remaining.toLocaleString()}</span> more for free shipping`;
                } else {
                    shippingText.innerHTML = `<span>ðŸŽ‰ You qualify for free shipping!</span>`;
                }
            }
            if (shippingBar) shippingBar.style.width = `${progress}%`;
        }

        function updateCartQuantity(id, delta) {
            const item = cartData.find(i => i.productId === id || i.productSlug === id);
            if (!item) return;

            item.quantity += delta;
            if (item.quantity <= 0) {
                cartData = cartData.filter(i => i !== item);
            }

            // Save to localStorage
            localStorage.setItem('flow_cart', JSON.stringify(cartData));

            // Sync to server in background
            if (typeof CustomerAuth !== 'undefined' && CustomerAuth.isLoggedIn()) {
                CustomerAuth.syncCartToServer(cartData).catch(err => console.log('Cart sync failed:', err));
            }

            updateCartUI();
        }

        function openCart() {
            document.getElementById('cartOverlay').classList.add('active');
            document.getElementById('cartDrawer').classList.add('open');
            document.body.style.overflow = 'hidden';
            loadCartData(); // Refresh cart data when opening
        }

        function closeCart() {
            document.getElementById('cartOverlay').classList.remove('active');
            document.getElementById('cartDrawer').classList.remove('open');
            document.body.style.overflow = '';
        }

        function goToCheckout() {
            if (cartData.length === 0) {
                showToast('Your cart is empty');
                return;
            }
            
            // Determine shop URL based on environment
            const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            let shopUrl = isLocal ? '/flow-shop-2.html?checkout=true' : '/shop/?checkout=true';
            
            // Add discount code to URL if applied
            if (cartDiscountCode) {
                shopUrl += `&discount=${encodeURIComponent(cartDiscountCode)}`;
            }
            
            // Check if user is logged in
            if (typeof CustomerAuth !== 'undefined' && !CustomerAuth.isLoggedIn()) {
                // Show login modal with callback to redirect to checkout after login
                CustomerAuth.showLoginModal(() => {
                    window.location.href = shopUrl;
                });
                return;
            }
            
            // Redirect to checkout - the shop page will open checkout modal
            window.location.href = shopUrl;
        }

        async function applyCartDiscount() {
            const codeInput = document.getElementById('cartDiscountCode');
            const errorEl = document.getElementById('cartDiscountError');
            const applyBtn = document.getElementById('cartApplyBtn');
            const code = codeInput.value.trim().toUpperCase();
            
            // Hide any previous error
            errorEl.style.display = 'none';
            codeInput.classList.remove('error');
            
            if (!code) {
                errorEl.textContent = 'Please enter a discount code';
                errorEl.style.display = 'block';
                return;
            }
            
            const subtotal = cartData.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shippingThreshold = parseInt(document.getElementById('cartShippingFee')?.dataset?.threshold) || 499;
            const shippingFee = parseInt(document.getElementById('cartShippingFee')?.dataset?.fee) || 49;
            const shipping = subtotal >= shippingThreshold ? 0 : shippingFee;
            const orderTotal = subtotal + shipping;
            
            // Disable button while validating
            applyBtn.disabled = true;
            applyBtn.textContent = '...';
            
            try {
                const response = await fetch(`${API_BASE}/api/discount-codes/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, orderTotal: orderTotal })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // API returns: data.code.type, data.code.value, data.code.discountAmount
                    const discountInfo = data.code || data;
                    cartDiscount = Math.round(discountInfo.discountAmount || data.discount || 0);
                    cartDiscountCode = code;
                    // Handle both 'percent' and 'percentage' types
                    cartDiscountType = (discountInfo.type === 'percent' || discountInfo.type === 'percentage') ? 'percent' : 'fixed';
                    cartDiscountValue = discountInfo.value || data.discountValue || 0;
                    
                    // Show applied discount
                    document.getElementById('cartDiscountInput').style.display = 'none';
                    document.getElementById('cartAppliedDiscount').style.display = 'flex';
                    document.getElementById('cartDiscountCodeLabel').textContent = code;
                    
                    let valueText = cartDiscountType === 'percent' ? `-${cartDiscountValue}%` : `-â‚¹${cartDiscountValue}`;
                    if (discountInfo.maxDiscount && cartDiscountType === 'percent') {
                        valueText += ` (max â‚¹${discountInfo.maxDiscount})`;
                    }
                    document.getElementById('cartDiscountValueLabel').textContent = valueText;
                    
                    document.getElementById('cartDiscountRow').style.display = 'flex';
                    document.getElementById('cartDiscountAmount').textContent = `-â‚¹${cartDiscount}`;
                    
                    codeInput.value = '';
                    
                    updateCartUI();
                    showToast(`Discount code "${code}" applied!`);
                } else {
                    codeInput.classList.add('error');
                    errorEl.textContent = data.message || 'Invalid discount code. Please try again.';
                    errorEl.style.display = 'block';
                }
            } catch (error) {
                console.error('Error applying discount:', error);
                codeInput.classList.add('error');
                errorEl.textContent = 'Unable to validate code. Please try again.';
                errorEl.style.display = 'block';
            } finally {
                applyBtn.disabled = false;
                applyBtn.textContent = 'Apply';
            }
        }

        function removeCartDiscount() {
            cartDiscount = 0;
            cartDiscountCode = null;
            cartDiscountType = null;
            cartDiscountValue = null;
            
            document.getElementById('cartDiscountInput').style.display = 'flex';
            document.getElementById('cartAppliedDiscount').style.display = 'none';
            document.getElementById('cartDiscountRow').style.display = 'none';
            document.getElementById('cartDiscountCode').value = '';
            document.getElementById('cartDiscountError').style.display = 'none';
            
            updateCartUI();
            showToast('Discount removed');
        }

        function loadSavedDiscount() {
            // Discount is not persisted - user must re-apply each session
        }
    </script>

    <!-- Mobile Sticky Add to Cart -->
    <div class="mobile-sticky-cart">
        <div class="sticky-cart-content">
            <span class="sticky-price" id="stickyPrice">â‚¹899</span>
            <button class="sticky-add-btn" onclick="addToCart()">Add to Cart</button>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-bottom-nav">
        <a href="/" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            <span>Home</span>
        </a>
        <a href="/shop/" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
            <span>Shop</span>
        </a>
        <button class="nav-item cart-nav-item" onclick="openCart()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
            <span class="mobile-cart-count" id="mobileCartCount">0</span>
            <span>Cart</span>
        </button>
        <a href="/profile/" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <span>Profile</span>
        </a>
    </nav>
</body>
</html>
