<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop — Flow Hydration</title>
    <!-- Mobile redirect - must be first -->
    <script>
        (function() {
            var MOBILE_BREAKPOINT = 768;
            
            function checkMobile() {
                return window.innerWidth <= MOBILE_BREAKPOINT || 
                       /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }
            
            function redirectToMobile() {
                var params = window.location.search;
                window.location.replace('/shop-mobile.html' + params);
            }
            
            // Initial redirect
            if (checkMobile() && !window.location.hash) {
                redirectToMobile();
                return;
            }
            
            // Listen for resize
            var resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    if (checkMobile()) {
                        redirectToMobile();
                    }
                }, 250);
            });
        })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Syne:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/customerAuth.css">
    <!-- Google Maps callback must be defined before the script loads -->
    <script>
        var googleMapsReady = false;
        function initGoogleMaps() {
            googleMapsReady = true;
            console.log('Google Maps API loaded');
        }
    </script>
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBb4ve4orTO8kVsMbJhlV6KtYswlE2LZ7s&libraries=places&callback=initGoogleMaps" async defer></script>
    <!-- Razorpay Checkout -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        :root {
            --flow-blue: #0A1628;
            --flow-cyan: #00D4FF;
            --flow-teal: #00B4B4;
            --flow-white: #FAFCFF;
            --flow-gray: #94A3B8;
            --flow-dark: #020817;
            --flow-card: #0d1a2d;
            --gradient-flow: linear-gradient(135deg, #00D4FF 0%, #00B4B4 50%, #0A1628 100%);
            --gradient-water: linear-gradient(180deg, rgba(0, 212, 255, 0.15) 0%, rgba(0, 180, 180, 0.05) 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--flow-dark);
            color: var(--flow-white);
            overflow-x: hidden;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Animated water background */
        .water-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: var(--flow-dark);
        }

        .water-bg::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(0, 212, 255, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(0, 180, 180, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(0, 212, 255, 0.04) 0%, transparent 60%);
            animation: floatBg 20s ease-in-out infinite;
        }

        @keyframes floatBg {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(2%, 2%) rotate(1deg); }
            50% { transform: translate(0, 4%) rotate(0deg); }
            75% { transform: translate(-2%, 2%) rotate(-1deg); }
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 0.75rem 4%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(20px);
            background: rgba(2, 8, 23, 0.9);
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .logo-img {
            height: 55px;
            width: auto;
        }

        .nav-links {
            display: flex;
            gap: 2.5rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--flow-gray);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-links a.active,
        .nav-links a:hover {
            color: var(--flow-white);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .cart-btn {
            position: relative;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 0.6rem 1rem;
            border-radius: 50px;
            color: var(--flow-white);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .cart-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--flow-cyan);
        }

        .cart-btn .cart-text {
            max-width: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-width 0.3s ease, opacity 0.3s ease;
        }

        .cart-btn:hover .cart-text {
            max-width: 50px;
            opacity: 1;
        }

        .cart-count {
            background: var(--flow-cyan);
            color: var(--flow-dark);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .profile-btn {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 0.6rem;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            color: var(--flow-white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            text-decoration: none;
            overflow: hidden;
        }

        .profile-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--flow-cyan);
            width: auto;
            padding: 0.6rem 1rem;
            border-radius: 50px;
            gap: 0.4rem;
        }

        .profile-btn .profile-text {
            max-width: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-width 0.3s ease, opacity 0.3s ease;
        }

        .profile-btn:hover .profile-text {
            max-width: 60px;
            opacity: 1;
        }

        /* Shop Layout */
        .shop-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 3rem;
            padding: 7rem 8% 6rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Sidebar Header */
        .sidebar-header {
            margin-bottom: 2rem;
        }

        .sidebar-header h1 {
            font-family: 'Syne', sans-serif;
            font-size: clamp(1.75rem, 4vw, 2.25rem);
            font-weight: 800;
            margin-bottom: 0.75rem;
            line-height: 1.2;
        }

        .sidebar-header h1 span {
            background: var(--gradient-flow);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-header p {
            color: var(--flow-gray);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Sidebar Filters */
        .shop-sidebar {
            position: sticky;
            top: 120px;
            height: fit-content;
        }

        .filter-section {
            background: rgba(13, 26, 45, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .filter-section h3 {
            font-family: 'Syne', sans-serif;
            font-size: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-option:hover {
            background: rgba(0, 212, 255, 0.05);
        }

        .filter-option.active {
            background: rgba(0, 212, 255, 0.1);
        }

        .filter-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .filter-option.active .filter-checkbox {
            background: var(--flow-cyan);
            border-color: var(--flow-cyan);
        }

        .filter-option.active .filter-checkbox::after {
            content: '✓';
            color: var(--flow-dark);
            font-size: 0.75rem;
            font-weight: 700;
        }

        .filter-label {
            color: var(--flow-gray);
            font-size: 0.9rem;
            transition: color 0.3s ease;
            flex: 1;
            padding: 0.1rem 0;
        }

        .filter-option.active .filter-label,
        .filter-option:hover .filter-label {
            color: var(--flow-white);
        }

        .filter-count {
            margin-left: auto;
            color: var(--flow-gray);
            font-size: 0.8rem;
        }

        /* Promo Banner in Sidebar */
        .promo-banner {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(0, 180, 180, 0.1) 100%);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 20px;
            padding: 1.5rem;
            text-align: center;
        }

        .promo-banner h4 {
            font-family: 'Syne', sans-serif;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .promo-banner p {
            color: var(--flow-gray);
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .promo-code {
            background: var(--flow-dark);
            border: 1px dashed var(--flow-cyan);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-family: 'Syne', sans-serif;
            font-weight: 600;
            color: var(--flow-cyan);
            font-size: 0.9rem;
        }

        /* Products Grid */
        .products-section {
            flex: 1;
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .products-count {
            color: var(--flow-gray);
            font-size: 0.95rem;
        }

        .sort-dropdown {
            background: rgba(13, 26, 45, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 10px;
            padding: 0.75rem 2.5rem 0.75rem 1.25rem;
            color: var(--flow-white);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2394A3B8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
        }

        .sort-dropdown:hover,
        .sort-dropdown:focus {
            border-color: var(--flow-cyan);
        }

        .sort-dropdown option {
            background: var(--flow-dark);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        /* Product Card */
        .product-card {
            background: linear-gradient(145deg, rgba(13, 26, 45, 0.8) 0%, rgba(13, 26, 45, 0.4) 100%);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 24px;
            overflow: hidden;
            transition: all 0.4s ease;
            position: relative;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-8px);
            border-color: rgba(0, 212, 255, 0.4);
            box-shadow: 0 25px 80px rgba(0, 212, 255, 0.15);
        }

        .product-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: rgba(10, 22, 40, 0.85);
            color: var(--flow-white);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            z-index: 5;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .product-badge.bestseller {
            background: rgba(10, 22, 40, 0.9);
            border-color: rgba(255, 215, 0, 0.4);
            color: #FFD700;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.15), inset 0 1px 0 rgba(255, 215, 0, 0.1);
        }

        .product-badge.new {
            background: rgba(10, 22, 40, 0.9);
            border-color: rgba(0, 212, 255, 0.4);
            color: var(--flow-cyan);
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.15), inset 0 1px 0 rgba(0, 212, 255, 0.1);
        }

        .product-badge.sale {
            background: rgba(10, 22, 40, 0.9);
            border-color: rgba(16, 185, 129, 0.4);
            color: #10B981;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.15), inset 0 1px 0 rgba(16, 185, 129, 0.1);
        }

        .product-image {
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, rgba(0, 212, 255, 0.05) 0%, transparent 100%);
            position: relative;
            overflow: hidden;
        }

        .product-image::before {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(0, 212, 255, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .sachet-visual {
            width: 120px;
            height: 170px;
            background: linear-gradient(135deg, #0A1628 0%, #1a2d4a 50%, #0A1628 100%);
            border-radius: 14px 14px 20px 20px;
            position: relative;
            box-shadow: 
                0 20px 50px rgba(0, 212, 255, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            z-index: 2;
            transition: transform 0.4s ease;
        }

        .product-card:hover .sachet-visual {
            transform: scale(1.05) rotate(-2deg);
        }

        .sachet-visual::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 25px;
            background: linear-gradient(180deg, rgba(0, 212, 255, 0.2) 0%, transparent 100%);
            border-radius: 14px 14px 0 0;
        }

        .sachet-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .sachet-logo {
            font-family: 'Syne', sans-serif;
            font-size: 1.2rem;
            font-weight: 800;
            background: var(--gradient-flow);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sachet-flavor {
            font-size: 0.55rem;
            color: var(--flow-cyan);
            margin-top: 0.25rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        /* Different sachet colors for flavors */
        .product-card[data-flavor="citrus"] .sachet-visual {
            background: linear-gradient(135deg, #1a2d1a 0%, #2d4a2d 50%, #1a2d1a 100%);
        }

        .product-card[data-flavor="berry"] .sachet-visual {
            background: linear-gradient(135deg, #2d1a2d 0%, #4a2d4a 50%, #2d1a2d 100%);
        }

        .product-card[data-flavor="tropical"] .sachet-visual {
            background: linear-gradient(135deg, #2d2a1a 0%, #4a3d2d 50%, #2d2a1a 100%);
        }

        .product-card[data-flavor="mint"] .sachet-visual {
            background: linear-gradient(135deg, #1a2d2d 0%, #2d4a4a 50%, #1a2d2d 100%);
        }

        /* Product Thumbnail Image */
        .product-thumbnail-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 2;
            transition: transform 0.4s ease;
        }

        /* Bundle/Variety Pack - stretch image to fill container */
        .product-card.bundle .product-thumbnail-img {
            object-fit: fill;
        }

        .product-card:hover .product-thumbnail-img {
            transform: scale(1.05);
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-category {
            color: var(--flow-cyan);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .product-name {
            font-family: 'Syne', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .product-desc {
            color: var(--flow-gray);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .product-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.25rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            color: var(--flow-gray);
            font-size: 0.8rem;
        }

        .meta-item svg {
            width: 14px;
            height: 14px;
            stroke: var(--flow-cyan);
        }

        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-price {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }

        .price-current {
            font-family: 'Syne', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--flow-white);
        }

        .price-original {
            font-size: 1rem;
            color: var(--flow-gray);
            text-decoration: line-through;
        }

        .add-to-cart {
            background: var(--flow-cyan);
            color: var(--flow-dark);
            border: none;
            padding: 0.85rem 1.5rem;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .add-to-cart:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
        }

        .add-to-cart.added {
            background: #00B4B4;
        }

        /* Quantity Selector (shown after adding) */
        .quantity-selector {
            display: none;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 50px;
            padding: 0.35rem;
        }

        .quantity-selector.active {
            display: flex;
        }

        .qty-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--flow-cyan);
            color: var(--flow-dark);
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qty-btn:hover {
            transform: scale(1.1);
        }

        .qty-value {
            min-width: 30px;
            text-align: center;
            font-weight: 600;
            font-size: 1rem;
        }

        /* Featured Product (larger card) */
        .product-card.featured {
            grid-column: span 2;
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        .product-card.featured .product-image {
            height: 100%;
            min-height: 350px;
            max-height: 350px;
        }

        .product-card.featured .product-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 2.5rem;
        }

        .product-card.featured .product-name {
            font-size: 1.75rem;
        }

        .product-card.featured .product-desc {
            font-size: 1rem;
        }

        /* Bundle Card Special Styling */
        .product-card.bundle .product-image {
            flex-direction: row;
            gap: 1rem;
        }

        .product-card.bundle .sachet-visual {
            width: 80px;
            height: 115px;
        }

        .product-card.bundle .sachet-logo {
            font-size: 0.9rem;
        }

        /* Cart Drawer */
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .cart-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .cart-drawer {
            position: fixed;
            top: 0;
            right: -380px;
            width: 380px;
            max-width: 100%;
            height: 100%;
            background: var(--flow-dark);
            border-left: 1px solid rgba(0, 212, 255, 0.2);
            z-index: 2001;
            transition: right 0.4s ease;
            display: flex;
            flex-direction: column;
        }

        .cart-drawer.active {
            right: 0;
        }

        .cart-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(13, 26, 45, 0.5);
        }

        .cart-header h3 {
            font-family: 'Syne', sans-serif;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cart-header h3 svg {
            width: 18px;
            height: 18px;
        }

        .cart-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--flow-gray);
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0.4rem;
            border-radius: 8px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-close:hover {
            color: var(--flow-white);
            background: rgba(255, 255, 255, 0.15);
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .cart-empty {
            text-align: center;
            padding: 2.5rem 1rem;
            color: var(--flow-gray);
        }

        .cart-empty-icon {
            margin-bottom: 0.75rem;
            opacity: 0.5;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-empty-icon svg {
            width: 40px;
            height: 40px;
        }

        .cart-empty p {
            font-size: 0.9rem;
        }

        .cart-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(13, 26, 45, 0.5);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            border: 1px solid rgba(0, 212, 255, 0.08);
            transition: all 0.2s ease;
        }

        .cart-item:hover {
            border-color: rgba(0, 212, 255, 0.15);
        }

        .cart-item-image {
            width: 56px;
            height: 70px;
            background: rgba(0, 212, 255, 0.05);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
        }

        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .cart-item-image .mini-sachet {
            width: 32px;
            height: 44px;
            background: linear-gradient(135deg, #0A1628 0%, #1a2d4a 50%, #0A1628 100%);
            border-radius: 4px 4px 8px 8px;
        }

        .cart-item-details {
            flex: 1;
            min-width: 0;
        }

        .cart-item-name {
            font-family: 'Syne', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.15rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .cart-item-variant {
            color: var(--flow-gray);
            font-size: 0.7rem;
            margin-bottom: 0.5rem;
        }

        .cart-item-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-item-qty {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 50px;
            padding: 0.2rem;
        }

        .cart-item-qty button {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: none;
            background: var(--flow-cyan);
            color: var(--flow-dark);
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .cart-item-qty button:hover {
            transform: scale(1.1);
        }

        .cart-item-qty span {
            min-width: 20px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .cart-item-price {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            color: var(--flow-cyan);
            font-size: 0.85rem;
        }

        .cart-item-remove {
            background: none;
            border: none;
            color: var(--flow-gray);
            cursor: pointer;
            font-size: 0.7rem;
            margin-top: 0.35rem;
            transition: color 0.3s ease;
            padding: 0;
        }

        .cart-item-remove:hover {
            color: #FF6B6B;
        }

        .cart-footer {
            padding: 1rem 1.25rem;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
            background: rgba(13, 26, 45, 0.7);
        }

        /* Discount Code Section */
        .discount-section {
            margin-bottom: 0.75rem;
        }

        .discount-form {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            flex-wrap: nowrap;
            align-items: center;
        }

        .discount-input-wrapper {
            flex: 1;
            min-width: 0;
            position: relative;
            display: flex;
            align-items: center;
        }

        .discount-input-icon {
            position: absolute;
            left: 0.75rem;
            width: 14px;
            height: 14px;
            stroke: var(--flow-cyan);
            pointer-events: none;
        }

        .discount-input {
            width: 100%;
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            padding: 0.6rem 0.75rem 0.6rem 2.25rem;
            color: var(--flow-white);
            font-family: 'Outfit', sans-serif;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .discount-input::placeholder {
            color: var(--flow-gray);
            text-transform: none;
            letter-spacing: normal;
        }

        .discount-input:focus {
            outline: none;
            border-color: var(--flow-cyan);
        }

        .discount-apply-btn {
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--flow-cyan);
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Outfit', sans-serif;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .discount-apply-btn:hover {
            background: rgba(0, 212, 255, 0.25);
        }

        .discount-apply-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .discount-applied {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 180, 100, 0.1);
            border: 1px solid rgba(0, 180, 100, 0.3);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.5rem;
        }

        .discount-applied-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .discount-applied-info svg {
            color: #00B464;
            width: 16px;
            height: 16px;
        }

        .discount-applied-code {
            font-size: 0.75rem;
            font-weight: 600;
            color: #00B464;
            text-transform: uppercase;
        }

        .discount-applied-value {
            font-size: 0.75rem;
            color: var(--flow-gray);
        }

        .discount-remove {
            background: none;
            border: none;
            color: var(--flow-gray);
            cursor: pointer;
            padding: 0.25rem;
            transition: color 0.2s ease;
        }

        .discount-remove:hover {
            color: #FF6B6B;
        }

        .discount-error {
            font-size: 0.75rem;
            color: #FF6B6B;
            margin-top: 0.35rem;
        }

        /* Public Discount Codes */
        .public-codes-section {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px dashed rgba(0, 212, 255, 0.2);
        }

        .public-codes-label {
            font-size: 0.7rem;
            color: var(--flow-gray);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .public-codes-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .public-code-chip {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.25);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .public-code-chip:hover {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.4);
        }

        .public-code-name {
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            color: #8b5cf6;
            letter-spacing: 0.05em;
        }

        .public-code-desc {
            font-size: 0.65rem;
            color: var(--flow-gray);
            margin-top: 0.15rem;
        }

        .cart-subtotal {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.35rem;
            color: var(--flow-gray);
            font-size: 0.85rem;
        }

        .cart-discount-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.35rem;
            font-size: 0.85rem;
        }

        .cart-discount-row span:first-child {
            color: #00B464;
        }

        .cart-discount-row span:last-child {
            color: #00B464;
            font-weight: 600;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-family: 'Syne', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
        }

        .checkout-btn {
            width: 100%;
            background: var(--flow-cyan);
            color: var(--flow-dark);
            border: none;
            padding: 0.85rem;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .checkout-btn:hover {
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
            transform: translateY(-2px);
        }

        .checkout-btn svg {
            width: 16px;
            height: 16px;
        }

        .continue-shopping {
            width: 100%;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--flow-white);
            padding: 0.7rem;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            margin-top: 0.6rem;
            transition: all 0.3s ease;
        }

        .continue-shopping:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* Free Shipping Bar */
        .shipping-progress {
            margin-bottom: 0.75rem;
        }

        .shipping-text {
            font-size: 0.75rem;
            color: var(--flow-gray);
            margin-bottom: 0.35rem;
            text-align: center;
        }

        .shipping-text span {
            color: var(--flow-cyan);
            font-weight: 600;
        }

        .shipping-text.free-shipping {
            color: #00B464;
        }

        .shipping-text.free-shipping svg {
            width: 14px;
            height: 14px;
            vertical-align: middle;
            margin-right: 4px;
        }

        .shipping-bar {
            height: 4px;
            background: rgba(0, 212, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .shipping-bar-fill {
            height: 100%;
            background: var(--gradient-flow);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .shipping-bar-fill.complete {
            background: linear-gradient(90deg, #00B464, #00D4A4);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--flow-card);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 1rem 2rem;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 3000;
            opacity: 0;
            transition: all 0.4s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            background: var(--flow-cyan);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--flow-dark);
            font-size: 0.8rem;
        }

        /* Cart Toast Notification - appears below app bar */
        .cart-toast {
            position: fixed;
            top: 75px;
            left: 20px;
            background: var(--flow-card);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 12px 16px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            opacity: 0;
            transform: translateX(-100%);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            max-width: 320px;
        }

        .cart-toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .cart-toast-image {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: linear-gradient(135deg, #0a1628 0%, #1a2d4a 50%, #0a1628 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }

        .cart-toast-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cart-toast-image .sachet-mini {
            width: 30px;
            height: 40px;
            background: linear-gradient(135deg, var(--flow-cyan), var(--flow-purple));
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: bold;
            color: var(--flow-dark);
        }

        .cart-toast-content {
            flex: 1;
            min-width: 0;
        }

        .cart-toast-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--flow-white);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .cart-toast-message {
            font-size: 12px;
            color: var(--flow-cyan);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .cart-toast-message svg {
            width: 14px;
            height: 14px;
        }

        .cart-toast-close {
            background: none;
            border: none;
            color: var(--flow-gray);
            cursor: pointer;
            padding: 4px;
            line-height: 0;
            transition: color 0.2s;
        }

        .cart-toast-close:hover {
            color: var(--flow-white);
        }

        /* Add to Cart button quantity state */
        .add-to-cart.has-quantity {
            background: transparent;
            border: 1px solid var(--flow-cyan);
            color: var(--flow-cyan);
        }

        .add-to-cart.has-quantity:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        .add-to-cart .qty-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-to-cart .qty-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 212, 255, 0.2);
            border: none;
            color: var(--flow-cyan);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .add-to-cart .qty-btn:hover {
            background: var(--flow-cyan);
            color: var(--flow-dark);
        }

        .add-to-cart .qty-count {
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .cart-toast {
                top: 70px;
                right: 10px;
                left: 10px;
                max-width: none;
                transform: translateY(-100%);
            }
            
            .cart-toast.show {
                transform: translateY(0);
            }
        }

        /* ========== QUICK CHECKOUT MODAL ========== */
        .quick-checkout-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            z-index: 5000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .quick-checkout-overlay.active {
            display: flex;
        }

        .quick-checkout-modal {
            background: linear-gradient(145deg, #0d1a2d 0%, #091220 100%);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 24px;
            width: 100%;
            max-width: 440px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5), 0 0 60px rgba(0, 212, 255, 0.1);
        }

        .quick-checkout-modal::-webkit-scrollbar {
            width: 6px;
        }

        .quick-checkout-modal::-webkit-scrollbar-track {
            background: transparent;
        }

        .quick-checkout-modal::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.3);
            border-radius: 10px;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .quick-checkout-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--flow-gray);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .quick-checkout-close:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--flow-white);
        }

        /* Progress Steps */
        .qc-progress {
            display: flex;
            justify-content: center;
            gap: 2rem;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
            position: relative;
        }

        .qc-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.4;
            transition: all 0.3s ease;
            position: relative;
        }

        /* Connecting line between steps */
        .qc-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 6px;
            left: calc(50% + 10px);
            width: calc(2rem + 100% - 20px);
            height: 2px;
            background: rgba(0, 212, 255, 0.2);
            z-index: 0;
        }

        .qc-step.completed:not(:last-child)::after {
            background: #10B981;
        }

        .qc-step.active:not(:last-child)::after {
            background: linear-gradient(90deg, var(--flow-cyan) 0%, rgba(0, 212, 255, 0.2) 100%);
        }

        .qc-step.active {
            opacity: 1;
        }

        .qc-step.completed {
            opacity: 1;
        }

        .qc-step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .qc-step.active .qc-step-dot {
            background: var(--flow-cyan);
            box-shadow: 0 0 15px var(--flow-cyan);
        }

        .qc-step.completed .qc-step-dot {
            background: #10B981;
        }

        .qc-step span {
            font-size: 0.75rem;
            color: var(--flow-gray);
            font-weight: 500;
        }

        .qc-step.active span {
            color: var(--flow-white);
        }

        /* Content Area */
        .qc-content {
            padding: 1.5rem 2rem 2rem;
        }

        .qc-content.hidden {
            display: none;
        }

        .qc-header {
            margin-bottom: 1.5rem;
        }

        .qc-header h3 {
            font-family: 'Syne', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .qc-header p {
            color: var(--flow-gray);
            font-size: 0.9rem;
        }

        /* Form Inputs */
        .qc-form {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .qc-input-group {
            width: 100%;
        }

        .qc-input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .qc-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.15);
            border-radius: 12px;
            padding: 0.9rem 1rem;
            color: var(--flow-white);
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            outline: none;
        }

        .qc-input:focus {
            border-color: var(--flow-cyan);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        .qc-input.error {
            border-color: #FF6B6B;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.15);
        }

        .qc-input::placeholder {
            color: rgba(148, 163, 184, 0.5);
        }

        .qc-select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2394A3B8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
        }

        /* Shipping Options */
        .qc-shipping-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .qc-shipping-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.85rem 1rem;
            background: rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(0, 212, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .qc-shipping-option:hover {
            border-color: rgba(0, 212, 255, 0.3);
        }

        .qc-shipping-option.selected {
            border-color: var(--flow-cyan);
            background: rgba(0, 212, 255, 0.05);
        }

        .qc-shipping-radio {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 50%;
            transition: all 0.3s ease;
            position: relative;
        }

        .qc-shipping-option.selected .qc-shipping-radio {
            border-color: var(--flow-cyan);
        }

        .qc-shipping-option.selected .qc-shipping-radio::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: var(--flow-cyan);
            border-radius: 50%;
        }

        .qc-shipping-info {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .qc-shipping-name {
            font-size: 0.9rem;
        }

        .qc-shipping-price {
            font-weight: 600;
            color: var(--flow-cyan);
        }

        .qc-shipping-price.free {
            color: #10B981;
        }

        /* Order Summary */
        .qc-summary {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .qc-summary-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            padding: 0.4rem 0;
            color: var(--flow-gray);
        }

        .qc-summary-row.qc-total {
            border-top: 1px solid rgba(0, 212, 255, 0.1);
            margin-top: 0.5rem;
            padding-top: 0.75rem;
            font-family: 'Syne', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--flow-white);
        }

        /* Buttons */
        .qc-btn-row {
            display: flex;
            gap: 0.75rem;
        }

        .qc-continue-btn {
            width: 100%;
            background: var(--flow-cyan);
            color: var(--flow-dark);
            border: none;
            padding: 0.95rem 1.5rem;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .qc-continue-btn:hover {
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.4);
            transform: translateY(-1px);
        }

        .qc-back-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--flow-gray);
            padding: 0.95rem 1.25rem;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .qc-back-btn:hover {
            border-color: rgba(255, 255, 255, 0.4);
            color: var(--flow-white);
        }

        .qc-place-order-btn {
            flex: 1;
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 0.95rem 1.5rem;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.3);
        }

        .qc-place-order-btn:hover {
            box-shadow: 0 0 40px rgba(16, 185, 129, 0.5);
            transform: translateY(-1px);
        }

        .qc-place-order-btn.loading .qc-btn-text {
            display: none;
        }

        .qc-place-order-btn .qc-spinner {
            display: none;
        }

        .qc-place-order-btn.loading .qc-spinner {
            display: block;
        }

        .qc-spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: qcSpin 0.8s linear infinite;
        }

        @keyframes qcSpin {
            to { transform: rotate(360deg); }
        }

        .qc-secure {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
            font-size: 0.75rem;
            color: var(--flow-gray);
        }

        .qc-secure svg {
            color: #10B981;
        }

        /* Success State */
        .qc-success-content {
            text-align: center;
            padding: 2rem 0;
        }

        .qc-success-icon {
            width: 70px;
            height: 70px;
            background: rgba(16, 185, 129, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.25rem;
            font-size: 2rem;
            color: #10B981;
            animation: successPop 0.4s ease;
        }

        @keyframes successPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .qc-success-content h3 {
            font-family: 'Syne', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .qc-success-content p {
            color: var(--flow-gray);
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        .qc-order-number {
            background: rgba(0, 212, 255, 0.1);
            border: 1px dashed var(--flow-cyan);
            padding: 0.85rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }

        .qc-order-number span {
            color: var(--flow-gray);
        }

        .qc-order-number strong {
            color: var(--flow-cyan);
            font-family: 'Syne', sans-serif;
        }

        .qc-done-btn {
            background: var(--flow-cyan);
            color: var(--flow-dark);
            border: none;
            padding: 0.85rem 2.5rem;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .qc-done-btn:hover {
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.4);
        }

        /* Add New Address Popup Modal */
        .address-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 10001;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .address-popup-overlay.visible {
            display: flex;
        }

        .address-popup-modal {
            background: linear-gradient(180deg, #0d1f35 0%, #0A1628 100%);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .address-popup-modal::-webkit-scrollbar {
            width: 6px;
        }

        .address-popup-modal::-webkit-scrollbar-track {
            background: transparent;
        }

        .address-popup-modal::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.3);
            border-radius: 3px;
        }

        .address-popup-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
            position: sticky;
            top: 0;
            background: #0d1f35;
            z-index: 1;
        }

        .address-popup-header h3 {
            font-family: 'Syne', sans-serif;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .address-popup-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            color: var(--flow-gray);
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .address-popup-close:hover {
            background: rgba(255, 107, 107, 0.2);
            color: #FF6B6B;
        }

        .address-popup-content {
            padding: 1.5rem;
        }

        .address-popup-actions {
            display: flex;
            gap: 0.75rem;
            padding: 1rem 1.5rem 1.5rem;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
        }

        .address-popup-cancel-btn {
            flex: 1;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--flow-gray);
            padding: 0.85rem 1rem;
            border-radius: 12px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .address-popup-cancel-btn:hover {
            border-color: rgba(255, 255, 255, 0.4);
            color: var(--flow-white);
        }

        .address-popup-save-btn {
            flex: 2;
            background: var(--flow-cyan);
            border: none;
            color: var(--flow-dark);
            padding: 0.85rem 1rem;
            border-radius: 12px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .address-popup-save-btn:hover {
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
        }

        .address-popup-save-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Mobile Menu Styles */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            z-index: 1002;
        }
        
        .mobile-menu-toggle span {
            display: block;
            width: 24px;
            height: 2px;
            background: var(--flow-white);
            margin: 6px 0;
            transition: all 0.3s ease;
            border-radius: 2px;
        }
        
        .mobile-menu-toggle.active span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }
        
        .mobile-menu-toggle.active span:nth-child(2) {
            opacity: 0;
        }
        
        .mobile-menu-toggle.active span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
        
        .mobile-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 998;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .mobile-menu-overlay.active {
            opacity: 1;
        }
        
        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            right: -100%;
            width: 85%;
            max-width: 320px;
            height: 100vh;
            background: linear-gradient(180deg, rgba(10, 22, 40, 0.98) 0%, rgba(2, 8, 23, 0.98) 100%);
            border-left: 1px solid rgba(0, 212, 255, 0.15);
            z-index: 999;
            padding: 80px 24px 24px;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }
        
        .mobile-menu.active {
            right: 0;
        }
        
        .mobile-menu-links {
            list-style: none;
            margin-bottom: 2rem;
        }
        
        .mobile-menu-links li {
            border-bottom: 1px solid rgba(0, 212, 255, 0.08);
        }
        
        .mobile-menu-links a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 0;
            color: var(--flow-white);
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .mobile-menu-links a svg {
            width: 20px;
            height: 20px;
            stroke: var(--flow-cyan);
            opacity: 0.7;
        }
        
        .mobile-menu-links a:hover,
        .mobile-menu-links a.active {
            color: var(--flow-cyan);
        }
        
        /* Mobile Bottom Navigation */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            background: rgba(10, 22, 40, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 212, 255, 0.15);
            z-index: 997;
            padding: 8px 0;
            padding-bottom: calc(8px + env(safe-area-inset-bottom));
            justify-content: space-around;
        }
        
        .mobile-bottom-nav .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            color: var(--flow-gray);
            text-decoration: none;
            font-size: 0.7rem;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            background: none;
            border: none;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
        }
        
        .mobile-bottom-nav .nav-item svg {
            width: 22px;
            height: 22px;
        }
        
        .mobile-bottom-nav .nav-item.active,
        .mobile-bottom-nav .nav-item:hover {
            color: var(--flow-cyan);
        }
        
        .mobile-bottom-nav-inner {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .mobile-bottom-nav a,
        .mobile-bottom-nav button {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            color: var(--flow-gray);
            text-decoration: none;
            font-size: 0.7rem;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            background: none;
            border: none;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
        }
        
        .mobile-bottom-nav a svg,
        .mobile-bottom-nav button svg {
            width: 22px;
            height: 22px;
        }
        
        .mobile-bottom-nav a.active,
        .mobile-bottom-nav a:hover,
        .mobile-bottom-nav button:hover {
            color: var(--flow-cyan);
        }
        
        .mobile-bottom-nav .cart-badge,
        .mobile-cart-count {
            position: absolute;
            top: 2px;
            right: 8px;
            background: var(--flow-cyan);
            color: var(--flow-dark);
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 700;
        }
        
        .cart-nav-item {
            position: relative;
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .shop-container {
                grid-template-columns: 1fr;
                padding-top: 6rem;
            }

            .shop-sidebar {
                position: static;
            }

            .sidebar-header {
                text-align: center;
                margin-bottom: 1.5rem;
            }

            .sidebar-header h1 {
                font-size: clamp(2rem, 5vw, 2.5rem);
            }

            .sidebar-filters {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }

            .filter-section,
            .promo-banner {
                margin-bottom: 0;
            }

            .product-card.featured {
                grid-column: span 1;
                display: block;
            }

            .product-card.featured .product-image {
                min-height: 280px;
            }

            .product-card.featured .product-info {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            /* Show mobile navigation */
            .mobile-menu-toggle {
                display: block;
            }
            
            .mobile-menu,
            .mobile-menu-overlay {
                display: block;
            }
            
            .mobile-bottom-nav {
                display: flex;
                justify-content: space-around;
            }
            
            /* Hide desktop nav elements */
            .nav-links {
                display: none !important;
            }
            
            .nav-right .cart-btn,
            .nav-right .profile-btn {
                display: none;
            }
            
            /* Adjust body for bottom nav */
            body {
                padding-bottom: calc(70px + env(safe-area-inset-bottom));
            }
            
            nav {
                padding: 12px 16px;
            }
            
            .logo-img {
                height: 44px;
            }

            .shop-container {
                padding: 5rem 16px 2rem;
            }
            
            .sidebar-header h1 {
                font-size: 1.75rem;
            }
            
            .sidebar-header p {
                font-size: 0.9rem;
            }

            .sidebar-filters {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .filter-section {
                padding: 1rem;
                border-radius: 14px;
            }
            
            .filter-title {
                font-size: 0.85rem;
            }

            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .product-card {
                border-radius: 14px;
            }
            
            .product-image {
                min-height: 150px;
            }
            
            .product-info {
                padding: 12px;
            }
            
            .product-name {
                font-size: 0.9rem;
                margin-bottom: 4px;
            }
            
            .product-desc {
                display: none;
            }
            
            .product-meta {
                display: none;
            }
            
            .product-footer {
                flex-direction: column;
                gap: 8px;
            }
            
            .product-price {
                flex-direction: row;
                gap: 8px;
            }
            
            .price-current {
                font-size: 1rem;
            }
            
            .price-original {
                font-size: 0.8rem;
            }
            
            .add-to-cart {
                width: 100%;
                justify-content: center;
                padding: 10px 16px;
                font-size: 0.85rem;
                border-radius: 10px;
            }
            
            .add-to-cart svg {
                width: 16px;
                height: 16px;
            }

            /* Cart drawer full width */
            .cart-drawer {
                width: 100%;
                right: -100%;
                border-radius: 0;
            }
            
            .cart-drawer.open {
                right: 0;
            }
            
            .cart-header {
                padding: 16px;
            }
            
            .cart-body {
                padding: 16px;
            }
            
            .cart-footer {
                padding: 16px;
                padding-bottom: calc(16px + env(safe-area-inset-bottom));
            }
            
            .cart-item {
                padding: 12px;
            }
            
            .cart-item-image {
                width: 60px;
                height: 60px;
            }
            
            /* Products header mobile */
            .products-header {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
                margin-bottom: 16px;
            }
            
            .products-count {
                text-align: center;
            }
            
            .sort-dropdown {
                width: 100%;
            }
            
            .sort-dropdown select {
                width: 100%;
            }
            
            /* Promo banner mobile */
            .promo-banner {
                padding: 1rem;
                border-radius: 14px;
            }
            
            .promo-banner h4 {
                font-size: 0.95rem;
            }
            
            .promo-banner p {
                font-size: 0.85rem;
            }
            
            /* Footer mobile */
            footer {
                padding: 2rem 16px;
                padding-bottom: calc(80px + env(safe-area-inset-bottom));
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
                text-align: center;
            }

            .footer-bottom {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .product-image {
                min-height: 120px;
            }
            
            .product-info {
                padding: 10px;
            }
            
            .product-name {
                font-size: 0.85rem;
                line-height: 1.3;
            }
            
            .price-current {
                font-size: 0.95rem;
            }
            
            .add-to-cart {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            /* Single column for smaller screens if needed */
            .sidebar-filters {
                gap: 10px;
            }
        }
        
        /* Safe area support */
        @supports (padding: max(0px)) {
            .mobile-bottom-nav {
                padding-bottom: max(8px, env(safe-area-inset-bottom));
            }
        }
        
        /* Touch-friendly tap targets */
        @media (pointer: coarse) {
            .add-to-cart,
            .filter-option label,
            .mobile-menu-links a,
            .mobile-bottom-nav a {
                min-height: 44px;
            }
        }

        /* Footer */
        footer {
            padding: 4rem 8% 2rem;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
            margin-top: 4rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 2.5rem;
            max-width: 1400px;
            margin: 0 auto 3rem;
        }

        .footer-brand .logo {
            margin-bottom: 1rem;
            display: inline-block;
        }

        .footer-brand .logo-img {
            height: 70px;
        }

        .footer-brand p {
            color: var(--flow-gray);
            font-size: 0.9rem;
            max-width: 300px;
        }

        .footer-column h4 {
            font-family: 'Syne', sans-serif;
            font-size: 1rem;
            margin-bottom: 1.25rem;
            color: var(--flow-white);
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column li {
            margin-bottom: 0.75rem;
        }

        .footer-column a {
            color: var(--flow-gray);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .footer-column a:hover {
            color: var(--flow-cyan);
        }

        .footer-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-bottom p {
            color: var(--flow-gray);
            font-size: 0.85rem;
        }

        .footer-contact a {
            color: var(--flow-gray);
            text-decoration: none;
            font-size: 0.85rem;
            transition: color 0.3s ease;
        }

        .footer-contact a:hover {
            color: var(--flow-cyan);
        }

        .social-links {
            display: flex;
            gap: 1rem;
        }

        .social-links a {
            width: 40px;
            height: 40px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--flow-gray);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .social-links a:hover {
            background: var(--flow-cyan);
            color: var(--flow-dark);
        }

        @media (max-width: 768px) {
            .footer-content {
                grid-template-columns: 1fr 1fr;
            }

            .footer-bottom {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }

        /* Google Maps Address Selection Styles */
        .qc-map-container {
            margin-bottom: 1rem;
        }

        .qc-address-search {
            position: relative;
            margin-bottom: 1rem;
        }

        .qc-address-search input {
            width: 100%;
            padding: 0.85rem 1rem 0.85rem 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.03);
            color: var(--flow-white);
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .qc-address-search input:focus {
            outline: none;
            border-color: var(--flow-cyan);
            background: rgba(0, 212, 255, 0.05);
        }

        .qc-address-search svg {
            position: absolute;
            left: 0.85rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--flow-gray);
            width: 18px;
            height: 18px;
        }

        .qc-map-wrapper {
            height: 200px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1rem;
        }

        #qcMap {
            width: 100%;
            height: 100%;
        }

        #popupMap {
            width: 100%;
            height: 100%;
        }

        .qc-selected-address {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 0.85rem;
            margin-bottom: 1rem;
            display: none;
        }

        .qc-selected-address.visible {
            display: block;
        }

        .qc-selected-address-label {
            font-size: 0.75rem;
            color: var(--flow-cyan);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.35rem;
        }

        .qc-selected-address-text {
            color: var(--flow-white);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .qc-house-input {
            margin-bottom: 1rem;
        }

        .qc-house-input label {
            display: block;
            font-size: 0.8rem;
            color: var(--flow-gray);
            margin-bottom: 0.5rem;
        }

        .qc-house-input input {
            width: 100%;
            padding: 0.85rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.03);
            color: var(--flow-white);
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .qc-house-input input:focus {
            outline: none;
            border-color: var(--flow-cyan);
            background: rgba(0, 212, 255, 0.05);
        }

        .qc-use-current-location {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: var(--flow-cyan);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .qc-use-current-location:hover {
            background: rgba(0, 212, 255, 0.2);
        }

        .qc-address-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-top: 0.75rem;
        }

        .qc-address-detail-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.6rem 0.85rem;
        }

        .qc-address-detail-item span {
            display: block;
            font-size: 0.7rem;
            color: var(--flow-gray);
            margin-bottom: 0.15rem;
        }

        .qc-address-detail-item strong {
            color: var(--flow-white);
            font-size: 0.85rem;
        }

        /* Razorpay Payment Option Style */
        .qc-razorpay-info {
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .qc-razorpay-logo {
            margin-bottom: 0.75rem;
        }

        .qc-razorpay-info p {
            color: var(--flow-gray);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .qc-razorpay-info small {
            color: var(--flow-gray);
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .qc-razorpay-methods {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 0.75rem;
            flex-wrap: wrap;
        }

        .qc-razorpay-method {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.75rem;
            color: var(--flow-gray);
        }

        .qc-razorpay-method .material-icons {
            font-size: 1rem;
            color: var(--flow-cyan);
        }

        /* Google Places Autocomplete Dropdown Styling */
        .pac-container {
            background: var(--flow-blue) !important;
            background-color: #0A1628 !important;
            border: 1px solid rgba(0, 212, 255, 0.3) !important;
            border-radius: 10px !important;
            margin-top: 5px !important;
            font-family: 'Outfit', sans-serif !important;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5) !important;
            z-index: 100000 !important;
        }

        .pac-item {
            padding: 10px 15px !important;
            color: var(--flow-white) !important;
            color: #FAFCFF !important;
            border-top: 1px solid rgba(255, 255, 255, 0.05) !important;
            cursor: pointer !important;
            background: transparent !important;
        }

        .pac-item:hover {
            background: rgba(0, 212, 255, 0.1) !important;
        }

        .pac-item-query {
            color: var(--flow-cyan) !important;
            color: #00D4FF !important;
        }

        .pac-matched {
            font-weight: 600 !important;
        }

        .pac-icon {
            display: none !important;
        }
        
        .pac-item span {
            color: #94A3B8 !important;
        }
        
        .pac-item-query span {
            color: #00D4FF !important;
        }

        /* Saved Addresses Styling */
        .qc-saved-addresses {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .qc-saved-addresses-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .qc-saved-addresses-title {
            font-size: 0.9rem;
            color: var(--flow-gray);
            font-weight: 500;
        }

        .qc-saved-addresses-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .qc-saved-address-item {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 0;
            cursor: pointer;
            transition: all 0.25s ease;
            overflow: hidden;
            position: relative;
        }

        .qc-saved-address-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: transparent;
            transition: background 0.25s ease;
        }

        .qc-saved-address-item:hover {
            border-color: rgba(0, 212, 255, 0.25);
            background: rgba(15, 23, 42, 0.8);
            transform: translateY(-1px);
        }

        .qc-saved-address-item.selected {
            border-color: rgba(0, 212, 255, 0.5);
            background: rgba(0, 212, 255, 0.08);
        }

        .qc-saved-address-item.selected::before {
            background: var(--flow-cyan);
        }

        .qc-saved-address-item label {
            display: flex;
            align-items: stretch;
            gap: 0;
            cursor: pointer;
            width: 100%;
            padding: 1rem 1.25rem;
        }

        .qc-saved-address-item input[type="radio"] {
            display: none;
        }

        .qc-address-radio-indicator {
            width: 22px;
            height: 22px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            margin-right: 1rem;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s ease;
            margin-top: 2px;
        }

        .qc-saved-address-item.selected .qc-address-radio-indicator {
            border-color: var(--flow-cyan);
            background: var(--flow-cyan);
        }

        .qc-address-radio-indicator::after {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--flow-dark);
            border-radius: 50%;
            opacity: 0;
            transform: scale(0);
            transition: all 0.25s ease;
        }

        .qc-saved-address-item.selected .qc-address-radio-indicator::after {
            opacity: 1;
            transform: scale(1);
        }

        .qc-address-content {
            flex: 1;
            min-width: 0;
        }

        .qc-address-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .qc-address-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.25rem 0.6rem;
            background: rgba(0, 212, 255, 0.15);
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--flow-cyan);
            text-transform: capitalize;
        }

        .qc-address-type-badge svg {
            width: 12px;
            height: 12px;
        }

        .qc-address-default-tag {
            font-size: 0.7rem;
            color: var(--flow-purple);
            background: rgba(139, 92, 246, 0.15);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .qc-address-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }

        .qc-address-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .qc-address-pincode {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.8rem;
            color: var(--flow-gray);
        }

        .qc-address-pincode svg {
            width: 12px;
            height: 12px;
            opacity: 0.7;
        }

        .qc-delivery-estimate {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.8rem;
            color: #22c55e;
        }

        .qc-delivery-estimate svg {
            width: 12px;
            height: 12px;
        }

        .qc-add-new-address-btn {
            background: transparent;
            border: 1px dashed rgba(0, 212, 255, 0.3);
            border-radius: 16px;
            padding: 1rem 1.25rem;
            color: var(--flow-cyan);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .qc-add-new-address-btn:hover {
            background: rgba(0, 212, 255, 0.08);
            border-color: var(--flow-cyan);
            border-style: solid;
        }

        .qc-add-new-address-btn svg {
            width: 18px;
            height: 18px;
        }

        .qc-map-section {
            display: none;
        }

        .qc-map-section.visible {
            display: block;
        }

        .qc-address-details {
            flex: 1;
        }

        .qc-address-type {
            font-weight: 600;
            color: var(--flow-cyan);
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
            text-transform: capitalize;
        }

        .qc-delivery-estimate svg {
            color: var(--flow-cyan);
        }

        .qc-no-addresses-msg {
            color: var(--flow-gray);
            font-size: 0.9rem;
            text-align: center;
            padding: 1rem;
        }

        .qc-back-to-saved {
            background: transparent;
            border: none;
            color: var(--flow-cyan);
            font-size: 0.85rem;
            cursor: pointer;
            padding: 0;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .qc-back-to-saved:hover {
            text-decoration: underline;
        }

        .qc-selected-address-preview {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .qc-selected-address-preview .qc-address-type {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .qc-change-address-btn {
            background: transparent;
            border: none;
            color: var(--flow-cyan);
            font-size: 0.8rem;
            cursor: pointer;
            padding: 0;
        }

        .qc-change-address-btn:hover {
            text-decoration: underline;
        }

        /* Shipping Info Box */
        .qc-shipping-info-box {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .qc-shipping-icon {
            font-size: 1.5rem;
        }

        .qc-shipping-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .qc-shipping-title {
            font-weight: 600;
            color: var(--flow-white);
        }

        .qc-shipping-estimate {
            font-size: 0.85rem;
            color: var(--flow-gray);
        }

        .qc-shipping-cost {
            font-weight: 600;
            color: var(--flow-cyan);
            font-size: 1.1rem;
        }

        .qc-free-shipping-note {
            font-size: 0.85rem;
            color: var(--flow-cyan);
            text-align: center;
            padding: 0.5rem;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .qc-save-address {
            margin: 1rem 0;
        }

        .qc-save-address label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--flow-gray);
        }

        .qc-save-address input[type="checkbox"] {
            accent-color: var(--flow-cyan);
            width: 18px;
            height: 18px;
        }

        /* Address Error Styling */
        .qc-address-error {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: rgba(255, 82, 82, 0.1);
            border: 1px solid rgba(255, 82, 82, 0.3);
            border-radius: 8px;
            margin: 12px 0;
            color: #ff5252;
            font-size: 0.9rem;
        }

        .qc-address-error svg {
            flex-shrink: 0;
        }

        .qc-input.error {
            border-color: #ff5252 !important;
            background: rgba(255, 82, 82, 0.05);
        }
    </style>
</head>
<body>
    <div class="water-bg"></div>

    <!-- Navigation -->
    <nav>
        <a href="/" class="logo">
            <img src="/logo.png" alt="Flow" class="logo-img">
        </a>
        <ul class="nav-links">
            <li><a href="/">Home</a></li>
            <li><a href="#" class="active">Shop</a></li>
            <li><a href="/#shop">Best Sellers</a></li>
            <li><a href="/#ingredients">Ingredients</a></li>
            <li><a href="/#benefits">Benefits</a></li>
            <li><a href="/#faq">FAQ</a></li>
        </ul>
        <div class="nav-right">
            <button class="cart-btn" id="cartToggle">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <path d="M16 10a4 4 0 01-8 0"/>
                </svg>
                <span class="cart-text">Cart</span>
                <span class="cart-count" id="cartCount">0</span>
            </button>
            <a href="/profile/" class="profile-btn" aria-label="Profile">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                <span class="profile-text">Profile</span>
            </a>
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" aria-label="Menu" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>
    
    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" onclick="toggleMobileMenu()"></div>
    
    <!-- Mobile Slide-out Menu -->
    <div class="mobile-menu">
        <ul class="mobile-menu-links">
            <li>
                <a href="/">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>
                    Home
                </a>
            </li>
            <li>
                <a href="/shop/" class="active">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <path d="M16 10a4 4 0 01-8 0"/>
                    </svg>
                    Shop
                </a>
            </li>
            <li>
                <a href="/#ingredients">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                    </svg>
                    Ingredients
                </a>
            </li>
            <li>
                <a href="/#benefits">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                    Benefits
                </a>
            </li>
            <li>
                <a href="/profile/">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    My Account
                </a>
            </li>
        </ul>
    </div>

    <!-- Shop Container -->
    <div class="shop-container">
        <!-- Sidebar -->
        <aside class="shop-sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <h1>Shop <span>Flow</span></h1>
                <p>Clean hydration products engineered for optimal performance. Free shipping on orders over ₹999.</p>
            </div>

            <div class="sidebar-filters">
                <div class="filter-section" id="categoryFilters">
                    <h3><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--flow-cyan)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg> Category</h3>
                    <div class="filter-option active" data-category="single" onclick="setCategory('single')">
                        <div class="filter-checkbox"></div>
                        <span class="filter-label">Single Flavours</span>
                        <span class="filter-count" id="countSingle">0</span>
                    </div>
                    <div class="filter-option active" data-category="bundle" onclick="setCategory('bundle')">
                        <div class="filter-checkbox"></div>
                        <span class="filter-label">Variety Packs</span>
                        <span class="filter-count" id="countBundle">0</span>
                    </div>
                </div>

                <div class="filter-section" id="flavourFilters">
                    <h3><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--flow-cyan)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg> Flavour</h3>
                    <!-- Dynamically populated -->
                </div>

                <div class="promo-banner">
                    <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--flow-cyan)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 12v10H4V12"/><path d="M2 7h20v5H2z"/><path d="M12 22V7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg> First Order Discount</h4>
                    <p>Get 15% off your first order with code:</p>
                    <div class="promo-code">FIRSTFLOW15</div>
                </div>
            </div>
        </aside>

        <!-- Products Section -->
        <section class="products-section">
            <div class="products-header">
                <span class="products-count">Showing <strong>8</strong> products</span>
                <select class="sort-dropdown" id="sortDropdown" onchange="setSort(this.value)">
                    <option value="featured">Sort by: Featured</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                    <option value="name-az">Name: A to Z</option>
                    <option value="name-za">Name: Z to A</option>
                </select>
            </div>

            <div class="products-grid">
                <!-- Featured Product -->
                <div class="product-card featured" data-flavor="original" data-category="pack">
                    <div class="product-badge bestseller">Bestseller</div>
                    <div class="product-image">
                        <div class="sachet-visual">
                            <div class="sachet-content">
                                <div class="sachet-logo">Flow</div>
                                <div class="sachet-flavor">Original</div>
                            </div>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-category">Starter Pack</div>
                        <h3 class="product-name">Flow Original — 30 Pack</h3>
                        <p class="product-desc">Our signature electrolyte formula. Perfect for daily hydration, workouts, and recovery. One month supply of clean, sugar-free hydration.</p>
                        <div class="product-meta">
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M2 12h20"/>
                                </svg>
                                30 sachets
                            </div>
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>
                                </svg>
                                0g sugar
                            </div>
                        </div>
                        <div class="product-footer">
                            <div class="product-price">
                                <span class="price-current">₹1,499</span>
                                <span class="price-original">₹1,799</span>
                            </div>
                            <button class="add-to-cart" data-product="flow-original-30" data-name="Flow Original — 30 Pack" data-price="1499" onclick="event.stopPropagation(); addToCart('flow-original-30', 'Flow Original — 30 Pack', 1499)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <path d="M16 10a4 4 0 01-8 0"/>
                                </svg>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product Card 2 -->
                <div class="product-card" data-flavor="citrus" data-category="pack">
                    <div class="product-badge new">New</div>
                    <div class="product-image">
                        <div class="sachet-visual" style="background: linear-gradient(135deg, #1a2d1a 0%, #2d4a2d 50%, #1a2d1a 100%);">
                            <div class="sachet-content">
                                <div class="sachet-logo">Flow</div>
                                <div class="sachet-flavor">Citrus</div>
                            </div>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-category">Multi-Pack</div>
                        <h3 class="product-name">Citrus Burst — 20 Pack</h3>
                        <p class="product-desc">Refreshing citrus twist with the same powerful electrolyte formula.</p>
                        <div class="product-meta">
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M2 12h20"/>
                                </svg>
                                20 sachets
                            </div>
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                </svg>
                                Natural flavor
                            </div>
                        </div>
                        <div class="product-footer">
                            <div class="product-price">
                                <span class="price-current">₹999</span>
                            </div>
                            <button class="add-to-cart" data-product="citrus-burst-20" data-name="Citrus Burst — 20 Pack" data-price="999" onclick="event.stopPropagation(); addToCart('citrus-burst-20', 'Citrus Burst — 20 Pack', 999)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <path d="M16 10a4 4 0 01-8 0"/>
                                </svg>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product Card 3 -->
                <div class="product-card" data-flavor="berry" data-category="pack">
                    <div class="product-image">
                        <div class="sachet-visual" style="background: linear-gradient(135deg, #2d1a2d 0%, #4a2d4a 50%, #2d1a2d 100%);">
                            <div class="sachet-content">
                                <div class="sachet-logo">Flow</div>
                                <div class="sachet-flavor">Berry</div>
                            </div>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-category">Multi-Pack</div>
                        <h3 class="product-name">Berry Blast — 20 Pack</h3>
                        <p class="product-desc">Rich berry flavor packed with essential electrolytes.</p>
                        <div class="product-meta">
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M2 12h20"/>
                                </svg>
                                20 sachets
                            </div>
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                </svg>
                                Natural flavor
                            </div>
                        </div>
                        <div class="product-footer">
                            <div class="product-price">
                                <span class="price-current">₹999</span>
                            </div>
                            <button class="add-to-cart" data-product="berry-blast-20" data-name="Berry Blast — 20 Pack" data-price="999" onclick="event.stopPropagation(); addToCart('berry-blast-20', 'Berry Blast — 20 Pack', 999)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <path d="M16 10a4 4 0 01-8 0"/>
                                </svg>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product Card 4 - Trial Pack -->
                <div class="product-card" data-flavor="original" data-category="single">
                    <div class="product-image">
                        <div class="sachet-visual">
                            <div class="sachet-content">
                                <div class="sachet-logo">Flow</div>
                                <div class="sachet-flavor">Original</div>
                            </div>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-category">Trial Size</div>
                        <h3 class="product-name">Flow Original — 5 Pack</h3>
                        <p class="product-desc">Try our signature formula. Perfect starter size.</p>
                        <div class="product-meta">
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M2 12h20"/>
                                </svg>
                                5 sachets
                            </div>
                        </div>
                        <div class="product-footer">
                            <div class="product-price">
                                <span class="price-current">₹299</span>
                            </div>
                            <button class="add-to-cart" data-product="flow-original-5" data-name="Flow Original — 5 Pack" data-price="299" onclick="event.stopPropagation(); addToCart('flow-original-5', 'Flow Original — 5 Pack', 299)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <path d="M16 10a4 4 0 01-8 0"/>
                                </svg>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product Card 5 - Variety Bundle -->
                <div class="product-card bundle" data-flavor="variety" data-category="bundle">
                    <div class="product-badge sale">Save 20%</div>
                    <div class="product-image">
                        <div class="sachet-visual" style="width: 70px; height: 100px;">
                            <div class="sachet-content">
                                <div class="sachet-logo" style="font-size: 0.8rem;">Flow</div>
                            </div>
                        </div>
                        <div class="sachet-visual" style="width: 70px; height: 100px; background: linear-gradient(135deg, #1a2d1a 0%, #2d4a2d 50%, #1a2d1a 100%);">
                            <div class="sachet-content">
                                <div class="sachet-logo" style="font-size: 0.8rem;">Flow</div>
                            </div>
                        </div>
                        <div class="sachet-visual" style="width: 70px; height: 100px; background: linear-gradient(135deg, #2d1a2d 0%, #4a2d4a 50%, #2d1a2d 100%);">
                            <div class="sachet-content">
                                <div class="sachet-logo" style="font-size: 0.8rem;">Flow</div>
                            </div>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-category">Variety Bundle</div>
                        <h3 class="product-name">Flavor Discovery Pack</h3>
                        <p class="product-desc">All 3 flavors in one bundle. 10 sachets of each variety.</p>
                        <div class="product-meta">
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M2 12h20"/>
                                </svg>
                                30 sachets
                            </div>
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>
                                </svg>
                                3 flavors
                            </div>
                        </div>
                        <div class="product-footer">
                            <div class="product-price">
                                <span class="price-current">₹1,299</span>
                                <span class="price-original">₹1,599</span>
                            </div>
                            <button class="add-to-cart" data-product="variety-pack" data-name="Flavor Discovery Pack" data-price="1299" onclick="event.stopPropagation(); addToCart('variety-pack', 'Flavor Discovery Pack', 1299)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <path d="M16 10a4 4 0 01-8 0"/>
                                </svg>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product Card 6 - Tropical -->
                <div class="product-card" data-flavor="tropical" data-category="pack">
                    <div class="product-badge new">New</div>
                    <div class="product-image">
                        <div class="sachet-visual" style="background: linear-gradient(135deg, #2d2a1a 0%, #4a3d2d 50%, #2d2a1a 100%);">
                            <div class="sachet-content">
                                <div class="sachet-logo">Flow</div>
                                <div class="sachet-flavor">Tropical</div>
                            </div>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-category">Multi-Pack</div>
                        <h3 class="product-name">Tropical Surge — 20 Pack</h3>
                        <p class="product-desc">Exotic tropical blend for a refreshing hydration experience.</p>
                        <div class="product-meta">
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M2 12h20"/>
                                </svg>
                                20 sachets
                            </div>
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                </svg>
                                Natural flavor
                            </div>
                        </div>
                        <div class="product-footer">
                            <div class="product-price">
                                <span class="price-current">₹999</span>
                            </div>
                            <button class="add-to-cart" data-product="tropical-surge-20" data-name="Tropical Surge — 20 Pack" data-price="999" onclick="event.stopPropagation(); addToCart('tropical-surge-20', 'Tropical Surge — 20 Pack', 999)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <path d="M16 10a4 4 0 01-8 0"/>
                                </svg>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product Card 7 - Mega Pack -->
                <div class="product-card" data-flavor="original" data-category="bundle">
                    <div class="product-badge bestseller">Best Value</div>
                    <div class="product-image">
                        <div class="sachet-visual">
                            <div class="sachet-content">
                                <div class="sachet-logo">Flow</div>
                                <div class="sachet-flavor">Original</div>
                            </div>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-category">Bulk Pack</div>
                        <h3 class="product-name">Flow Original — 60 Pack</h3>
                        <p class="product-desc">Two month supply at the best value. Never run out of hydration.</p>
                        <div class="product-meta">
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M2 12h20"/>
                                </svg>
                                60 sachets
                            </div>
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                </svg>
                                Free shipping
                            </div>
                        </div>
                        <div class="product-footer">
                            <div class="product-price">
                                <span class="price-current">₹2,499</span>
                                <span class="price-original">₹3,299</span>
                            </div>
                            <button class="add-to-cart" data-product="flow-original-60" data-name="Flow Original — 60 Pack" data-price="2499" onclick="event.stopPropagation(); addToCart('flow-original-60', 'Flow Original — 60 Pack', 2499)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <path d="M16 10a4 4 0 01-8 0"/>
                                </svg>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product Card 8 - Single Sachet Sampler -->
                <div class="product-card" data-flavor="variety" data-category="single">
                    <div class="product-image">
                        <div class="sachet-visual" style="width: 80px; height: 115px;">
                            <div class="sachet-content">
                                <div class="sachet-logo" style="font-size: 0.9rem;">Flow</div>
                                <div class="sachet-flavor">Sample</div>
                            </div>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-category">Single Sachet</div>
                        <h3 class="product-name">Single Sachet — Any Flavor</h3>
                        <p class="product-desc">Try before you commit. Single sachet of your choice.</p>
                        <div class="product-meta">
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M2 12h20"/>
                                </svg>
                                1 sachet
                            </div>
                        </div>
                        <div class="product-footer">
                            <div class="product-price">
                                <span class="price-current">₹69</span>
                            </div>
                            <button class="add-to-cart" data-product="single-sachet" data-name="Single Sachet" data-price="69" onclick="event.stopPropagation(); addToCart('single-sachet', 'Single Sachet', 69)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <path d="M16 10a4 4 0 01-8 0"/>
                                </svg>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Cart Overlay -->
    <div class="cart-overlay" id="cartOverlay"></div>

    <!-- Cart Drawer -->
    <div class="cart-drawer" id="cartDrawer">
        <div class="cart-header">
            <h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--flow-cyan)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg> Your Cart</h3>
            <button class="cart-close" id="cartClose">×</button>
        </div>
        <div class="cart-items" id="cartItems">
            <!-- Cart items will be dynamically inserted here -->
            <div class="cart-empty" id="cartEmpty">
                <div class="cart-empty-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--flow-cyan)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg></div>
                <p>Your cart is empty</p>
                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Add some Flow to get started!</p>
            </div>
        </div>
        <div class="cart-footer" id="cartFooter" style="display: none;">
            <div class="shipping-progress">
                <p class="shipping-text" id="shippingText">Add <span>₹999</span> more for free shipping!</p>
                <div class="shipping-bar">
                    <div class="shipping-bar-fill" id="shippingBar" style="width: 0%;"></div>
                </div>
            </div>
            
            <!-- Discount Code Section -->
            <div class="discount-section">
                <div class="discount-form" id="discountFormSection">
                    <div class="discount-input-wrapper">
                        <svg class="discount-input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 12v10H4V12"/><path d="M2 7h20v5H2z"/><path d="M12 22V7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>
                        </svg>
                        <input type="text" class="discount-input" id="discountInput" placeholder="Have a discount code?">
                    </div>
                    <button class="discount-apply-btn" id="discountApplyBtn" onclick="applyDiscountCode()">Apply</button>
                </div>
                <div class="discount-applied" id="discountApplied" style="display: none;">
                    <div class="discount-applied-info">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                        <span class="discount-applied-code" id="appliedCode">FIRSTFLOW15</span>
                        <span class="discount-applied-value" id="appliedValue">-15%</span>
                    </div>
                    <button class="discount-remove" onclick="removeDiscountCode()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <p class="discount-error" id="discountError" style="display: none;"></p>
            </div>
            
            <div class="cart-subtotal">
                <span>Subtotal</span>
                <span id="cartSubtotal">₹0</span>
            </div>
            <div class="cart-subtotal">
                <span>Shipping</span>
                <span id="cartShipping">₹99</span>
            </div>
            <div class="cart-discount-row" id="discountRow" style="display: none;">
                <span>Discount</span>
                <span id="cartDiscount">-₹0</span>
            </div>
            <div class="cart-total">
                <span>Total</span>
                <span id="cartTotal">₹0</span>
            </div>
            <button class="checkout-btn" onclick="goToCheckout()">
                Proceed to Checkout
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </button>
            <button class="continue-shopping" id="continueShopping">Continue Shopping</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon">✓</div>
        <span id="toastMessage">Added to cart!</span>
    </div>

    <!-- Cart Toast Notification (below app bar with image) -->
    <div class="cart-toast" id="cartToast">
        <div class="cart-toast-image" id="cartToastImage">
            <div class="sachet-mini">Flow</div>
        </div>
        <div class="cart-toast-content">
            <div class="cart-toast-title" id="cartToastTitle">Product Name</div>
            <div class="cart-toast-message">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"/>
                </svg>
                <span id="cartToastText">Added to cart!</span>
            </div>
        </div>
        <button class="cart-toast-close" onclick="hideCartToast()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
    </div>

    <!-- Add New Address Popup Modal -->
    <div class="address-popup-overlay" id="addressPopupOverlay">
        <div class="address-popup-modal">
            <div class="address-popup-header">
                <h3><span class="material-icons" style="font-size: 20px;">add_location</span> Add New Address</h3>
                <button class="address-popup-close" onclick="closeAddressPopup()">×</button>
            </div>
            <div class="address-popup-content">
                <!-- Google Maps Search -->
                <div class="qc-map-container">
                    <div class="qc-address-search">
                        <span class="material-icons" style="font-size: 18px; color: var(--flow-cyan);">search</span>
                        <input type="search" id="popupAddressSearch" role="combobox" aria-autocomplete="list" placeholder="Search for your area, street or landmark...">
                    </div>
                    
                    <button type="button" class="qc-use-current-location" onclick="useCurrentLocationPopup()">
                        <span class="material-icons" style="font-size: 16px; vertical-align: middle;">my_location</span>
                        Use my current location
                    </button>
                    
                    <div class="qc-map-wrapper">
                        <div id="popupMap"></div>
                    </div>
                    
                    <!-- Selected Address Display -->
                    <div class="qc-selected-address" id="popupSelectedAddress">
                        <div class="qc-selected-address-label">Selected Location</div>
                        <div class="qc-selected-address-text" id="popupSelectedAddressText"></div>
                        <div class="qc-address-details">
                            <div class="qc-address-detail-item">
                                <span>City</span>
                                <strong id="popupCityDisplay">-</strong>
                            </div>
                            <div class="qc-address-detail-item">
                                <span>State</span>
                                <strong id="popupStateDisplay">-</strong>
                            </div>
                            <div class="qc-address-detail-item">
                                <span>PIN Code</span>
                                <strong id="popupPincodeDisplay">-</strong>
                            </div>
                            <div class="qc-address-detail-item">
                                <span>Country</span>
                                <strong id="popupCountryDisplay">India</strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- House/Floor Number Input -->
                <div class="qc-house-input">
                    <label for="popupHouseFloor">House No. / Floor / Building Name *</label>
                    <input type="text" class="qc-input" id="popupHouseFloor" placeholder="e.g., Flat 204, 2nd Floor, Sunshine Apartments">
                </div>
                
                <!-- Address Error Message -->
                <div class="qc-address-error" id="popupAddressError" style="display: none;">
                    <span class="material-icons" style="font-size: 16px;">error_outline</span>
                    <span id="popupAddressErrorText"></span>
                </div>
                
                <!-- Hidden fields to store data -->
                <input type="hidden" id="popupCity" value="">
                <input type="hidden" id="popupState" value="">
                <input type="hidden" id="popupPincode" value="">
                <input type="hidden" id="popupAddress" value="">
                <input type="hidden" id="popupLatitude" value="">
                <input type="hidden" id="popupLongitude" value="">
            </div>
            <div class="address-popup-actions">
                <button class="address-popup-cancel-btn" onclick="closeAddressPopup()">Cancel</button>
                <button class="address-popup-save-btn" id="popupSaveAddressBtn" onclick="saveNewAddressFromPopup()">
                    <span class="material-icons" style="font-size: 18px;">save</span>
                    Save Address
                </button>
            </div>
        </div>
    </div>

    <!-- Quick Checkout Modal -->
    <div class="quick-checkout-overlay" id="quickCheckoutOverlay">
        <div class="quick-checkout-modal">
            <button class="quick-checkout-close" id="quickCheckoutClose">×</button>
            
            <!-- Progress Steps -->
            <div class="qc-progress">
                <div class="qc-step active" data-step="1">
                    <div class="qc-step-dot"></div>
                    <span>Contact</span>
                </div>
                <div class="qc-step" data-step="2">
                    <div class="qc-step-dot"></div>
                    <span>Shipping</span>
                </div>
                <div class="qc-step" data-step="3">
                    <div class="qc-step-dot"></div>
                    <span>Payment</span>
                </div>
            </div>

            <!-- Step 1: Contact -->
            <div class="qc-content" id="qcStep1">
                <div class="qc-header">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 0.25rem;">mail</span> Contact Information</h3>
                    <p>We'll send your order confirmation here</p>
                </div>
                <div class="qc-form">
                    <div class="qc-input-group">
                        <input type="email" class="qc-input" id="qcEmail" placeholder="Email address" required>
                    </div>
                    <div class="qc-input-group">
                        <input type="tel" class="qc-input" id="qcPhone" placeholder="Phone number" required>
                    </div>
                </div>
                <button class="qc-continue-btn" onclick="goToStep(2)">
                    Continue to Shipping
                    <span class="material-icons" style="font-size: 18px; vertical-align: middle;">arrow_forward</span>
                </button>
            </div>

            <!-- Step 2: Shipping with Google Maps -->
            <div class="qc-content hidden" id="qcStep2">
                <div class="qc-header">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 0.25rem;">location_on</span> Delivery Address</h3>
                    <p id="qcAddressHeaderText">Select your delivery address</p>
                </div>
                
                <!-- Saved Addresses Section -->
                <div class="qc-saved-addresses" id="qcSavedAddresses" style="display: none;">
                    <div class="qc-saved-addresses-list" id="qcSavedAddressesList">
                        <!-- Saved addresses will be populated here -->
                    </div>
                    <button type="button" class="qc-add-new-address-btn" onclick="showNewAddressForm()">
                        <span class="material-icons" style="font-size: 16px; vertical-align: middle;">add</span>
                        Add New Address
                    </button>
                </div>
                
                <!-- New Address Form (Maps) -->
                <div class="qc-form" id="qcNewAddressForm">
                    <!-- Google Maps Search -->
                    <div class="qc-map-container">
                        <div class="qc-address-search">
                            <span class="material-icons" style="font-size: 18px; color: var(--flow-cyan);">search</span>
                            <input type="search" id="qcAddressSearch" role="combobox" aria-autocomplete="list" placeholder="Search for your area, street or landmark...">
                        </div>
                        
                        <button type="button" class="qc-use-current-location" onclick="useCurrentLocation()">
                            <span class="material-icons" style="font-size: 16px; vertical-align: middle;">my_location</span>
                            Use my current location
                        </button>
                        
                        <div class="qc-map-wrapper">
                            <div id="qcMap"></div>
                        </div>
                        
                        <!-- Selected Address Display -->
                        <div class="qc-selected-address" id="qcSelectedAddress">
                            <div class="qc-selected-address-label">Selected Location</div>
                            <div class="qc-selected-address-text" id="qcSelectedAddressText"></div>
                            <div class="qc-address-details">
                                <div class="qc-address-detail-item">
                                    <span>City</span>
                                    <strong id="qcCityDisplay">-</strong>
                                </div>
                                <div class="qc-address-detail-item">
                                    <span>State</span>
                                    <strong id="qcStateDisplay">-</strong>
                                </div>
                                <div class="qc-address-detail-item">
                                    <span>PIN Code</span>
                                    <strong id="qcPincodeDisplay">-</strong>
                                </div>
                                <div class="qc-address-detail-item">
                                    <span>Country</span>
                                    <strong id="qcCountryDisplay">India</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- House/Floor Number Input -->
                    <div class="qc-house-input">
                        <label for="qcHouseFloor">House No. / Floor / Building Name *</label>
                        <input type="text" class="qc-input" id="qcHouseFloor" placeholder="e.g., Flat 204, 2nd Floor, Sunshine Apartments">
                    </div>
                    
                    <!-- Address Error Message -->
                    <div class="qc-address-error" id="qcAddressError" style="display: none;">
                        <span class="material-icons" style="font-size: 16px;">error_outline</span>
                        <span id="qcAddressErrorText"></span>
                    </div>
                    
                    <!-- Save Address Checkbox -->
                    <div class="qc-save-address">
                        <label>
                            <input type="checkbox" id="qcSaveAddress" checked>
                            <span>Save this address for future orders</span>
                        </label>
                    </div>
                    
                    <!-- Hidden fields to store data -->
                    <input type="hidden" id="qcCity" value="">
                    <input type="hidden" id="qcState" value="">
                    <input type="hidden" id="qcPincode" value="">
                    <input type="hidden" id="qcAddress" value="">
                    <input type="hidden" id="qcLatitude" value="">
                    <input type="hidden" id="qcLongitude" value="">
                </div>
                
                <!-- Shipping Info -->
                <div class="qc-shipping-info-box" id="qcShippingInfoBox">
                    <div class="qc-shipping-icon"><span class="material-icons">local_shipping</span></div>
                    <div class="qc-shipping-details">
                        <span class="qc-shipping-title" id="qcShippingTitle">Standard Delivery</span>
                        <span class="qc-shipping-estimate" id="qcShippingEstimate">Estimated delivery: 2-4 days</span>
                    </div>
                    <div class="qc-shipping-cost" id="qcShippingCostDisplay">
                        <span id="qcShippingPriceText">₹99</span>
                    </div>
                </div>
                <p class="qc-free-shipping-note" id="qcFreeShippingNote" style="display: none;">
                    <span class="material-icons" style="vertical-align: middle; font-size: 1rem; margin-right: 0.25rem;">celebration</span> Free shipping on orders above ₹999!
                </p>
                
                <div class="qc-btn-row">
                    <button class="qc-back-btn" onclick="goToStep(1)"><span class="material-icons" style="font-size: 16px; vertical-align: middle;">arrow_back</span> Back</button>
                    <button class="qc-continue-btn" onclick="validateAndContinueToPayment()">
                        Continue to Payment
                        <span class="material-icons" style="font-size: 18px; vertical-align: middle;">arrow_forward</span>
                    </button>
                </div>
            </div>

            <!-- Step 3: Payment with Razorpay -->
            <div class="qc-content hidden" id="qcStep3">
                <div class="qc-header">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 0.25rem;">payment</span> Payment</h3>
                    <p>Secure payment via Razorpay</p>
                </div>
                
                <!-- Razorpay Info Section -->
                <div class="qc-razorpay-info">
                    <div class="qc-razorpay-logo">
                        <img src="https://razorpay.com/assets/razorpay-logo.svg" alt="Razorpay" style="height: 24px; filter: brightness(0) invert(1);">
                    </div>
                    <div class="qc-razorpay-methods">
                        <div class="qc-razorpay-method">
                            <span class="material-icons">credit_card</span> Cards
                        </div>
                        <div class="qc-razorpay-method">
                            <span class="material-icons">qr_code_2</span> UPI
                        </div>
                        <div class="qc-razorpay-method">
                            <span class="material-icons">account_balance</span> Net Banking
                        </div>
                        <div class="qc-razorpay-method">
                            <span class="material-icons">account_balance_wallet</span> Wallets
                        </div>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="qc-summary">
                    <div class="qc-summary-row">
                        <span>Subtotal</span>
                        <span id="qcSubtotal">₹0</span>
                    </div>
                    <div class="qc-summary-row">
                        <span>Shipping</span>
                        <span id="qcShippingCost">FREE</span>
                    </div>
                    <div class="qc-summary-row qc-discount-row" id="qcDiscountRow" style="display: none;">
                        <span>Discount <span id="qcDiscountCode" style="color: var(--flow-cyan); font-size: 0.8rem;"></span></span>
                        <span id="qcDiscountAmount" style="color: #10B981;">-₹0</span>
                    </div>
                    <div class="qc-summary-row qc-total">
                        <span>Total</span>
                        <span id="qcTotal">₹0</span>
                    </div>
                </div>

                <div class="qc-btn-row">
                    <button class="qc-back-btn" onclick="goToStep(2)"><span class="material-icons" style="font-size: 16px; vertical-align: middle;">arrow_back</span> Back</button>
                    <button class="qc-place-order-btn" id="qcPlaceOrder">
                        <span class="qc-btn-text">Pay Now</span>
                        <div class="qc-spinner"></div>
                    </button>
                </div>

                <div class="qc-secure">
                    <span class="material-icons" style="font-size: 14px; vertical-align: middle;">lock</span>
                    Secured by Razorpay • 256-bit SSL encryption
                </div>
            </div>

            <!-- Success Step -->
            <div class="qc-content hidden" id="qcSuccess">
                <div class="qc-success-content">
                    <div class="qc-success-icon"><span class="material-icons">check_circle</span></div>
                    <h3>Order Placed!</h3>
                    <p>Thank you for your order. We've sent a confirmation to your email.</p>
                    <div class="qc-order-number">
                        <span>Order #</span>
                        <strong id="qcOrderNumber">FLOW-XXXXXX</strong>
                    </div>
                    <button class="qc-done-btn" onclick="closeQuickCheckout()">Done</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer id="about">
        <div class="footer-content">
            <div class="footer-brand">
                <a href="/" class="logo">
                    <img src="/logo.png" alt="Flow" class="logo-img">
                </a>
                <p>Clean hydration to fuel your day. Precision-engineered electrolyte formulation for optimal performance and recovery.</p>
            </div>
            <div class="footer-column">
                <h4>Shop</h4>
                <ul>
                    <li><a href="/shop/">Products</a></li>
                    <li><a href="/shop/">Bundles</a></li>
                    <li><a href="#" onclick="showComingSoonToast(event)">Subscription</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Company</h4>
                <ul>
                    <li><a href="/#about">About Us</a></li>
                    <li><a href="/#ingredients">Science</a></li>
                    <li><a href="/#about">Contact</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Support</h4>
                <ul>
                    <li><a href="/#faq">FAQ</a></li>
                    <li><a href="/shipping-policy/">Shipping</a></li>
                    <li><a href="/refund-policy/">Refund Policy</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Legal</h4>
                <ul>
                    <li><a href="/privacy-policy/">Privacy Policy</a></li>
                    <li><a href="/terms-conditions/">Terms & Conditions</a></li>
                    <li><a href="/cookie-policy/">Cookie Policy</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2026 Podium Performance LLP. All rights reserved.</p>
            <div class="footer-contact">
                <a href="mailto:contact@flowhydration.in">contact@flowhydration.in</a>
            </div>
            <div class="social-links">
                <a href="https://www.instagram.com/flowhydration.in/" target="_blank" aria-label="Instagram">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="2" width="20" height="20" rx="5"/>
                        <circle cx="12" cy="12" r="4"/>
                        <circle cx="18" cy="6" r="1.5" fill="currentColor" stroke="none"/>
                    </svg>
                </a>
                <a href="https://www.instagram.com/flowhydration.in/" target="_blank" aria-label="Twitter">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </a>
                <a href="https://www.instagram.com/flowhydration.in/" target="_blank" aria-label="YouTube">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"/>
                        <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02" fill="currentColor" stroke="none"/>
                    </svg>
                </a>
            </div>
        </div>
    </footer>

    <!-- API Configuration -->
    <script src="/assets/js/config.js"></script>
    <script>
        // Products State
        let products = [];
        
        // Filter State
        let activeCategories = ['single', 'bundle']; // Multi-select: both selected by default (= all)
        let activeFlavours = []; // Empty = all flavours (multi-select)
        let activeSort = 'featured';
        
        // Cart State - synced with CustomerAuth
        let cart = [];
        const FREE_SHIPPING_THRESHOLD = 999;
        const SHIPPING_COST = 99;
        
        // Buy Now Session State
        let isBuyNowSession = false;
        
        // Discount Code State
        let appliedDiscount = null;
        let publicDiscountCodes = []; // Loaded from API

        // DOM Elements
        const cartToggle = document.getElementById('cartToggle');
        const cartOverlay = document.getElementById('cartOverlay');
        const cartDrawer = document.getElementById('cartDrawer');
        const cartClose = document.getElementById('cartClose');
        const cartItems = document.getElementById('cartItems');
        const cartEmpty = document.getElementById('cartEmpty');
        const cartFooter = document.getElementById('cartFooter');
        const cartCount = document.getElementById('cartCount');
        const cartSubtotal = document.getElementById('cartSubtotal');
        const cartShipping = document.getElementById('cartShipping');
        const cartTotal = document.getElementById('cartTotal');
        const shippingText = document.getElementById('shippingText');
        const shippingBar = document.getElementById('shippingBar');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const continueShopping = document.getElementById('continueShopping');

        // Initialize cart from CustomerAuth
        async function initializeCart() {
            if (typeof CustomerAuth !== 'undefined') {
                cart = await CustomerAuth.fetchCart();
            } else {
                // Fallback to localStorage
                const savedCart = localStorage.getItem('flow_cart');
                cart = savedCart ? JSON.parse(savedCart) : [];
            }
            updateCartUI();
            // Update buttons after cart is loaded
            setTimeout(() => updateAddToCartButtons(), 100);
        }

        // Listen for cart updates from other tabs/components
        window.addEventListener('cartUpdated', (e) => {
            cart = e.detail.cart;
            updateCartUI();
            updateAddToCartButtons();
        });

        // Restore cart after Buy Now session is cancelled
        function restoreCartAfterBuyNow() {
            const backupCart = localStorage.getItem('flow_cart_backup');
            if (backupCart && isBuyNowSession) {
                localStorage.setItem('flow_cart', backupCart);
                localStorage.removeItem('flow_cart_backup');
                cart = JSON.parse(backupCart);
                updateCartUI();
                updateAddToCartButtons();
                if (CustomerAuth.isLoggedIn()) {
                    CustomerAuth.syncCartToServer();
                }
                isBuyNowSession = false;
            }
        }

        // Load products on page load
        document.addEventListener('DOMContentLoaded', async () => {
            await loadProducts();
            await initializeCart();
            loadSavedDiscount();
            loadPublicDiscountCodes();
            initMobileMenu();
            
            // Remove error highlight on input
            const qcEmailInput = document.getElementById('qcEmail');
            const qcPhoneInput = document.getElementById('qcPhone');
            if (qcEmailInput) {
                qcEmailInput.addEventListener('input', () => qcEmailInput.classList.remove('error'));
            }
            if (qcPhoneInput) {
                qcPhoneInput.addEventListener('input', () => qcPhoneInput.classList.remove('error'));
            }
            
            // Check URL params
            const urlParams = new URLSearchParams(window.location.search);
            
            // Check if redirected with cart=true to open cart
            if (urlParams.get('cart') === 'true') {
                // Remove the query param from URL without refresh
                window.history.replaceState({}, '', window.location.pathname);
                // Open cart drawer
                setTimeout(() => openCart(), 100);
            }
            
            // Check if redirected from Buy Now with checkout=true
            if (urlParams.get('checkout') === 'true') {
                // Track if this is a Buy Now session
                if (urlParams.get('buynow') === 'true') {
                    isBuyNowSession = true;
                }
                
                // Get discount code from URL if passed
                const discountCode = urlParams.get('discount');
                
                // Remove the query params from URL without refresh
                window.history.replaceState({}, '', window.location.pathname);
                
                // Open checkout if user is logged in and cart has items
                if (CustomerAuth.isLoggedIn() && cart.length > 0) {
                    // Auto-apply discount code first, then open checkout
                    if (discountCode) {
                        await autoApplyDiscountCode(discountCode);
                    }
                    openQuickCheckout();
                } else if (cart.length > 0) {
                    // Store discount code to apply after login
                    if (discountCode) {
                        sessionStorage.setItem('flow_pending_discount', discountCode);
                    }
                    // Show login modal first
                    CustomerAuth.showLoginModal();
                }
            }
        });

        // Mobile Menu Functions
        function initMobileMenu() {
            const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
            const mobileMenu = document.querySelector('.mobile-menu');
            const mobileMenuClose = document.querySelector('.mobile-menu-close');
            const mobileMenuOverlay = document.querySelector('.mobile-menu-overlay');
            const mobileMenuLinks = document.querySelectorAll('.mobile-nav-links a');

            if (mobileMenuToggle && mobileMenu) {
                mobileMenuToggle.addEventListener('click', toggleMobileMenu);
            }
            if (mobileMenuClose) {
                mobileMenuClose.addEventListener('click', closeMobileMenu);
            }
            if (mobileMenuOverlay) {
                mobileMenuOverlay.addEventListener('click', closeMobileMenu);
            }
            mobileMenuLinks.forEach(link => {
                link.addEventListener('click', closeMobileMenu);
            });
        }

        function toggleMobileMenu() {
            const mobileMenu = document.querySelector('.mobile-menu');
            const mobileMenuOverlay = document.querySelector('.mobile-menu-overlay');
            if (mobileMenu) {
                mobileMenu.classList.toggle('active');
            }
            if (mobileMenuOverlay) {
                mobileMenuOverlay.classList.toggle('active');
            }
            document.body.style.overflow = mobileMenu?.classList.contains('active') ? 'hidden' : '';
        }

        function closeMobileMenu() {
            const mobileMenu = document.querySelector('.mobile-menu');
            const mobileMenuOverlay = document.querySelector('.mobile-menu-overlay');
            if (mobileMenu) {
                mobileMenu.classList.remove('active');
            }
            if (mobileMenuOverlay) {
                mobileMenuOverlay.classList.remove('active');
            }
            document.body.style.overflow = '';
        }

        async function loadProducts() {
            const grid = document.querySelector('.products-grid');
            grid.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 4rem;">
                    <div style="width: 50px; height: 50px; border: 3px solid rgba(0, 212, 255, 0.1); border-top-color: var(--flow-cyan); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                    <p style="color: var(--flow-gray);">Loading products...</p>
                </div>
            `;
            
            try {
                const response = await fetch(`${API_BASE}/api/products`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    products = data.data;
                    renderFlavourFilters(); // Populate flavour filters dynamically
                    renderProducts();
                } else {
                    grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 4rem;"><p style="color: var(--flow-gray);">No products found</p></div>`;
                }
            } catch (error) {
                console.error('Error loading products:', error);
                grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 4rem;"><p style="color: var(--flow-gray);">Failed to load products</p></div>`;
            }
        }

        // Known flavor colors mapping
        const FLAVOR_COLORS = {
            'original': '#00D4FF',
            'lemonade': '#FFD93D',
            'mango': '#FF9F43',
            'berry': '#EE5A6F',
            'citrus': '#7BD83A',
            'tropical': '#FF6B9D',
            'mint': '#2ED573',
            'variety': '#00D4FF'
        };

        // Extract flavor from product name (e.g., "Flow Lemonade" -> { name, slug, color })
        function extractFlavorFromName(productName) {
            if (!productName) return { name: 'Original', slug: 'original', color: FLAVOR_COLORS.original };
            const name = productName.toLowerCase();
            if (name.includes('lemonade')) return { name: 'Lemonade', slug: 'lemonade', color: FLAVOR_COLORS.lemonade };
            if (name.includes('mango')) return { name: 'Mango', slug: 'mango', color: FLAVOR_COLORS.mango };
            if (name.includes('original')) return { name: 'Original', slug: 'original', color: FLAVOR_COLORS.original };
            if (name.includes('berry')) return { name: 'Berry', slug: 'berry', color: FLAVOR_COLORS.berry };
            if (name.includes('citrus')) return { name: 'Citrus', slug: 'citrus', color: FLAVOR_COLORS.citrus };
            if (name.includes('tropical')) return { name: 'Tropical', slug: 'tropical', color: FLAVOR_COLORS.tropical };
            if (name.includes('mint')) return { name: 'Mint', slug: 'mint', color: FLAVOR_COLORS.mint };
            if (name.includes('variety')) return { name: 'Variety', slug: 'variety', color: FLAVOR_COLORS.variety };
            return { name: 'Original', slug: 'original', color: FLAVOR_COLORS.original };
        }

        // Get bundle flavors (for variety packs)
        function getBundleFlavors() {
            return [
                { name: 'Original', slug: 'original', color: FLAVOR_COLORS.original },
                { name: 'Mango', slug: 'mango', color: FLAVOR_COLORS.mango },
                { name: 'Lemonade', slug: 'lemonade', color: FLAVOR_COLORS.lemonade }
            ];
        }

        // Get primary image URL from product media
        function getProductImage(product) {
            if (product.media && product.media.length > 0) {
                const primaryMedia = product.media.find(m => m.isPrimary && m.type === 'image') || product.media.find(m => m.type === 'image');
                return primaryMedia ? primaryMedia.url : null;
            }
            return null;
        }

        // Convert hex color to rgba
        function hexToRgba(hex, alpha) {
            if (!hex) return `rgba(0, 212, 255, ${alpha})`;
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            if (result) {
                return `rgba(${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}, ${alpha})`;
            }
            return `rgba(0, 212, 255, ${alpha})`;
        }

        // Build product card HTML
        function buildProductCard(product, pack, isBundle, isFeatured = false) {
            const flavor = extractFlavorFromName(product.name);
            const bundleFlavors = getBundleFlavors();
            const imageUrl = getProductImage(product);
            const uniqueId = `${product.slug}-${pack.size}`;
            const displayName = `${product.name} — ${pack.label}`;
            
            // Badge logic
            let badgeHtml = '';
            const badge = product.badges && product.badges[0];
            if (badge && badge.type === 'bestseller') {
                badgeHtml = `<div class="product-badge bestseller">${badge.text}</div>`;
            } else if (isFeatured) {
                badgeHtml = `<div class="product-badge new">Featured</div>`;
            } else if (pack.savings) {
                badgeHtml = `<div class="product-badge sale">${pack.savings}</div>`;
            }

            // Image section
            let imageHtml = '';
            if (imageUrl) {
                imageHtml = `<img src="${imageUrl}" alt="${product.name}" class="product-thumbnail-img" style="width: 100%; height: 100%; object-fit: contain;" />`;
            } else if (isBundle) {
                imageHtml = `
                    <div style="display: flex; gap: 8px; justify-content: center; align-items: flex-end;">
                        ${bundleFlavors.map(f => `
                            <div class="sachet-visual" style="width: 60px; height: 90px; background: linear-gradient(135deg, ${hexToRgba(f.color, 0.3)} 0%, ${hexToRgba(f.color, 0.1)} 100%);">
                                <div class="sachet-content">
                                    <div class="sachet-logo" style="font-size: 0.7rem;">Flow</div>
                                    <div class="sachet-flavor" style="font-size: 0.5rem;">${f.name}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                const sachetStyle = `background: linear-gradient(135deg, ${hexToRgba(flavor.color, 0.3)} 0%, ${hexToRgba(flavor.color, 0.1)} 100%);`;
                imageHtml = `
                    <div class="sachet-visual" style="${sachetStyle}">
                        <div class="sachet-content">
                            <div class="sachet-logo">Flow</div>
                            <div class="sachet-flavor">${flavor.name}</div>
                        </div>
                    </div>
                `;
            }

            // Meta info
            const categoryLabel = isBundle ? 'Bundle' : (product.category ? product.category.charAt(0).toUpperCase() + product.category.slice(1) : 'Hydration');
            const metaSecond = isBundle ? `${bundleFlavors.length} flavours` : flavor.name;
            const description = product.shortDescription || (product.description ? product.description.slice(0, 100) + '...' : '');
            const flavorSlug = isBundle ? '' : flavor.slug;

            return `
                <div class="product-card ${isFeatured ? 'featured bundle' : ''}" 
                     data-slug="${product.slug}" 
                     data-flavour="${flavorSlug}"
                     data-pack="${pack.size}"
                     data-category="${product.category || 'hydration'}"
                     onclick="goToProduct('${product.slug}', '${flavorSlug}', ${pack.size})">
                    ${badgeHtml}
                    <div class="product-image">
                        ${imageHtml}
                    </div>
                    <div class="product-info">
                        <div class="product-category">${categoryLabel}</div>
                        <h3 class="product-name">${displayName}</h3>
                        <p class="product-desc">${description}</p>
                        <div class="product-meta">
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M2 12h20"/>
                                </svg>
                                ${pack.size} sachets
                            </div>
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                                </svg>
                                ${metaSecond}
                            </div>
                        </div>
                        <div class="product-footer">
                            <div class="product-price">
                                <span class="price-current">₹${pack.price.toLocaleString()}</span>
                                ${pack.size !== 5 && pack.comparePrice ? `<span class="price-original">₹${pack.comparePrice.toLocaleString()}</span>` : ''}
                            </div>
                            <button class="add-to-cart" data-product="${uniqueId}" data-name="${displayName}" data-price="${pack.price}" data-image="${imageUrl || ''}" onclick="event.stopPropagation(); addToCart('${uniqueId}', '${displayName}', ${pack.price}, '${flavor.name}', ${imageUrl ? `'${imageUrl}'` : 'null'});">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <path d="M16 10a4 4 0 01-8 0"/>
                                </svg>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProducts() {
            const grid = document.querySelector('.products-grid');
            
            if (!products || products.length === 0) {
                grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 4rem;"><p style="color: var(--flow-gray);">No products available</p></div>`;
                return;
            }
            
            // Build expanded list: one card per product per pack size
            const expandedProducts = [];
            
            products.forEach(product => {
                const isBundle = product.category === 'bundle';
                const flavor = extractFlavorFromName(product.name);
                
                if (product.packSizes && product.packSizes.length > 0) {
                    product.packSizes.forEach(pack => {
                        expandedProducts.push({
                            product,
                            pack,
                            isBundle,
                            flavor,
                            uniqueId: `${product.slug}-${pack.size}`
                        });
                    });
                }
            });
            
            // Update filter counts
            updateFilterCounts(expandedProducts);
            
            // Apply filters
            let filteredProducts = [...expandedProducts];
            
            // Category filter (multi-select)
            if (activeCategories.length > 0 && activeCategories.length < 2) {
                filteredProducts = filteredProducts.filter(p => {
                    if (p.isBundle) {
                        return activeCategories.includes('bundle');
                    } else {
                        return activeCategories.includes('single');
                    }
                });
            }
            
            // Flavour filter (multi-select)
            if (activeFlavours.length > 0) {
                filteredProducts = filteredProducts.filter(p => {
                    if (p.isBundle) {
                        // Bundles match all flavors (they contain all)
                        return getBundleFlavors().some(f => activeFlavours.includes(f.slug));
                    }
                    return p.flavor && activeFlavours.includes(p.flavor.slug);
                });
            }
            
            // Apply sorting
            switch (activeSort) {
                case 'price-low':
                    filteredProducts.sort((a, b) => a.pack.price - b.pack.price);
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => b.pack.price - a.pack.price);
                    break;
                case 'name-az':
                    filteredProducts.sort((a, b) => a.product.name.localeCompare(b.product.name));
                    break;
                case 'name-za':
                    filteredProducts.sort((a, b) => b.product.name.localeCompare(a.product.name));
                    break;
                case 'featured':
                default:
                    // Bundles first, then by product order
                    filteredProducts.sort((a, b) => {
                        if (a.isBundle && !b.isBundle) return -1;
                        if (!a.isBundle && b.isBundle) return 1;
                        return 0;
                    });
                    break;
            }
            
            // Show no results message if empty
            if (filteredProducts.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 4rem;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--flow-gray)" stroke-width="1" style="margin-bottom: 1rem; opacity: 0.5;">
                            <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                        <h3 style="color: var(--flow-white); margin-bottom: 0.5rem;">No products found</h3>
                        <p style="color: var(--flow-gray);">Try adjusting your filters</p>
                        <button onclick="clearAllFilters();" style="margin-top: 1rem; background: var(--flow-cyan); color: var(--flow-dark); border: none; padding: 0.75rem 1.5rem; border-radius: 50px; font-family: 'Outfit', sans-serif; font-weight: 600; cursor: pointer;">Clear Filters</button>
                    </div>
                `;
                document.querySelector('.products-count strong').textContent = 0;
                return;
            }
            
            // Pick one random bundle to be featured
            const bundleItems = filteredProducts.filter(p => p.isBundle);
            const featuredBundleId = bundleItems.length > 0 
                ? bundleItems[Math.floor(Math.random() * bundleItems.length)].uniqueId 
                : null;
            
            // Move featured card to first position
            if (featuredBundleId) {
                const featuredIndex = filteredProducts.findIndex(p => p.uniqueId === featuredBundleId);
                if (featuredIndex > 0) {
                    const [featuredItem] = filteredProducts.splice(featuredIndex, 1);
                    filteredProducts.unshift(featuredItem);
                }
            }
            
            // Render product cards
            grid.innerHTML = filteredProducts.map(item => {
                const isFeatured = item.isBundle && item.uniqueId === featuredBundleId;
                return buildProductCard(item.product, item.pack, item.isBundle, isFeatured);
            }).join('');
            
            // Update product count
            document.querySelector('.products-count strong').textContent = filteredProducts.length;
            
            // Re-bind add to cart button animations and update with quantities
            bindAddToCartButtons();
            updateAddToCartButtons();
        }

        function goToProduct(slug, flavour, packSize) {
            window.location.href = `/product/?product=${slug}&flavour=${flavour}&pack=${packSize}`;
        }

        function bindAddToCartButtons() {
            document.querySelectorAll('.add-to-cart').forEach(button => {
                // Skip if button already has quantity controls (item in cart)
                if (button.classList.contains('has-quantity')) return;
                
                // Remove existing listeners to prevent duplicates
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                
                // Button click handled by onclick attribute in HTML
                // This function is just for initialization
            });
        }

        // Filter Functions
        function setCategory(category) {
            if (category === 'all') {
                // Select all categories
                activeCategories = ['single', 'bundle'];
            } else {
                // Toggle the category
                const index = activeCategories.indexOf(category);
                if (index > -1) {
                    // Don't allow deselecting if it's the only one selected
                    if (activeCategories.length > 1) {
                        activeCategories.splice(index, 1);
                    }
                } else {
                    activeCategories.push(category);
                }
            }
            
            // Update UI
            document.querySelectorAll('#categoryFilters .filter-option').forEach(opt => {
                const cat = opt.dataset.category;
                if (cat === 'all') {
                    opt.classList.toggle('active', activeCategories.length === 2);
                } else {
                    opt.classList.toggle('active', activeCategories.includes(cat));
                }
            });
            
            renderProducts();
        }
        
        function setFlavour(flavour) {
            if (flavour === 'all') {
                // Clear all selections (show all)
                activeFlavours = [];
            } else {
                // Toggle the flavour
                const index = activeFlavours.indexOf(flavour);
                if (index > -1) {
                    activeFlavours.splice(index, 1);
                } else {
                    activeFlavours.push(flavour);
                }
            }
            
            // Update UI
            document.querySelectorAll('#flavourFilters .filter-option').forEach(opt => {
                const flav = opt.dataset.flavour;
                if (flav === 'all') {
                    opt.classList.toggle('active', activeFlavours.length === 0);
                } else {
                    opt.classList.toggle('active', activeFlavours.includes(flav));
                }
            });
            
            renderProducts();
        }
        
        function clearAllFilters() {
            // Reset categories to all
            activeCategories = ['single', 'bundle'];
            document.querySelectorAll('#categoryFilters .filter-option').forEach(opt => {
                opt.classList.add('active');
            });
            
            // Reset flavours to all (empty array)
            activeFlavours = [];
            document.querySelectorAll('#flavourFilters .filter-option').forEach(opt => {
                const flav = opt.dataset.flavour;
                opt.classList.toggle('active', flav === 'all');
            });
            
            renderProducts();
        }
        
        function setSort(sortOption) {
            activeSort = sortOption;
            renderProducts();
        }
        
        function renderFlavourFilters() {
            // Collect all unique flavours from products by extracting from names
            const flavourMap = new Map();
            
            products.forEach(p => {
                if (p.category === 'bundle') {
                    // Add all bundle flavors
                    getBundleFlavors().forEach(f => {
                        if (!flavourMap.has(f.slug)) {
                            flavourMap.set(f.slug, f);
                        }
                    });
                } else {
                    // Extract flavor from product name
                    const flavor = extractFlavorFromName(p.name);
                    if (!flavourMap.has(flavor.slug)) {
                        flavourMap.set(flavor.slug, flavor);
                    }
                }
            });
            
            const flavours = Array.from(flavourMap.values());
            
            const container = document.getElementById('flavourFilters');
            container.innerHTML = `
                <h3><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--flow-cyan)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg> Flavour</h3>
                <div class="filter-option ${activeFlavours.length === 0 ? 'active' : ''}" data-flavour="all" onclick="setFlavour('all')">
                    <div class="filter-checkbox"></div>
                    <span class="filter-label">All Flavours</span>
                </div>
                ${flavours.map(f => `
                    <div class="filter-option ${activeFlavours.includes(f.slug) ? 'active' : ''}" data-flavour="${f.slug}" onclick="setFlavour('${f.slug}')">
                        <div class="filter-checkbox"></div>
                        <span class="filter-label" style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="width: 12px; height: 12px; border-radius: 50%; background: ${f.color || 'var(--flow-cyan)'}; flex-shrink: 0;"></span>
                            ${f.name}
                        </span>
                    </div>
                `).join('')}
            `;
        }
        
        function updateFilterCounts(expandedProducts) {
            // Count products by category
            const singleCount = expandedProducts.filter(p => !p.isBundle).length;
            const bundleCount = expandedProducts.filter(p => p.isBundle).length;
            
            document.getElementById('countSingle').textContent = singleCount;
            document.getElementById('countBundle').textContent = bundleCount;
        }

        // Toggle Cart
        function openCart() {
            cartOverlay.classList.add('active');
            cartDrawer.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCart() {
            cartOverlay.classList.remove('active');
            cartDrawer.classList.remove('active');
            document.body.style.overflow = '';
        }

        cartToggle.addEventListener('click', openCart);
        cartOverlay.addEventListener('click', closeCart);
        cartClose.addEventListener('click', closeCart);
        continueShopping.addEventListener('click', closeCart);

        // Show Toast (generic)
        function showToast(message) {
            toastMessage.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2500);
        }

        // Cart Toast elements
        const cartToast = document.getElementById('cartToast');
        const cartToastImage = document.getElementById('cartToastImage');
        const cartToastTitle = document.getElementById('cartToastTitle');
        const cartToastText = document.getElementById('cartToastText');
        let cartToastTimeout = null;

        // Show Cart Toast with product image
        function showCartToast(productName, quantity, image = null) {
            // Clear any existing timeout
            if (cartToastTimeout) {
                clearTimeout(cartToastTimeout);
            }
            
            // Update toast content
            cartToastTitle.textContent = productName;
            cartToastText.textContent = quantity > 1 ? `Quantity: ${quantity} in cart` : 'Added to cart!';
            
            // Update image - handle null, undefined, empty string, and 'null' string
            if (image && image !== 'null' && image !== 'undefined' && image !== '') {
                cartToastImage.innerHTML = `<img src="${image}" alt="${productName}" onerror="this.parentElement.innerHTML='<div class=\\'sachet-mini\\'>Flow</div>'">`;
            } else {
                // Use sachet visual as fallback
                cartToastImage.innerHTML = '<div class="sachet-mini">Flow</div>';
            }
            
            // Show toast
            cartToast.classList.add('show');
            
            // Auto-hide after 3 seconds
            cartToastTimeout = setTimeout(() => {
                hideCartToast();
            }, 3000);
        }

        // Hide Cart Toast
        function hideCartToast() {
            cartToast.classList.remove('show');
            if (cartToastTimeout) {
                clearTimeout(cartToastTimeout);
                cartToastTimeout = null;
            }
        }

        // Update Cart UI
        function updateCartUI() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Calculate shipping first (before discount) - no shipping if cart is empty
            const shipping = (subtotal === 0 || subtotal >= FREE_SHIPPING_THRESHOLD) ? 0 : SHIPPING_COST;
            const orderTotal = subtotal + shipping;
            
            // Calculate discount on cart total (round up to benefit customer)
            let discountAmount = 0;
            if (appliedDiscount && orderTotal > 0) {
                if (appliedDiscount.type === 'percent') {
                    discountAmount = Math.ceil(orderTotal * (appliedDiscount.value / 100));
                    // Apply max discount cap if specified
                    if (appliedDiscount.maxDiscount && discountAmount > appliedDiscount.maxDiscount) {
                        discountAmount = appliedDiscount.maxDiscount;
                    }
                } else {
                    discountAmount = appliedDiscount.value;
                }
                // Discount cannot exceed cart total
                discountAmount = Math.min(discountAmount, orderTotal);
            }
            
            const total = orderTotal - discountAmount;

            // Update cart count
            cartCount.textContent = totalItems;
            
            // Update mobile cart count
            const mobileCartCount = document.getElementById('mobileCartCount');
            if (mobileCartCount) {
                mobileCartCount.textContent = totalItems;
                mobileCartCount.style.display = totalItems > 0 ? 'flex' : 'none';
            }

            // Update cart items
            if (cart.length === 0) {
                cartEmpty.style.display = 'block';
                cartFooter.style.display = 'none';
                cartItems.innerHTML = '';
                cartItems.appendChild(cartEmpty);
                // Reset discount when cart is empty
                appliedDiscount = null;
            } else {
                cartEmpty.style.display = 'none';
                cartFooter.style.display = 'block';

                cartItems.innerHTML = cart.map(item => {
                    const itemId = item.id || item.productSlug;
                    const imageHtml = item.image 
                        ? `<img src="${item.image}" alt="${item.name}">`
                        : `<div class="mini-sachet"></div>`;
                    return `
                    <div class="cart-item" data-product="${itemId}">
                        <div class="cart-item-image">
                            ${imageHtml}
                        </div>
                        <div class="cart-item-details">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-variant">${item.flavour || 'Electrolyte Hydration'}</div>
                            <div class="cart-item-actions">
                                <div class="cart-item-qty">
                                    <button onclick="updateQuantity('${itemId}', -1)">−</button>
                                    <span>${item.quantity}</span>
                                    <button onclick="updateQuantity('${itemId}', 1)">+</button>
                                </div>
                                <div class="cart-item-price">₹${(item.price * item.quantity).toLocaleString()}</div>
                            </div>
                            <button class="cart-item-remove" onclick="removeFromCart('${itemId}')">Remove</button>
                        </div>
                    </div>
                `}).join('');
            }

            // Update totals
            cartSubtotal.textContent = `₹${subtotal.toLocaleString()}`;
            
            // Update discount row
            const discountRow = document.getElementById('discountRow');
            const cartDiscountEl = document.getElementById('cartDiscount');
            if (appliedDiscount && discountAmount > 0) {
                discountRow.style.display = 'flex';
                cartDiscountEl.textContent = `-₹${discountAmount.toLocaleString()}`;
            } else {
                discountRow.style.display = 'none';
            }
            
            cartShipping.textContent = shipping === 0 ? 'FREE' : `₹${shipping}`;
            cartTotal.textContent = `₹${total.toLocaleString()}`;

            // Update shipping progress (based on subtotal, before discount)
            if (subtotal >= FREE_SHIPPING_THRESHOLD) {
                shippingText.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> You\'ve unlocked <span>FREE shipping!</span>';
                shippingText.classList.add('free-shipping');
                shippingBar.style.width = '100%';
                shippingBar.classList.add('complete');
            } else {
                const remaining = FREE_SHIPPING_THRESHOLD - subtotal;
                shippingText.innerHTML = `Add <span>₹${remaining}</span> more for free shipping!`;
                shippingText.classList.remove('free-shipping');
                shippingBar.style.width = `${(subtotal / FREE_SHIPPING_THRESHOLD) * 100}%`;
                shippingBar.classList.remove('complete');
            }
        }
        
        // Discount Code Functions
        async function applyDiscountCode() {
            const input = document.getElementById('discountInput');
            const errorEl = document.getElementById('discountError');
            const appliedEl = document.getElementById('discountApplied');
            const formSection = document.getElementById('discountFormSection');
            const applyBtn = document.getElementById('discountApplyBtn');
            const code = input.value.trim().toUpperCase();
            
            errorEl.style.display = 'none';
            
            if (!code) {
                errorEl.textContent = 'Please enter a discount code';
                errorEl.style.display = 'block';
                return;
            }
            
            // Calculate current subtotal for validation
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Disable button while validating
            applyBtn.disabled = true;
            applyBtn.textContent = '...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/discount-codes/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, orderTotal: subtotal })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    appliedDiscount = data.code;
                    
                    // Update UI
                    document.getElementById('appliedCode').textContent = appliedDiscount.code;
                    
                    let discountText = appliedDiscount.type === 'percent' 
                        ? `-${appliedDiscount.value}%` 
                        : `-₹${appliedDiscount.value}`;
                    if (appliedDiscount.maxDiscount && appliedDiscount.type === 'percent') {
                        discountText += ` (max ₹${appliedDiscount.maxDiscount})`;
                    }
                    document.getElementById('appliedValue').textContent = discountText;
                    
                    formSection.style.display = 'none';
                    document.getElementById('publicCodesSection')?.remove();
                    appliedEl.style.display = 'flex';
                    input.value = '';
                    
                    updateCartUI();
                    showToast(`Discount code "${appliedDiscount.code}" applied!`);
                } else {
                    errorEl.textContent = data.message || 'Invalid discount code. Please try again.';
                    errorEl.style.display = 'block';
                }
            } catch (error) {
                console.error('Error validating discount code:', error);
                errorEl.textContent = 'Unable to validate code. Please try again.';
                errorEl.style.display = 'block';
            } finally {
                applyBtn.disabled = false;
                applyBtn.textContent = 'Apply';
            }
        }
        
        function removeDiscountCode() {
            appliedDiscount = null;
            
            const appliedEl = document.getElementById('discountApplied');
            const formSection = document.getElementById('discountFormSection');
            
            appliedEl.style.display = 'none';
            formSection.style.display = 'flex';
            
            // Re-render public codes if available
            renderPublicCodes();
            
            updateCartUI();
            showToast('Discount code removed');
        }
        
        // Auto-apply discount code from URL (no user input required)
        async function autoApplyDiscountCode(code) {
            if (!code) return;
            
            console.log('Auto-applying discount code:', code);
            console.log('Cart:', cart);
            
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            console.log('Subtotal for discount:', subtotal);
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/discount-codes/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code.toUpperCase(), orderTotal: subtotal })
                });
                
                const data = await response.json();
                console.log('Discount validation response:', data);
                
                if (data.success) {
                    appliedDiscount = data.code;
                    console.log('Applied discount set to:', appliedDiscount);
                    
                    // Update UI elements if they exist
                    const appliedEl = document.getElementById('discountApplied');
                    const formSection = document.getElementById('discountFormSection');
                    const appliedCodeEl = document.getElementById('appliedCode');
                    const appliedValueEl = document.getElementById('appliedValue');
                    
                    if (appliedCodeEl) appliedCodeEl.textContent = appliedDiscount.code;
                    
                    let discountText = appliedDiscount.type === 'percent' 
                        ? `-${appliedDiscount.value}%` 
                        : `-₹${appliedDiscount.value}`;
                    if (appliedDiscount.maxDiscount && appliedDiscount.type === 'percent') {
                        discountText += ` (max ₹${appliedDiscount.maxDiscount})`;
                    }
                    if (appliedValueEl) appliedValueEl.textContent = discountText;
                    
                    if (formSection) formSection.style.display = 'none';
                    document.getElementById('publicCodesSection')?.remove();
                    if (appliedEl) appliedEl.style.display = 'flex';
                    
                    updateCartUI();
                    showToast(`Discount code "${appliedDiscount.code}" applied!`);
                } else {
                    console.log('Discount validation failed:', data.message);
                }
            } catch (error) {
                console.error('Error auto-applying discount code:', error);
            }
        }
        
        // Load and display public discount codes
        async function loadPublicDiscountCodes() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/discount-codes/public`);
                const data = await response.json();
                
                if (data.success && data.codes.length > 0) {
                    publicDiscountCodes = data.codes;
                    renderPublicCodes();
                }
            } catch (error) {
                console.error('Error loading public discount codes:', error);
            }
        }
        
        function renderPublicCodes() {
            // Don't show if discount already applied
            if (appliedDiscount) return;
            
            // Remove existing section if any
            document.getElementById('publicCodesSection')?.remove();
            
            if (publicDiscountCodes.length === 0) return;
            
            const discountSection = document.querySelector('.discount-section');
            const publicSection = document.createElement('div');
            publicSection.id = 'publicCodesSection';
            publicSection.className = 'public-codes-section';
            publicSection.innerHTML = `
                <p class="public-codes-label">Available Offers:</p>
                <div class="public-codes-list">
                    ${publicDiscountCodes.map(code => {
                        const discountText = code.type === 'percent' 
                            ? `${code.value}% off${code.maxDiscount ? ` (max ₹${code.maxDiscount})` : ''}`
                            : `₹${code.value} off`;
                        const minText = code.minOrderValue > 0 ? ` on orders above ₹${code.minOrderValue}` : '';
                        return `
                            <button class="public-code-chip" onclick="usePublicCode('${code.code}')">
                                <span class="public-code-name">${code.code}</span>
                                <span class="public-code-desc">${discountText}${minText}</span>
                            </button>
                        `;
                    }).join('')}
                </div>
            `;
            discountSection.appendChild(publicSection);
        }
        
        function usePublicCode(code) {
            document.getElementById('discountInput').value = code;
            applyDiscountCode();
        }
        
        // Load saved discount on init
        async function loadSavedDiscount() {
            // Discount codes are no longer persisted in localStorage
            // Users must re-apply discount codes each session
            appliedDiscount = null;
        }

        // Add to Cart - integrated with CustomerAuth
        function addToCart(productId, name, price, flavour = null, image = null) {
            const existingIndex = cart.findIndex(item => 
                item.id === productId || (item.productSlug === productId && item.flavour === flavour)
            );
            
            if (existingIndex > -1) {
                cart[existingIndex].quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    productSlug: productId,
                    name: name,
                    price: price,
                    quantity: 1,
                    flavour: flavour,
                    image: image
                });
            }

            // Sync with CustomerAuth
            if (typeof CustomerAuth !== 'undefined') {
                CustomerAuth.saveLocalCart(cart);
                if (CustomerAuth.isLoggedIn()) {
                    CustomerAuth.syncCartToServer(cart);
                }
            } else {
                localStorage.setItem('flow_cart', JSON.stringify(cart));
            }
            
            updateCartUI();
            updateAddToCartButtons();
            
            // Show cart toast with image
            const cartItem = cart.find(item => item.id === productId || item.productSlug === productId);
            const quantity = cartItem ? cartItem.quantity : 1;
            showCartToast(name, quantity, image);
            
            // Open cart drawer
            openCart();
        }

        // Update Quantity - integrated with CustomerAuth
        function updateQuantity(productId, change) {
            const index = cart.findIndex(item => item.id === productId || item.productSlug === productId);
            if (index > -1) {
                cart[index].quantity += change;
                if (cart[index].quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    // Sync with CustomerAuth
                    if (typeof CustomerAuth !== 'undefined') {
                        CustomerAuth.saveLocalCart(cart);
                        if (CustomerAuth.isLoggedIn()) {
                            CustomerAuth.syncCartToServer(cart);
                        }
                    } else {
                        localStorage.setItem('flow_cart', JSON.stringify(cart));
                    }
                    updateCartUI();
                    updateAddToCartButtons();
                }
            }
        }

        // Remove from Cart - integrated with CustomerAuth
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId && item.productSlug !== productId);
            
            // Sync with CustomerAuth
            if (typeof CustomerAuth !== 'undefined') {
                CustomerAuth.saveLocalCart(cart);
                if (CustomerAuth.isLoggedIn()) {
                    CustomerAuth.syncCartToServer(cart);
                }
            } else {
                localStorage.setItem('flow_cart', JSON.stringify(cart));
            }
            
            updateCartUI();
            updateAddToCartButtons();
            showToast('Item removed from cart');
        }

        // Update Add to Cart buttons to show quantity
        function updateAddToCartButtons() {
            document.querySelectorAll('.add-to-cart').forEach(button => {
                const productId = button.dataset.product;
                const productName = button.dataset.name;
                const productPrice = button.dataset.price;
                
                if (!productId) return;
                
                const cartItem = cart.find(item => item.id === productId || item.productSlug === productId);
                
                if (cartItem && cartItem.quantity > 0) {
                    button.classList.add('has-quantity');
                    button.onclick = (e) => e.stopPropagation();
                    button.innerHTML = `
                        <div class="qty-controls">
                            <button class="qty-btn" onclick="event.stopPropagation(); updateQuantityFromButton('${productId}', -1)">−</button>
                            <span class="qty-count">${cartItem.quantity}</span>
                            <button class="qty-btn" onclick="event.stopPropagation(); updateQuantityFromButton('${productId}', 1)">+</button>
                        </div>
                    `;
                } else {
                    button.classList.remove('has-quantity');
                    // Restore the Add to Cart functionality
                    button.onclick = (e) => {
                        e.stopPropagation();
                        addToCart(productId, productName, parseFloat(productPrice));
                    };
                    button.innerHTML = `
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                            <line x1="3" y1="6" x2="21" y2="6"/>
                            <path d="M16 10a4 4 0 01-8 0"/>
                        </svg>
                        Add to Cart
                    `;
                }
            });
        }

        // Update quantity from button (product card)
        function updateQuantityFromButton(productId, change) {
            const index = cart.findIndex(item => item.id === productId || item.productSlug === productId);
            if (index > -1) {
                cart[index].quantity += change;
                if (cart[index].quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    // Sync with CustomerAuth
                    if (typeof CustomerAuth !== 'undefined') {
                        CustomerAuth.saveLocalCart(cart);
                        if (CustomerAuth.isLoggedIn()) {
                            CustomerAuth.syncCartToServer(cart);
                        }
                    } else {
                        localStorage.setItem('flow_cart', JSON.stringify(cart));
                    }
                    updateCartUI();
                    updateAddToCartButtons();
                }
            }
        }

        // Initialize
        updateCartUI();
        updateAddToCartButtons();

        // ========== GO TO CHECKOUT ==========
        function goToCheckout() {
            if (cart.length === 0) {
                showToast('Your cart is empty!');
                return;
            }
            
            // Close cart drawer and open quick checkout popup instead
            openQuickCheckout();
        }

        // ========== QUICK CHECKOUT FUNCTIONALITY ==========
        const quickCheckoutOverlay = document.getElementById('quickCheckoutOverlay');
        const quickCheckoutClose = document.getElementById('quickCheckoutClose');
        let qcShippingCost = 0;
        let qcCurrentStep = 1;
        
        // Google Maps variables
        let qcMap = null;
        let qcMarker = null;
        let qcAutocomplete = null;
        let qcSelectedLocation = null;
        let qcSelectedSavedAddress = null;
        let qcHasSavedAddresses = false;

        // Open Quick Checkout - requires authentication
        function openQuickCheckout() {
            if (cart.length === 0) {
                showToast('Your cart is empty!');
                return;
            }
            
            // Check if user is logged in
            if (!CustomerAuth.isLoggedIn()) {
                CustomerAuth.showModal(() => {
                    // After successful login, open checkout
                    proceedToCheckout();
                });
                return;
            }
            
            proceedToCheckout();
        }
        
        function proceedToCheckout() {
            closeCart();
            quickCheckoutOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            updateQCSummary();
            
            // Clear any previous errors
            const errorEl = document.getElementById('qcAddressError');
            if (errorEl) errorEl.style.display = 'none';
            
            // Pre-fill customer data if available (this also loads saved addresses)
            prefillCustomerData();
            
            // Note: Google Maps initialization is now deferred
            // It will only be initialized when user clicks "Add new address"
            // or when there are no saved addresses
        }
        
        // Clear error when user types in house floor field
        document.getElementById('qcHouseFloor')?.addEventListener('input', function() {
            this.classList.remove('error');
            const errorEl = document.getElementById('qcAddressError');
            if (errorEl) errorEl.style.display = 'none';
        });
        
        async function prefillCustomerData() {
            // First use cached customer data for immediate UI (name, phone, email only)
            let customer = CustomerAuth.getCustomer();
            
            // Pre-fill name if available
            const nameInput = document.getElementById('qcName');
            if (nameInput && customer?.name) {
                nameInput.value = customer.name;
            }
            
            // Pre-fill phone
            const phoneInput = document.getElementById('qcPhone');
            if (phoneInput && customer?.mobile) {
                phoneInput.value = customer.mobile;
            }
            
            // Pre-fill email if available
            const emailInput = document.getElementById('qcEmail');
            if (emailInput && customer?.email) {
                emailInput.value = customer.email;
            }
            
            // Fetch fresh customer profile from server (includes addresses)
            try {
                const token = CustomerAuth.getToken();
                console.log('Fetching customer profile with token:', token ? 'present' : 'missing');
                
                const response = await fetch(`${API_BASE_URL}/api/customer/profile`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();
                console.log('Profile API response:', data);
                
                if (data.success && data.customer) {
                    const freshCustomer = data.customer;
                    console.log('Loaded customer from server, addresses:', freshCustomer.addresses?.length || 0);
                    
                    // Update localStorage with fresh data
                    localStorage.setItem('flow_customer', JSON.stringify(freshCustomer));
                    
                    // Update name/email fields if not already filled
                    if (nameInput && !nameInput.value && freshCustomer.name) {
                        nameInput.value = freshCustomer.name;
                    }
                    if (emailInput && !emailInput.value && freshCustomer.email) {
                        emailInput.value = freshCustomer.email;
                    }
                    
                    // Load addresses
                    loadSavedAddresses(freshCustomer);
                } else {
                    console.log('Profile API failed, using cached customer');
                    loadSavedAddresses(customer || { addresses: [] });
                }
            } catch (error) {
                console.error('Failed to fetch customer profile from server:', error);
                // Fallback to cached customer data
                loadSavedAddresses(customer || { addresses: [] });
            }
        }
        
        function loadSavedAddresses(customer) {
            const savedAddressesContainer = document.getElementById('qcSavedAddresses');
            const savedAddressesList = document.getElementById('qcSavedAddressesList');
            const newAddressForm = document.getElementById('qcNewAddressForm');
            
            if (!savedAddressesList) {
                console.error('qcSavedAddressesList element not found');
                return;
            }
            
            // Clear existing addresses
            savedAddressesList.innerHTML = '';
            
            const addresses = customer?.addresses || [];
            console.log('Loading saved addresses:', addresses.length, addresses);
            qcHasSavedAddresses = addresses.length > 0;
            
            if (qcHasSavedAddresses) {
                // Show saved addresses, hide new address form initially
                if (savedAddressesContainer) savedAddressesContainer.style.display = 'flex';
                if (newAddressForm) newAddressForm.style.display = 'none';
                
                addresses.forEach((addr, index) => {
                    const isDefault = addr.isDefault || index === 0;
                    const addressItem = document.createElement('div');
                    addressItem.className = 'qc-saved-address-item' + (isDefault ? ' selected' : '');
                    
                    // Get icon based on address type
                    const typeIcon = getAddressTypeIcon(addr.type || 'home');
                    
                    addressItem.innerHTML = `
                        <label>
                            <input type="radio" name="savedAddress" value="${index}" ${isDefault ? 'checked' : ''}>
                            <div class="qc-address-radio-indicator"></div>
                            <div class="qc-address-content">
                                <div class="qc-address-header">
                                    <span class="qc-address-type-badge">
                                        ${typeIcon}
                                        ${addr.type || 'Home'}
                                    </span>
                                    ${isDefault ? '<span class="qc-address-default-tag">Default</span>' : ''}
                                </div>
                                <div class="qc-address-text">
                                    ${addr.houseFloor ? addr.houseFloor + ', ' : ''}${addr.fullAddress || addr.formattedAddress || ''}
                                </div>
                                <div class="qc-address-meta">
                                    ${addr.pincode ? `
                                    <span class="qc-address-pincode">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                            <circle cx="12" cy="10" r="3"/>
                                        </svg>
                                        ${addr.pincode}
                                    </span>` : ''}
                                    <span class="qc-delivery-estimate" id="deliveryEstimate${index}">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="1" y="3" width="15" height="13" rx="2"/>
                                            <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/>
                                            <circle cx="5.5" cy="18.5" r="2.5"/>
                                            <circle cx="18.5" cy="18.5" r="2.5"/>
                                        </svg>
                                        ${getDeliveryEstimate(addr.pincode)}
                                    </span>
                                </div>
                            </div>
                        </label>
                    `;
                    
                    // Add click event
                    addressItem.addEventListener('click', () => selectSavedAddress(index, addresses));
                    savedAddressesList.appendChild(addressItem);
                    
                    // Pre-select default address
                    if (isDefault) {
                        selectSavedAddress(index, addresses);
                    }
                });
            } else {
                // No saved addresses - show new address form directly
                if (savedAddressesContainer) savedAddressesContainer.style.display = 'none';
                if (newAddressForm) newAddressForm.style.display = 'block';
                
                // Initialize Google Maps
                if (typeof google !== 'undefined' && google.maps && !qcMap) {
                    setTimeout(initCheckoutMap, 100);
                } else {
                    // Wait for Google Maps to load
                    const checkGoogleMaps = setInterval(() => {
                        if (typeof google !== 'undefined' && google.maps) {
                            clearInterval(checkGoogleMaps);
                            initCheckoutMap();
                        }
                    }, 200);
                    setTimeout(() => clearInterval(checkGoogleMaps), 10000);
                }
            }
            
            // Update shipping cost based on cart total
            updateShippingCost();
        }
        
        function selectSavedAddress(index, addresses) {
            const addr = addresses[index];
            if (!addr) return;
            
            // Update UI selection
            document.querySelectorAll('.qc-saved-address-item').forEach((item, i) => {
                item.classList.toggle('selected', i === index);
                const radio = item.querySelector('input[type="radio"]');
                if (radio) radio.checked = (i === index);
            });
            
            // Store selected address
            qcSelectedSavedAddress = addr;
            qcSelectedLocation = {
                formattedAddress: addr.formattedAddress || addr.fullAddress,
                fullAddress: addr.fullAddress || (addr.houseFloor ? addr.houseFloor + ', ' + addr.formattedAddress : addr.formattedAddress),
                houseFloor: addr.houseFloor || '',
                city: addr.city || '',
                state: addr.state || '',
                pincode: addr.pincode || '',
                country: addr.country || 'India',
                lat: addr.lat || addr.coordinates?.lat,
                lng: addr.lng || addr.coordinates?.lng
            };
            
            // Update hidden fields
            document.getElementById('qcAddress').value = qcSelectedLocation.formattedAddress || '';
            document.getElementById('qcCity').value = qcSelectedLocation.city;
            document.getElementById('qcState').value = qcSelectedLocation.state;
            document.getElementById('qcPincode').value = qcSelectedLocation.pincode;
            document.getElementById('qcLatitude').value = qcSelectedLocation.lat || '';
            document.getElementById('qcLongitude').value = qcSelectedLocation.lng || '';
            document.getElementById('qcHouseFloor').value = qcSelectedLocation.houseFloor;
            
            // Update delivery time display in shipping option
            updateShippingDeliveryTime(qcSelectedLocation.pincode);
        }
        
        // Address Popup Variables
        let popupMap = null;
        let popupMarker = null;
        let popupAutocomplete = null;
        let popupSelectedLocation = null;
        
        function showNewAddressForm() {
            const customer = CustomerAuth.getCustomer();
            const hasExistingAddresses = customer && customer.addresses && customer.addresses.length > 0;
            
            if (hasExistingAddresses) {
                // Show popup modal for adding new address
                openAddressPopup();
            } else {
                // No existing addresses - show inline form (original behavior)
                const savedAddressesContainer = document.getElementById('qcSavedAddresses');
                const newAddressForm = document.getElementById('qcNewAddressForm');
                
                if (savedAddressesContainer) savedAddressesContainer.style.display = 'none';
                if (newAddressForm) newAddressForm.style.display = 'block';
                
                qcSelectedLocation = null;
                qcSelectedSavedAddress = null;
                document.getElementById('qcSelectedAddress').classList.remove('visible');
                document.getElementById('qcHouseFloor').value = '';
                
                if (!qcMap && typeof google !== 'undefined' && google.maps) {
                    initCheckoutMap();
                }
            }
        }
        
        function openAddressPopup() {
            const overlay = document.getElementById('addressPopupOverlay');
            overlay.classList.add('visible');
            document.body.style.overflow = 'hidden';
            
            // Reset popup state
            popupSelectedLocation = null;
            document.getElementById('popupSelectedAddress').classList.remove('visible');
            document.getElementById('popupHouseFloor').value = '';
            document.getElementById('popupAddressSearch').value = '';
            document.getElementById('popupAddressError').style.display = 'none';
            
            // Initialize popup map with a delay to ensure container is visible
            setTimeout(() => {
                if (typeof google !== 'undefined' && google.maps) {
                    if (!popupMap) {
                        initPopupMap();
                    } else {
                        // Trigger resize if map already exists
                        google.maps.event.trigger(popupMap, 'resize');
                    }
                }
            }, 300);
        }
        
        function closeAddressPopup() {
            const overlay = document.getElementById('addressPopupOverlay');
            overlay.classList.remove('visible');
            document.body.style.overflow = '';
        }
        
        function initPopupMap() {
            const mapContainer = document.getElementById('popupMap');
            if (!mapContainer || popupMap) return;
            
            const defaultCenter = { lat: 20.5937, lng: 78.9629 };
            
            popupMap = new google.maps.Map(mapContainer, {
                center: defaultCenter,
                zoom: 5,
                styles: [
                    { elementType: 'geometry', stylers: [{ color: '#0A1628' }] },
                    { elementType: 'labels.text.stroke', stylers: [{ color: '#0A1628' }] },
                    { elementType: 'labels.text.fill', stylers: [{ color: '#94A3B8' }] },
                    { featureType: 'road', elementType: 'geometry', stylers: [{ color: '#1a2b47' }] },
                    { featureType: 'water', elementType: 'geometry', stylers: [{ color: '#00D4FF', lightness: -70 }] },
                    { featureType: 'poi', elementType: 'labels', stylers: [{ visibility: 'off' }] }
                ],
                disableDefaultUI: true,
                zoomControl: true,
            });
            
            // Create marker
            popupMarker = new google.maps.Marker({
                map: popupMap,
                draggable: true,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 10,
                    fillColor: '#00D4FF',
                    fillOpacity: 1,
                    strokeWeight: 3,
                    strokeColor: '#ffffff'
                }
            });
            
            // Setup autocomplete
            const searchInput = document.getElementById('popupAddressSearch');
            popupAutocomplete = new google.maps.places.Autocomplete(searchInput, {
                componentRestrictions: { country: 'in' },
                fields: ['formatted_address', 'geometry', 'address_components']
            });
            
            popupAutocomplete.addListener('place_changed', () => {
                const place = popupAutocomplete.getPlace();
                if (place.geometry) {
                    const location = place.geometry.location;
                    popupMap.setCenter(location);
                    popupMap.setZoom(17);
                    popupMarker.setPosition(location);
                    popupMarker.setVisible(true);
                    updatePopupAddressFromPlace(place);
                }
            });
            
            // Marker drag event
            popupMarker.addListener('dragend', () => {
                const pos = popupMarker.getPosition();
                reverseGeocodePopup(pos.lat(), pos.lng());
            });
            
            // Map click event
            popupMap.addListener('click', (e) => {
                popupMarker.setPosition(e.latLng);
                popupMarker.setVisible(true);
                reverseGeocodePopup(e.latLng.lat(), e.latLng.lng());
            });
            
            // Trigger resize to ensure map renders correctly
            setTimeout(() => {
                google.maps.event.trigger(popupMap, 'resize');
                popupMap.setCenter(defaultCenter);
            }, 100);
        }
        
        function updatePopupAddressFromPlace(place) {
            const addressComponents = place.address_components || [];
            let city = '', state = '', pincode = '', country = 'India';
            
            addressComponents.forEach(comp => {
                const types = comp.types;
                if (types.includes('locality')) city = comp.long_name;
                if (types.includes('administrative_area_level_1')) state = comp.long_name;
                if (types.includes('postal_code')) pincode = comp.long_name;
                if (types.includes('country')) country = comp.long_name;
            });
            
            popupSelectedLocation = {
                address: place.formatted_address,
                city: city,
                state: state,
                pincode: pincode,
                country: country,
                lat: place.geometry.location.lat(),
                lng: place.geometry.location.lng()
            };
            
            document.getElementById('popupSelectedAddressText').textContent = place.formatted_address;
            document.getElementById('popupCityDisplay').textContent = city || '-';
            document.getElementById('popupStateDisplay').textContent = state || '-';
            document.getElementById('popupPincodeDisplay').textContent = pincode || '-';
            document.getElementById('popupCountryDisplay').textContent = country;
            document.getElementById('popupSelectedAddress').classList.add('visible');
            
            document.getElementById('popupCity').value = city;
            document.getElementById('popupState').value = state;
            document.getElementById('popupPincode').value = pincode;
            document.getElementById('popupAddress').value = place.formatted_address;
            document.getElementById('popupLatitude').value = popupSelectedLocation.lat;
            document.getElementById('popupLongitude').value = popupSelectedLocation.lng;
        }
        
        function reverseGeocodePopup(lat, lng) {
            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ location: { lat, lng } }, (results, status) => {
                if (status === 'OK' && results[0]) {
                    updatePopupAddressFromPlace(results[0]);
                }
            });
        }
        
        function useCurrentLocationPopup() {
            if (!navigator.geolocation) {
                showToast('Geolocation is not supported by your browser');
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const pos = { lat, lng };
                    
                    if (popupMap) {
                        popupMap.setCenter(pos);
                        popupMap.setZoom(17);
                        popupMarker.setPosition(pos);
                        popupMarker.setVisible(true);
                        reverseGeocodePopup(lat, lng);
                    }
                },
                (error) => {
                    showToast('Unable to get your location. Please search manually.');
                }
            );
        }
        
        async function saveNewAddressFromPopup() {
            const errorEl = document.getElementById('popupAddressError');
            const errorTextEl = document.getElementById('popupAddressErrorText');
            const saveBtn = document.getElementById('popupSaveAddressBtn');
            
            // Validate
            if (!popupSelectedLocation || !popupSelectedLocation.address) {
                errorTextEl.textContent = 'Please select a location on the map';
                errorEl.style.display = 'flex';
                return;
            }
            
            const houseFloor = document.getElementById('popupHouseFloor').value.trim();
            if (!houseFloor) {
                errorTextEl.textContent = 'Please enter house/floor/building details';
                errorEl.style.display = 'flex';
                document.getElementById('popupHouseFloor').classList.add('error');
                return;
            }
            
            errorEl.style.display = 'none';
            document.getElementById('popupHouseFloor').classList.remove('error');
            
            // Prepare address object
            const newAddress = {
                type: 'home',
                houseFloor: houseFloor,
                fullAddress: popupSelectedLocation.address,
                formattedAddress: popupSelectedLocation.address,
                city: popupSelectedLocation.city,
                state: popupSelectedLocation.state,
                pincode: popupSelectedLocation.pincode,
                country: popupSelectedLocation.country || 'India',
                latitude: popupSelectedLocation.lat,
                longitude: popupSelectedLocation.lng,
                isDefault: false
            };
            
            // Save to backend
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<span class="material-icons" style="font-size: 18px; animation: spin 1s linear infinite;">sync</span> Saving...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/customer/addresses`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CustomerAuth.getToken()}`
                    },
                    body: JSON.stringify(newAddress)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Update local customer data using the correct localStorage key
                    const customer = CustomerAuth.getCustomer();
                    if (customer) {
                        customer.addresses = data.addresses || [...(customer.addresses || []), newAddress];
                        localStorage.setItem('flow_customer', JSON.stringify(customer));
                    }
                    
                    // Close popup and refresh saved addresses
                    closeAddressPopup();
                    showToast('Address saved successfully!');
                    
                    // Ensure saved addresses section is visible and map form is hidden
                    const savedAddressesContainer = document.getElementById('qcSavedAddresses');
                    const newAddressForm = document.getElementById('qcNewAddressForm');
                    if (savedAddressesContainer) savedAddressesContainer.style.display = 'flex';
                    if (newAddressForm) newAddressForm.style.display = 'none';
                    
                    // Refresh the saved addresses list with updated customer data
                    const updatedCustomer = CustomerAuth.getCustomer();
                    loadSavedAddresses(updatedCustomer);
                    
                    // Auto-select the newly added address (last one)
                    setTimeout(() => {
                        const addresses = updatedCustomer?.addresses || [];
                        if (addresses.length > 0) {
                            selectSavedAddress(addresses.length - 1, addresses);
                            const radio = document.querySelector(`input[name="savedAddress"][value="${addresses.length - 1}"]`);
                            if (radio) radio.checked = true;
                        }
                    }, 150);
                } else {
                    errorTextEl.textContent = data.message || 'Failed to save address';
                    errorEl.style.display = 'flex';
                }
            } catch (error) {
                console.error('Error saving address:', error);
                errorTextEl.textContent = 'Failed to save address. Please try again.';
                errorEl.style.display = 'flex';
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<span class="material-icons" style="font-size: 18px;">save</span> Save Address';
            }
        }
        
        // Add event listener to remove error on input
        document.addEventListener('DOMContentLoaded', () => {
            const popupHouseInput = document.getElementById('popupHouseFloor');
            if (popupHouseInput) {
                popupHouseInput.addEventListener('input', () => popupHouseInput.classList.remove('error'));
            }
        });
        
        function showSavedAddresses() {
            const savedAddressesContainer = document.getElementById('qcSavedAddresses');
            const newAddressForm = document.getElementById('qcNewAddressForm');
            
            // Show saved addresses, hide map form
            if (savedAddressesContainer) savedAddressesContainer.style.display = 'flex';
            if (newAddressForm) newAddressForm.style.display = 'none';
            
            // Restore previously selected saved address if any
            const customer = CustomerAuth.getCustomer();
            if (customer && customer.addresses && customer.addresses.length > 0) {
                const checkedRadio = document.querySelector('input[name="savedAddress"]:checked');
                if (checkedRadio) {
                    selectSavedAddress(parseInt(checkedRadio.value), customer.addresses);
                }
            }
        }
        
        function getAddressTypeIcon(type) {
            const iconType = (type || 'home').toLowerCase();
            switch(iconType) {
                case 'home':
                    return `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>`;
                case 'work':
                case 'office':
                    return `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                    </svg>`;
                case 'other':
                default:
                    return `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>`;
            }
        }
        
        function getDeliveryEstimate(pincode) {
            if (!pincode) return 'Select address for delivery estimate';
            const pin = String(pincode).trim();
            if (pin.startsWith('560')) {
                return 'Delivery in 1-2 business days';
            }
            return 'Delivery in 2-4 business days';
        }
        
        function updateShippingDeliveryTime(pincode) {
            const shippingEstimate = document.getElementById('qcShippingEstimate');
            if (shippingEstimate) {
                shippingEstimate.textContent = getDeliveryEstimate(pincode);
            }
        }
        
        function updateShippingCost() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const freeShippingNote = document.getElementById('qcFreeShippingNote');
            const shippingPriceText = document.getElementById('qcShippingPriceText');
            
            if (subtotal >= 999) {
                qcShippingCost = 0;
                if (freeShippingNote) {
                    freeShippingNote.style.display = 'block';
                    freeShippingNote.textContent = '🎉 You qualify for FREE shipping!';
                }
            } else {
                qcShippingCost = 99;
                const remaining = 999 - subtotal;
                if (freeShippingNote) {
                    freeShippingNote.style.display = 'block';
                    freeShippingNote.textContent = `Add ₹${remaining} more to get FREE shipping!`;
                }
            }
            
            // Update the shipping price display
            if (shippingPriceText) {
                shippingPriceText.textContent = qcShippingCost === 0 ? 'FREE' : `₹${qcShippingCost}`;
            }
            
            updateQCSummary();
        }

        // Close Quick Checkout
        function closeQuickCheckout() {
            quickCheckoutOverlay.classList.remove('active');
            document.body.style.overflow = '';
            // Reset to step 1
            goToStep(1);
            // Reset success state
            document.getElementById('qcSuccess').classList.add('hidden');
            document.getElementById('qcStep1').classList.remove('hidden');
            // Reset selected location and saved address
            qcSelectedLocation = null;
            qcSelectedSavedAddress = null;
            qcHasSavedAddresses = false;
            document.getElementById('qcSelectedAddress').classList.remove('visible');
            // Reset saved addresses display
            const savedAddressesContainer = document.getElementById('qcSavedAddresses');
            const newAddressForm = document.getElementById('qcNewAddressForm');
            if (savedAddressesContainer) savedAddressesContainer.style.display = 'none';
            if (newAddressForm) newAddressForm.style.display = 'block';
            
            // Restore original cart if this was a Buy Now session that was cancelled
            restoreCartAfterBuyNow();
        }

        quickCheckoutClose.addEventListener('click', closeQuickCheckout);
        quickCheckoutOverlay.addEventListener('click', function(e) {
            if (e.target === quickCheckoutOverlay) {
                closeQuickCheckout();
            }
        });

        // Navigate to step
        function goToStep(step) {
            // Validate Step 1 before proceeding to Step 2
            if (step === 2 && qcCurrentStep === 1) {
                const emailInput = document.getElementById('qcEmail');
                const phoneInput = document.getElementById('qcPhone');
                const email = emailInput.value.trim();
                const phone = phoneInput.value.trim();
                
                // Clear previous errors
                emailInput.classList.remove('error');
                phoneInput.classList.remove('error');
                
                let hasError = false;
                
                // Email validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!email || !emailRegex.test(email)) {
                    emailInput.classList.add('error');
                    if (!hasError) {
                        emailInput.focus();
                        hasError = true;
                    }
                }
                
                // Phone validation (at least 10 digits)
                const phoneDigits = phone.replace(/\D/g, '');
                if (!phone || phoneDigits.length < 10) {
                    phoneInput.classList.add('error');
                    if (!hasError) {
                        phoneInput.focus();
                        hasError = true;
                    }
                }
                
                if (hasError) return;
            }
            
            // Hide all steps
            document.getElementById('qcStep1').classList.add('hidden');
            document.getElementById('qcStep2').classList.add('hidden');
            document.getElementById('qcStep3').classList.add('hidden');
            document.getElementById('qcSuccess').classList.add('hidden');

            // Show target step
            document.getElementById(`qcStep${step}`).classList.remove('hidden');

            // Update progress
            document.querySelectorAll('.qc-step').forEach((s, i) => {
                s.classList.remove('active', 'completed');
                if (i + 1 < step) {
                    s.classList.add('completed');
                } else if (i + 1 === step) {
                    s.classList.add('active');
                }
            });

            qcCurrentStep = step;
            
            // When going to step 2, update shipping info
            if (step === 2) {
                setTimeout(() => {
                    // Update shipping cost and delivery time
                    updateShippingCost();
                    if (qcSelectedLocation && qcSelectedLocation.pincode) {
                        updateShippingDeliveryTime(qcSelectedLocation.pincode);
                    }
                    
                    // If map is visible but not initialized, initialize it
                    const newAddressForm = document.getElementById('qcNewAddressForm');
                    const isMapVisible = newAddressForm && newAddressForm.style.display !== 'none';
                    
                    if (isMapVisible && typeof google !== 'undefined' && google.maps && !qcMap) {
                        initCheckoutMap();
                    } else if (qcMap) {
                        // Trigger resize to fix any display issues
                        google.maps.event.trigger(qcMap, 'resize');
                    }
                }, 150);
            }
        }

        // ========== GOOGLE MAPS INTEGRATION ==========
        function initCheckoutMap() {
            const mapContainer = document.getElementById('qcMap');
            if (!mapContainer || qcMap) return;
            
            // Default center (India)
            const defaultCenter = { lat: 20.5937, lng: 78.9629 };
            
            qcMap = new google.maps.Map(mapContainer, {
                center: defaultCenter,
                zoom: 5,
                styles: [
                    { elementType: 'geometry', stylers: [{ color: '#0A1628' }] },
                    { elementType: 'labels.text.stroke', stylers: [{ color: '#0A1628' }] },
                    { elementType: 'labels.text.fill', stylers: [{ color: '#94A3B8' }] },
                    { featureType: 'road', elementType: 'geometry', stylers: [{ color: '#1a2b47' }] },
                    { featureType: 'water', elementType: 'geometry', stylers: [{ color: '#00D4FF', lightness: -70 }] },
                    { featureType: 'poi', elementType: 'labels', stylers: [{ visibility: 'off' }] }
                ],
                disableDefaultUI: true,
                zoomControl: true,
                mapTypeControl: false,
                streetViewControl: false,
                fullscreenControl: false
            });
            
            // Initialize marker
            qcMarker = new google.maps.Marker({
                map: qcMap,
                draggable: true,
                animation: google.maps.Animation.DROP
            });
            
            // Marker drag event
            qcMarker.addListener('dragend', function() {
                const position = qcMarker.getPosition();
                reverseGeocode(position.lat(), position.lng());
            });
            
            // Map click event
            qcMap.addListener('click', function(e) {
                qcMarker.setPosition(e.latLng);
                qcMarker.setVisible(true);
                qcMap.panTo(e.latLng);
                reverseGeocode(e.latLng.lat(), e.latLng.lng());
            });
            
            // Initialize Places Autocomplete
            const searchInput = document.getElementById('qcAddressSearch');
            console.log('Search input found:', searchInput);
            
            if (searchInput && google.maps.places) {
                console.log('Initializing Places Autocomplete...');
                
                // STRICT: Block Chrome autofill completely
                searchInput.addEventListener('focus', function() {
                    this.setAttribute('autocomplete', 'chrome-off');
                    this.setAttribute('readonly', 'readonly');
                    setTimeout(() => {
                        this.removeAttribute('readonly');
                    }, 50);
                });
                
                // Prevent form submission on enter
                searchInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                    }
                });
                
                qcAutocomplete = new google.maps.places.Autocomplete(searchInput, {
                    componentRestrictions: { country: 'in' },
                    fields: ['address_components', 'geometry', 'formatted_address', 'name']
                });
                
                // Bind autocomplete to the map bounds for better suggestions
                qcAutocomplete.bindTo('bounds', qcMap);
                
                console.log('Autocomplete initialized:', qcAutocomplete);
                
                qcAutocomplete.addListener('place_changed', function() {
                    const place = qcAutocomplete.getPlace();
                    console.log('Place selected:', place);
                    
                    if (!place.geometry || !place.geometry.location) {
                        showToast('Please select a location from the suggestions');
                        return;
                    }
                    
                    const location = place.geometry.location;
                    qcMap.setCenter(location);
                    qcMap.setZoom(16);
                    qcMarker.setPosition(location);
                    qcMarker.setVisible(true);
                    
                    // Extract address components
                    extractAddressComponents(place);
                });
            }
        }
        
        function extractAddressComponents(place) {
            let city = '';
            let state = '';
            let pincode = '';
            let country = 'India';
            
            if (place.address_components) {
                for (const component of place.address_components) {
                    const types = component.types;
                    
                    if (types.includes('locality')) {
                        city = component.long_name;
                    } else if (types.includes('administrative_area_level_1')) {
                        state = component.long_name;
                    } else if (types.includes('postal_code')) {
                        pincode = component.long_name;
                    } else if (types.includes('country')) {
                        country = component.long_name;
                    }
                    
                    // Fallback for city
                    if (!city && types.includes('administrative_area_level_2')) {
                        city = component.long_name;
                    }
                }
            }
            
            // Store selected location
            qcSelectedLocation = {
                formattedAddress: place.formatted_address || place.name,
                city: city,
                state: state,
                pincode: pincode,
                country: country,
                lat: place.geometry.location.lat(),
                lng: place.geometry.location.lng()
            };
            
            // Update UI
            updateSelectedAddressUI();
        }
        
        function reverseGeocode(lat, lng) {
            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ location: { lat, lng } }, function(results, status) {
                if (status === 'OK' && results[0]) {
                    extractAddressComponents(results[0]);
                    qcSelectedLocation.lat = lat;
                    qcSelectedLocation.lng = lng;
                }
            });
        }
        
        function updateSelectedAddressUI() {
            if (!qcSelectedLocation) return;
            
            // Clear any address errors when location is selected
            const errorEl = document.getElementById('qcAddressError');
            if (errorEl) errorEl.style.display = 'none';
            
            // Show selected address section
            const selectedAddressDiv = document.getElementById('qcSelectedAddress');
            selectedAddressDiv.classList.add('visible');
            
            // Update text
            document.getElementById('qcSelectedAddressText').textContent = qcSelectedLocation.formattedAddress;
            document.getElementById('qcCityDisplay').textContent = qcSelectedLocation.city || '-';
            document.getElementById('qcStateDisplay').textContent = qcSelectedLocation.state || '-';
            document.getElementById('qcPincodeDisplay').textContent = qcSelectedLocation.pincode || '-';
            document.getElementById('qcCountryDisplay').textContent = qcSelectedLocation.country || 'India';
            
            // Update hidden fields
            document.getElementById('qcAddress').value = qcSelectedLocation.formattedAddress;
            document.getElementById('qcCity').value = qcSelectedLocation.city;
            document.getElementById('qcState').value = qcSelectedLocation.state;
            document.getElementById('qcPincode').value = qcSelectedLocation.pincode;
            document.getElementById('qcLatitude').value = qcSelectedLocation.lat;
            document.getElementById('qcLongitude').value = qcSelectedLocation.lng;
            
            // Update shipping delivery time based on pincode
            updateShippingDeliveryTime(qcSelectedLocation.pincode);
        }
        
        function useCurrentLocation() {
            if (!navigator.geolocation) {
                showToast('Geolocation is not supported by your browser');
                return;
            }
            
            showToast('Getting your location...');
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    if (qcMap) {
                        const location = new google.maps.LatLng(lat, lng);
                        qcMap.setCenter(location);
                        qcMap.setZoom(16);
                        qcMarker.setPosition(location);
                        qcMarker.setVisible(true);
                        reverseGeocode(lat, lng);
                    }
                },
                function(error) {
                    let message = 'Unable to get your location';
                    if (error.code === error.PERMISSION_DENIED) {
                        message = 'Location permission denied. Please enable it in your browser settings.';
                    }
                    showToast(message);
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        }
        
        // Validate and continue to payment
        function validateAndContinueToPayment() {
            const errorEl = document.getElementById('qcAddressError');
            const errorTextEl = document.getElementById('qcAddressErrorText');
            const houseFloorInput = document.getElementById('qcHouseFloor');
            
            // Clear previous errors
            errorEl.style.display = 'none';
            houseFloorInput.classList.remove('error');
            
            // Helper to show error
            function showAddressError(message) {
                errorTextEl.textContent = message;
                errorEl.style.display = 'flex';
                errorEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            // Check if using saved address
            if (qcSelectedSavedAddress) {
                // Already have a valid address selected
                goToStep(3);
                return;
            }
            
            // New address flow - validate map selection
            const houseFloor = houseFloorInput.value.trim();
            
            if (!qcSelectedLocation || !qcSelectedLocation.formattedAddress) {
                showAddressError('Please select a delivery location on the map');
                return;
            }
            
            if (!houseFloor) {
                showAddressError('Please enter your house/floor number');
                houseFloorInput.classList.add('error');
                houseFloorInput.focus();
                return;
            }
            
            // Add house/floor to the address
            qcSelectedLocation.houseFloor = houseFloor;
            qcSelectedLocation.fullAddress = houseFloor + ', ' + qcSelectedLocation.formattedAddress;
            
            goToStep(3);
        }

        // Update QC Summary
        function updateQCSummary() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const orderTotal = subtotal + qcShippingCost;
            
            // Calculate discount on order total (same logic as cart)
            let discountAmount = 0;
            if (appliedDiscount && orderTotal > 0) {
                if (appliedDiscount.type === 'percent') {
                    discountAmount = Math.ceil(orderTotal * (appliedDiscount.value / 100));
                    if (appliedDiscount.maxDiscount && discountAmount > appliedDiscount.maxDiscount) {
                        discountAmount = appliedDiscount.maxDiscount;
                    }
                } else {
                    discountAmount = appliedDiscount.value;
                }
                discountAmount = Math.min(discountAmount, orderTotal);
            }
            
            const total = orderTotal - discountAmount;

            document.getElementById('qcSubtotal').textContent = `₹${subtotal.toLocaleString()}`;
            document.getElementById('qcShippingCost').textContent = qcShippingCost === 0 ? 'FREE' : `₹${qcShippingCost}`;
            
            // Show/hide discount row
            const discountRow = document.getElementById('qcDiscountRow');
            if (appliedDiscount && discountAmount > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('qcDiscountCode').textContent = `(${appliedDiscount.code})`;
                document.getElementById('qcDiscountAmount').textContent = `-₹${discountAmount.toLocaleString()}`;
            } else {
                discountRow.style.display = 'none';
            }
            
            document.getElementById('qcTotal').textContent = `₹${total.toLocaleString()}`;
        }

        // Shipping option selection
        document.querySelectorAll('.qc-shipping-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.qc-shipping-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                qcShippingCost = parseInt(this.dataset.price);
                updateQCSummary();
            });
        });

        // ========== RAZORPAY INTEGRATION ==========
        document.getElementById('qcPlaceOrder').addEventListener('click', async function() {
            const btn = this;
            btn.classList.add('loading');
            
            try {
                // Get customer info
                const customer = CustomerAuth.getCustomer();
                const phone = document.getElementById('qcPhone')?.value || customer?.mobile || '';
                const email = document.getElementById('qcEmail')?.value || customer?.email || '';
                const name = document.getElementById('qcName')?.value || customer?.name || '';
                
                // Update customer email if it's new or changed
                if (email && email !== customer?.email) {
                    try {
                        await CustomerAuth.updateProfile({ email: email });
                    } catch (e) {
                        console.log('Could not update email:', e);
                    }
                }
                
                // Determine shipping method (only standard now)
                const shippingMethod = 'standard';
                
                // Prepare shipping address for backend (matching backend schema)
                const shippingAddress = {
                    fullName: name,
                    mobile: phone,
                    houseFloor: qcSelectedLocation?.houseFloor || document.getElementById('qcHouseFloor')?.value || '',
                    fullAddress: qcSelectedLocation?.fullAddress || qcSelectedLocation?.formattedAddress || '',
                    landmark: '',
                    city: qcSelectedLocation?.city || '',
                    state: qcSelectedLocation?.state || '',
                    pincode: qcSelectedLocation?.pincode || '',
                    location: {
                        type: 'Point',
                        coordinates: [qcSelectedLocation?.lng || 0, qcSelectedLocation?.lat || 0]
                    },
                    addressType: qcSelectedSavedAddress?.type || 'home'
                };
                
                // Prepare items for backend
                const items = cart.map(item => ({
                    productId: item.id || item.productSlug,
                    productSlug: item.productSlug || item.id,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity,
                    flavour: item.flavour || null,
                    image: item.image || null
                }));
                
                // Build order data for backend (always Razorpay)
                const orderData = {
                    items,
                    shippingAddress,
                    shippingMethod,
                    paymentMethod: 'razorpay',
                    discountCode: appliedDiscount ? appliedDiscount.code : null
                };
                
                // Initiate Razorpay payment
                await initiateRazorpayPayment(orderData);
            } catch (error) {
                console.error('Checkout error:', error);
                showToast(error.message || 'Something went wrong. Please try again.');
                btn.classList.remove('loading');
            }
        });
        
        async function initiateRazorpayPayment(orderData) {
            const btn = document.getElementById('qcPlaceOrder');
            
            try {
                // First, get the Razorpay key from server
                const keyResponse = await fetch(`${API_BASE_URL}/api/orders/config/razorpay-key`);
                const keyData = await keyResponse.json();
                
                if (!keyData.success || !keyData.key) {
                    throw new Error('Failed to initialize payment');
                }
                
                // Create order on server
                const response = await fetch(`${API_BASE_URL}/api/orders/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CustomerAuth.getToken()}`
                    },
                    body: JSON.stringify(orderData)
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || 'Failed to create order');
                }
                
                if (!data.payment || !data.payment.razorpayOrderId) {
                    throw new Error('Payment initialization failed');
                }
                
                // Store order info for verification
                const pendingOrder = {
                    orderId: data.order.id,
                    orderNumber: data.order.orderNumber,
                    razorpayOrderId: data.payment.razorpayOrderId
                };
                localStorage.setItem('flow_pending_order', JSON.stringify(pendingOrder));
                
                // Configure Razorpay Checkout options
                const options = {
                    key: keyData.key,
                    amount: data.payment.amount,
                    currency: data.payment.currency,
                    name: data.payment.name,
                    description: data.payment.description,
                    order_id: data.payment.razorpayOrderId,
                    prefill: data.payment.prefill,
                    notes: data.payment.notes,
                    theme: {
                        color: '#00D4FF',
                        backdrop_color: 'rgba(10, 22, 40, 0.9)'
                    },
                    modal: {
                        ondismiss: function() {
                            btn.classList.remove('loading');
                            showToast('Payment cancelled');
                        }
                    },
                    handler: async function(response) {
                        // Payment successful - verify on server
                        try {
                            const verifyResponse = await fetch(`${API_BASE_URL}/api/orders/verify-payment`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${CustomerAuth.getToken()}`
                                },
                                body: JSON.stringify({
                                    razorpayOrderId: response.razorpay_order_id,
                                    razorpayPaymentId: response.razorpay_payment_id,
                                    razorpaySignature: response.razorpay_signature,
                                    orderId: pendingOrder.orderId
                                })
                            });
                            
                            const verifyData = await verifyResponse.json();
                            
                            btn.classList.remove('loading');
                            
                            if (verifyData.success) {
                                // Save address if it's a new one
                                const saveAddressCheckbox = document.getElementById('qcSaveAddress');
                                const shouldSaveAddress = saveAddressCheckbox ? saveAddressCheckbox.checked : true;
                                
                                if (!qcSelectedSavedAddress && qcSelectedLocation && shouldSaveAddress) {
                                    await saveNewAddress();
                                }
                                
                                // Show success
                                document.getElementById('qcOrderNumber').textContent = pendingOrder.orderNumber;
                                document.getElementById('qcStep3').classList.add('hidden');
                                document.getElementById('qcSuccess').classList.remove('hidden');
                                document.querySelectorAll('.qc-step').forEach(s => s.classList.add('completed'));
                                
                                // Clear cart
                                cart = [];
                                CustomerAuth.saveLocalCart(cart);
                                updateCartUI();
                                
                                // Clear applied discount and reset discount UI
                                appliedDiscount = null;
                                const discountAppliedEl = document.getElementById('discountApplied');
                                const discountFormSection = document.getElementById('discountFormSection');
                                if (discountAppliedEl) discountAppliedEl.style.display = 'none';
                                if (discountFormSection) discountFormSection.style.display = 'flex';
                                
                                // Clear Buy Now backup if this was a Buy Now session
                                if (isBuyNowSession) {
                                    localStorage.removeItem('flow_cart_backup');
                                    isBuyNowSession = false;
                                }
                                
                                // Clear pending order
                                localStorage.removeItem('flow_pending_order');
                                
                                showToast('Payment successful! Order placed.');
                            } else {
                                showToast(verifyData.message || 'Payment verification failed', 'error');
                            }
                        } catch (verifyError) {
                            console.error('Payment verification error:', verifyError);
                            btn.classList.remove('loading');
                            showToast('Payment received but verification failed. Please contact support.');
                        }
                    }
                };
                
                // Open Razorpay Checkout popup
                const rzp = new Razorpay(options);
                
                rzp.on('payment.failed', function(response) {
                    btn.classList.remove('loading');
                    console.error('Payment failed:', response.error);
                    showToast(`Payment failed: ${response.error.description || 'Please try again'}`);
                });
                
                rzp.open();
                
            } catch (error) {
                btn.classList.remove('loading');
                throw error;
            }
        }
        
        // Save new address to customer profile
        async function saveNewAddress() {
            if (!qcSelectedLocation) {
                console.log('No location selected, skipping address save');
                return false;
            }
            
            try {
                const addressData = {
                    type: 'home',
                    houseFloor: qcSelectedLocation.houseFloor || '',
                    formattedAddress: qcSelectedLocation.formattedAddress || '',
                    fullAddress: qcSelectedLocation.fullAddress || qcSelectedLocation.formattedAddress || '',
                    city: qcSelectedLocation.city || '',
                    state: qcSelectedLocation.state || '',
                    pincode: qcSelectedLocation.pincode || '',
                    country: qcSelectedLocation.country || 'India',
                    coordinates: {
                        lat: qcSelectedLocation.lat || 0,
                        lng: qcSelectedLocation.lng || 0
                    },
                    isDefault: !qcHasSavedAddresses // Make default if no existing addresses
                };
                
                console.log('Saving address:', addressData);
                
                const response = await fetch(`${API_BASE_URL}/api/customer/addresses`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CustomerAuth.getToken()}`
                    },
                    body: JSON.stringify(addressData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    // Refresh customer data to include new address
                    await CustomerAuth.refreshCustomer();
                    console.log('Address saved successfully:', data);
                    return true;
                } else {
                    console.error('Failed to save address:', data.message || 'Unknown error');
                    return false;
                }
            } catch (error) {
                console.error('Failed to save address:', error);
                // Don't throw - address save failure shouldn't fail the order
                return false;
            }
        }
    </script>
    
    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-bottom-nav">
        <a href="/" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            <span>Home</span>
        </a>
        <a href="/shop/" class="nav-item active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
            <span>Shop</span>
        </a>
        <a href="javascript:void(0)" onclick="openCart()" class="nav-item cart-nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
            <span class="mobile-cart-count" id="mobileCartCount">0</span>
            <span>Cart</span>
        </a>
        <a href="/profile/" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <span>Profile</span>
        </a>
    </nav>
    
    <script src="/assets/js/customerAuth.js"></script>
</body>
</html>